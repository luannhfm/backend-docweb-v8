#INCLUDE "protheus.ch" 

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CNTA120E  ºAutor  ³Bruna Paola         º Data ³  03/02/2012 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Ponto de entrada para refazer a query retirando os contratosº±±
	±±º      ³ compartilhados									          º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ CNI                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/        
User Function CN120QCC()
Local cQuery1 := PARAMIXB[1]
Local cQuery2 := PARAMIXB[2]
Local cQuery3 := PARAMIXB[3]
Local cQuery4 := PARAMIXB[4]
Local cQuery5 := PARAMIXB[5] 

Local cQuery := ""  
Local cQuery6 := ""
Local cParam := GetMV("SI_XCRP")  

// Se não puder fazer medição de contrato de registro de preço e compartilhado pela rotina de medição
If (cParam == 'N')     
	// Não deixar medir contratos de registro de preço e contratos compartilhados
	cQuery6 := " AND CN9.CN9_XREGP <> '1' "
	cQuery6 += " AND NOT EXISTS " 
	cQuery6 += " (SELECT PB1.* FROM " + RetSqlName("PB1") + " PB1 "
	cQuery6 += " WHERE PB1.PB1_NUMERO = CN9.CN9_NUMERO" 
	cQuery6 += " AND PB1.PB1_REVISA = CN9.CN9_REVISA "   
	cQuery6 += " AND PB1.PB1_FILCN9 = '" + xFilial("CN9") + "' "
	cQuery6 += " AND PB1.D_E_L_E_T_ = ' ' ) "    
EndIf

If CN9->(FieldPos("CN9_VLDCTR"))> 0
	cQuery := cQuery1
    cQuery += cQuery2+" "+cQuery6+" "+cQuery4
    cQuery += " UNION "
    cQuery += cQuery1            
    cQuery += cQuery3+" "+cQuery6+" "+cQuery4+" "+cQuery5
Else                 
	cQuery := cQuery1
    cQuery += cQuery3+" "+cQuery6+" "+cQuery4+" "+cQuery5
EndIf  
	
Return cQuery