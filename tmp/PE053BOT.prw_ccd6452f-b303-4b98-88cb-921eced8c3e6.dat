#INCLUDE "PROTHEUS.CH"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³PE053BOT  ºAutor  ³PC/FSW       		 º Data ³  07/21/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Ponto de entrada para tratar botão de confirmação e 		  º±±
±±º          ³ recebimento de pedidos - Customização CNI				  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ Portal do Fornecedor                                       º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±º          ³ Ajustado FSW 03/10 - Correção de Erros no Desenvolvimento. º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function PE053BOT()

Local cHtml
Local cStatus
Local cPedido
Local oObj
Local lPrjCni    := FindFunction("ValidaCNI") .And. ValidaCNI()
Local cEmpFil   := ""
Local cEmp      := ""
Local cFil      := ""
Local cFuncName := "U_PE053BOT"

// Coleta qual a empresa e a filial presente no JOB corrent do .ini
cEmpFil := GetPvProfString( getWebJob(), "PrepareIn", "", GetADV97() )		//getWebJob(): JOB_PP_0101RS0001
cEmp := substr(cEmpFil,1,2)
cFil := substr(cEmpFil,4,8) //Verificar com o tamanho da filial

ConOut("["+DtoC(Date()) + " " + Time()+"] ["+cFuncName+"] Emp,Fil: " + cEmpFil)

If lPrjCni
	cStatus := "1"
	cPedido := substr(HttpSession->PWSF053APH[1],16,6)
	oObj  	:= WSWSCNIESTAT():NEW()
	
	WsChgURL(@oObj,"WSCNIESTAT.APW") 

	oObj:GetStatusBut(cPedido)
	cStatus := oObj:cGetStatusButResult 
	
	//nao enviado
	If cStatus = "1" 
		cHtml:=	'	<input name="Btn" id="onbot" type="button"  value="Pedido Recebido"   class="Botoes" onclick="fFun(this)" disabled="true" >'
	//emitido			
	Elseif cStatus = "2" 
		cHtml:='	<input name="Btn" id="onbot" type="button"  value="Pedido Recebido"   class="Botoes" onclick="fFun(this)"				  >' 
	//recebido		
	Elseif cStatus = "3" 
		cHtml:='	<input name="Btn" id="onbot" type="button"  value="Pedido Confirmado" class="Botoes" onclick="fFun(this)"				  >'
	//confirmado		
	Elseif cStatus = "4" 
		cHtml:='	<input name="Btn" id="onbot" type="button"  value="Pedido Confirmado" class="Botoes" onclick="fFun(this)" disabled="true" >' 
	Else
		cHtml:=	'	<input name="Btn" id="onbot" type="button"  value="Pedido Recebido"   class="Botoes" onclick="fFun(this)" disabled="true" >'			
	Endif
EndIf
	
Return cHtml