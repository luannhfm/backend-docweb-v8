#INCLUDE 'PROTHEUS.CH'
#INCLUDE 'FWMVCDEF.CH'

/*/{Protheus.doc} SF73A03J
Funcao responsavel por realizar o cancelamento de Oportunidades

@author 	José Leite de Barros Neto
@since 	27/08/2015
@version 	1.0

@return Nil, Nulo

/*/
User Function SF73A03J()
	
	Local oBrowse
	Private aRotina := MenuDef()
	
	oBrowse := FWMBrowse():New()
	oBrowse:SetAlias('AD1')
	oBrowse:SetDescription ('Cancelamento de Oportunidades')
	
	oBrowse:AddLegend("AD1->AD1_STATUS=='1'" , "BR_VERDE"			, "Em Aberto" 					)
	oBrowse:AddLegend("AD1->AD1_STATUS=='2'" , "BR_PRETO"			, "Perdido"						)
	oBrowse:AddLegend("AD1->AD1_STATUS=='E'" , "BR_VERMELHO.BMP"	, "Ganha SEM Pedido"			)
	oBrowse:AddLegend("AD1->AD1_STATUS=='F'" , "BR_VERMELHO"		, "Ganha COM Pedido"			)
	oBrowse:AddLegend("AD1->AD1_STATUS=='D'" , "BR_LARANJA"			, "Cancelada Após Aceite"	)
	
	oBrowse:Activate()

Return( Nil )

//-------------------------------------------------------------------
Static Function MenuDef()
	
	Local aRotina := {}

	ADD OPTION aRotina TITLE 'Visualizar' 			ACTION 'VIEWDEF.SF73A03J'  	OPERATION 2 ACCESS 0
	ADD OPTION aRotina TITLE 'Canc. Oportunidade' 	ACTION 'U_fCancAD1()'  		OPERATION 4 ACCESS 0
	
Return aRotina

//-------------------------------------------------------------------
Static Function ModelDef()
	
	// Cria a estrutura a ser usada no Modelo de Dados
	Local oStruAD1 := FWFormStruct(1,'AD1', /*bAvalCampo*/,/*lViewUsado*/ )
	Local oModel

	// Cria o objeto do Modelo de Dados
	oModel := MPFormModel():New('SF73A02M',/*bPreValidacao*/, /*bPosValidacao*/, /*bCommit*/, /*bCancel*/ )

	//Adiciona ao Modelo uma estrutura de formulario de edição por campo
	oModel:AddFields('AD1MASTER',/*cOwner*/, oStruAD1, /*bPreValidacao*/, /*bPosValidacao*/, /*bCarga*/ )

	//Adiciona a Descrição do Modelo de Dados
	oModel:SetDescription('Cancelamento de Oportunidades' )

	oModel:GetModel('AD1MASTER'):SetDescription('Dados do Cancelamento de Oportunidades')
	
	oModel:SetPrimaryKey( { "AD1_FILIAL", "AD1_NROPOR", "AD1_REVISA" } )

Return oModel

//-------------------------------------------------------------------
Static Function ViewDef()

	//Cria um objeto de Modelo de Dados baseado no ModelDef
	Local oModel := FWLoadModel('SF73A03J')

	//Cria a estrutura a ser usada na View
	Local oStruAD1 := FWFormStruct(2,'AD1')
	Local oView
	Local cCampos := {}

	//Cria o Objeto da View
	oView := FWFormView():New()

	//Define qual o Modelo de dados será utilizado
	oView:SetModel( oModel )

	//Adiciona no View um controle do tipo FormField (Antiga Enchoice)
	oView:addField( 'VIEW_AD1',oStruAD1, 'AD1MASTER' )

	//Cria um BOX horizontal para receber elementos da View
	oView:CreateHorizontalBox('TELA' , 100 )

	//Relaciona o ID da View com o Box para exibição
	oView:SetOwnerView( 'VIEW_AD1' , 'TELA' )

Return oView