#include "Rwmake.ch"
#include "Protheus.ch"

Static _cRetConp

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  |SF0410X  ºAutor  ³Caio Renan          º Data ³04/04/2014              º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³FUNCAO PARA UMA CONSULTA CUSTOMIZADA ATRAVES DE UM SELECT              º±±
±±º          ³E UM ARQUIVO DE CONFIGURACAO                                           º±±
±±º          ³                                                                       º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³                                                                       º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß

no final desse fonte tem um exemplo de um arquivo usando todos os parametros

Funcionalidades instaladas.

Ao mudar a pesquisa, reordena o array com os dados.

adicionado a opcao para definir o tamanho da tela - TAMANHO_TELA_COLUNA

*/
User Function SF0410X(_cArquivo)
Local _aArea := GetArea()
Local _lArq  := fCrArq()
Local oButton1
Local oButton2
Local oButton3
Local oComboBo1
Local nComboBo1 := "1"
Local oGet1
Local cGet1 := Space(100)

Local _aHeader := {}
Local _aSize := {}
Local _aCampo := {}

Local _aLinhas := LeArq(_cArquivo)
Local _nPICol := AScan(_aLinhas , {|x| "--INI_COLUNAS" $ x } ) + 1
Local _nPFCol := AScan(_aLinhas , {|x| "--FIM_COLUNAS" $ x } ) - 1

Local _nPIPesq := AScan(_aLinhas , {|x| "--INI_PESQUISAS" $ x } ) + 1
Local _nPFPesq := AScan(_aLinhas , {|x| "--FIM_PESQUISAS" $ x } ) - 1

Local _aItens := {}
Local _aItCmp := {}

//Local _nPRet := AScan(_aLinhas , {|x| "RETORNO_CONSULTA"    $ x } ) + 1
//Local _nPRetBrow := 0 // AScan(_aCampo , {|x|  _aLinhas[_nPRet]   $ x } )

Local _nSizeC := AScan(_aLinhas , {|x| "--TAMANHO_TELA_COLUNA"   $ x } ) + 1

Private _nOpc := 0

Private oDlg

Private oWBrowse1
Private aWBrowse1 := {}

//Walmir Junior 02/05/2016 - Parâmetro para tipo de contrato de imunização.
Private _cTPIM := SuperGetMV("MV_XTPIM",,"")

If Empty(_cTPIM)
	Aviso("Atenção", "Informe o conteúdo do parâmetro 'MV_XTPIM' com o tipo de contrato 'imunização'.", {"Ok"})
	Return Nil
EndIf

If _nSizeC == 1
	_nSizeC := 500
Else
	_nSizeC := Val(_aLinhas[_nSizeC])
	If _nSizeC < 500
		_nSizeC := 500
	EndIf
EndIf

_cTitle := _aLinhas[ AScan(_aLinhas , {|x| "--TITULO_JANELA" $ x } ) + 1 ]
//Alert(_cTitle)

For _nx := _nPICol To _nPFCol
	// 3 posicoes - Titulo coluna | Tamanho | Campo
	_aColuna := StrTokArr(_aLinhas[_nx] , ",")
	
	Aadd(_aHeader , _aColuna[01] )
	Aadd(_aSize   , _aColuna[02] )
	Aadd(_aCampo  , _aColuna[03] )
Next

_nCont := 0
For _nx := _nPIPesq To _nPFPesq
	_nCont++
	
	// 3 posicoes - Titulo da pesquisa | Campo a ser pesquisa
	_aPesq := StrTokArr(_aLinhas[_nx] , ",")
	
	Aadd( _aItens , StrZero(_nCont,02)+"="+_aPesq[01] )
	//Aadd( _aItCmp , aScan(_aCampo , {|x| AllTrim(_aPesq[02]) $ x }  ) )
	
	Aadd( _aItCmp , {} )
	For _ny := 2 to Len(_aPesq)
		Aadd( _aItCmp[Len(_aItCmp)] , _aPesq[_ny] )
	Next
	
Next

//_nPRetBrow := AScan(_aCampo , {|x|  _aLinhas[_nPRet]   $ x } )

// _cTitle := _aLinhas[ AScan(_aLinhas , {|x| "TITULO_JANELA" $ x } ) + 1 ]
// Alert(_cTitle)

DEFINE MSDIALOG oDlg TITLE _cTitle FROM 000, 000  TO 485, _nSizeC COLORS 0, 16777215 PIXEL

fWBrowse1(_aLinhas,_aHeader,_aSize,_aCampo,_nSizeC)
@ 005, 002 MSCOMBOBOX oComboBo1 VAR nComboBo1 ITEMS _aItens SIZE 072, 010 OF oDlg COLORS 0, 16777215 PIXEL
oComboBo1:bChange := {|| Ordena(nComboBo1, _aItCmp, _aCampo) }
@ 005, 077 MSGET oGet1 VAR cGet1 SIZE (_nSizeC * 0.304) , 010 OF oDlg COLORS 0, 16777215 PIXEL
@ 005, (_nSizeC * 0.462) BUTTON oButton3 PROMPT ">>" SIZE 014, 012 Action(fPesquisa(_aItCmp, nComboBo1 ,cGet1, _aCampo)) OF oDlg PIXEL

@ 225, 153 BUTTON oButton1 PROMPT "Ok" SIZE 037, 012 Action( fRetorna(_aLinhas,_aCampo) ) OF oDlg PIXEL
oWBrowse1:bLDblClick := {|| fRetorna(_aLinhas,_aCampo) }

@ 225, 200 BUTTON oButton2 PROMPT "Cancelar" SIZE 037, 012 Action(oDlg:End()) OF oDlg PIXEL

Ordena(nComboBo1, _aItCmp, _aCampo)

ACTIVATE MSDIALOG oDlg CENTERED
If _nOpc == 1
	//_cRetConp := aWBrowse1[oWBrowse1:nAt , _nPRetBrow]
	//Alert(_cRetConp)
Else
	_cRetConp := ""
EndIf

RestArea(_aArea)

Return !(empty(_cRetConp))

/*/
@author: caiocrol
@data: 19/11/2014
@descricao: Tratativa de retorno da consulta, permite ter varios retornos
_nPRetBrow -- Posicao da coluna que sera retornanda
se maior que 0 apenas um retorno, se nao
/*/
Static Function fRetorna(_aLinhas,_aCampo)
Local _nPIRet := AScan(_aLinhas , {|x| "--RETORNO_CONSULTA"    $ x } ) + 1 // inicio retorno
Local _nPFRet := AScan(_aLinhas , {|x| "--FIM_RETORNO_CONSULTA"    $ x } ) // fim retorno

Local _nPRetBrow := 0 // AScan(_aCampo , {|x|  _aLinhas[_nPRet]   $ x } )
Local _aRetCon := {}
Local _nx := 0

_nOpc := 1

If _nPFRet = 0
	_nPRetBrow := AScan(_aCampo , {|x|  _aLinhas[_nPIRet]   $ x } )
	_cRetConp := aWBrowse1[oWBrowse1:nAt , _nPRetBrow]
Else
	_nPFRet--
	For _nx := _nPIRet To _nPFRet
		// 1 posicao , coluna que sera retornada
		Aadd(_aRetCon , _aLinhas[_nx] )
	Next
	
	_cRetConp := ""
	
	For _nx := 1 To Len(_aRetCon)
		_nPRetBrow := AScan(_aCampo , {|x|  _aRetCon[_nx]   $ x } )
		_cRetConp += aWBrowse1[oWBrowse1:nAt , _nPRetBrow]+";"
	Next
	
	// retira ponto e virgual final
	If Right(_cRetConp , 1) == ";"
		_cRetConp := Left(_cRetConp , Len(_cRetConp) - 1)
	EndIf
	
EndIf

oDlg:End()

Return

//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function Ordena(nComboBo1, _aItCmp, _aCampo)

Private _aCmpI := _aItCmp[Val(nComboBo1)]

//aSort( aWBrowse1 ,,, {|x,y| x[_nCol] < y[_nCol] } )
aSort( aWBrowse1 ,,, {|x,y| fOrdAux(x , y , _aCmpI, _aCampo ) } )

oWBrowse1:Refresh()
oDlg:Refresh()

Return

//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao auxiliar para ordencao
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function fOrdAux(_x, _y, _aItCmp, _aCampo)
Local _lRet := .T.
Local _nPos := 0
Local _cX := ""
Local _cY := ""

For _nz := 1 To Len(_aItCmp)
	_nPos := aScan(_aCampo , {|x| _aItCmp[_nz] = x }  )
	If _nPos > 0
		_cX += _x[_nPos]
		_cY += _y[_nPos]
	EndIf
Next

_lRet := _cX < _cY

//aScan(_aCampo , {|x| AllTrim(_aPesq[02]) $ x }  )

Return _lRet

//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function fPesquisa(_aItCmp,nComboBo1,cGet1, _aCampo)
Local _aCmpI := _aItCmp[Val(nComboBo1)]
//Local _nPos := aScan(aWBrowse1 , {|x| AllTrim(cGet1) $ x[_aItCmp[nComboBo1]] } ) 
Local _nPos := aScan(aWBrowse1 , {|x| fPesqAux(x, cGet1, _aCmpI , _aCampo) } ) 

If _nPos > 0
	oWBrowse1:nAt := _nPos // aScan(aWBrowse1 , {|x| AllTrim(cGet1) $ x[_aItCmp[nComboBo1]] } ) 
Else
	MsgAlert("Não encontrado")
EndIf
Return

//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao auxiliar para ordencao
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function fPesqAux(_x, cGet1, _aItCmp, _aCampo)
Local _lRet := .T.
Local _nPos := 0
Local _cX := ""

For _nz := 1 To Len(_aItCmp)
	_nPos := aScan(_aCampo , {|x| _aItCmp[_nz] = x }  )
	If _nPos > 0
		_cX += _x[_nPos]
	EndIf
Next

_lRet := AllTrim(cGet1) $ AllTrim(_cX)

//aScan(_aCampo , {|x| AllTrim(_aPesq[02]) $ x }  )

Return _lRet

//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function fWBrowse1(_aLinhas,_aHeader,_aSize,_aCampo,_nSizeC)
Local _cSql := ""
Local _cALias := GetNextAlias()

Local _nPTabela := AScan(_aLinhas , {|x| "--TABELA" $ x } ) + 1
Local _nPFilt   := AScan(_aLinhas , {|x| "--TABELA_FILTRO" $ x } ) + 1

Local _nPISQL := AScan(_aLinhas , {|x| "--INICIO_SQL" $ x } ) + 1
Local _nPFSQL := AScan(_aLinhas , {|x| "--FIM_SQL"    $ x } ) - 1

Local _nPIPSQL := AScan(_aLinhas , {|x| "--INICIO_PARAM_SQL" $ x } ) + 1
Local _nPFPSQL := AScan(_aLinhas , {|x| "--FIM_PARAM_SQL"    $ x } ) - 1

If _nPTabela > 1
	_cALias := _aLinhas[_nPTabela]
	dbSelectArea(_cALias)
	If _nPFilt > 1
		SET FILTER TO &(_aLinhas[_nPFilt])
	EndIf
Else
	// String SQL
	For _nx :=  _nPISQL To _nPFSQL
		_cSql += _aLinhas[_nx]
	Next
	// Parametros que serao usados no sql
	For _nx :=  _nPIPSQL To _nPFPSQL
		_aParamSql := StrTokArr(_aLinhas[_nx],";")
		_cSql := StrTran( _cSql, _aParamSql[01] , &(_aParamSql[02]) )
	Next

	If Select(_cALias) > 0
		(_cALias)->(dbClosearea())
	Endif
	MemoWrite("D:\LOGSQL\CONSFILE.txt" , _cSql)
	DbUseArea(.T., "TOPCONN", TCGenQry(,,ChangeQuery(_cSql)), _cALias, .F., .F.)
	
EndIf


(_cALias)->(dbGoTop())

If (_cALias)->(Eof())
	Aadd(aWBrowse1, {} )
	For _nx := 1 To Len(_aCampo)
		Aadd(aWBrowse1[Len(aWBrowse1)], "" )
	Next
EndIf

While !(_cALias)->(Eof())
	Aadd(aWBrowse1, {} )
	
	For _nx := 1 To Len(_aCampo)
		Aadd(aWBrowse1[Len(aWBrowse1)], (_cALias)->&(_aCampo[_nx]) )
	Next
	
	(_cALias)->(dbSkip())
EndDo

If Len(_cAlias) > 3
	(_cAlias)->( dbCloseArea() )
EndIf

//@ 021, 002 LISTBOX oWBrowse1 Fields HEADER _aHeader SIZE 245, 199 OF oDlg PIXEL ColSizes _aSize
oWBrowse1 := TWBrowse():New(  021, 002, (_nSizeC * 0.49), 199 ,,_aHeader,_aSize,oDlg ,,,,,{||},,,,,,,.F.,,.T.,,.F.,,, )

oWBrowse1:SetArray(aWBrowse1)

oWBrowse1:bLine := {|| fbLine() }

// DoubleClick event
//oWBrowse1:bLDblClick := {|| aWBrowse1[oWBrowse1:nAt,1] := !aWBrowse1[oWBrowse1:nAt,1],;
//oWBrowse1:DrawSelect()}
Return
//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function fbLine()
Local _aRet := {}
For _nz := 1 to Len(aWBrowse1[oWBrowse1:nAt])
	Aadd(_aRet,aWBrowse1[oWBrowse1:nAt,_nz])
Next
Return(_aRet)
//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao que le o arquivo e retorna um array com todos as linhas do arquivo
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function LeArq(_cArquivo)
Local _aLinhas := {}
// Abre o arquivo
If Empty(_cArquivo)
	nHandle := FT_FUse("\system\consulta_sramultemp.txt")
	Else
	nHandle := FT_FUse(_cArquivo)
EndIf
// Se houver erro de abertura abandona processamento
if nHandle = -1
	Alert("Não foi possivel abrir o arquivo de configuracao da consulta")
	return
endif
// Posiciona na primeria linha
FT_FGoTop()
// Retorna o número de linhas do arquivo
//nLast := FT_FLastRec()
While !FT_FEOF()
	cLine  := FT_FReadLn()
	Aadd(_aLinhas, cLine)
	// Pula para próxima linha
	FT_FSKIP()
EndDo
// Fecha o Arquivo
FT_FUSE()

Return(_aLinhas)
//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao
// para multiplo retorno adicionar varias vezes: U_RETCONSF(1,2) U_RETCONSF(3,2) ... ** OLD
// parametros posicao inicial e quantidade de caracteres que vai pegar               ** OLD
//
// para retorno unico colocar no cadastro de retorno da consulta especifica: U_RETCONSF()
// para varios retornos deve ser colocado ao numero do retorno
// exemplo abaixo
// --RETORNO_CONSULTA
//X6_VAR      // como deve ficar no retorno da consulta U_RETCONSF(1)
//X6_DESCRIC  // como deve ficar no retorno da consulta U_RETCONSF(2)
//X6_DESC1    // como deve ficar no retorno da consulta U_RETCONSF(3)
//X6_DESC2    // como deve ficar no retorno da consulta U_RETCONSF(4)
//--FIM_RETORNO_CONSULTA
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
User Function RETCONSF(_nLinha)
Local _aRet := {}
Local _cRet := _cRetConp

Default _nLinha := 0

If At(";" , _cRetConp) > 0 .AND. _nLinha > 0
	_aRet := StrTokArr(_cRetConp , ";")
	_cRet := _aRet[_nLinha]
EndIf

Return(_cRet)

Static Function fCrArq()
Local _cCnArq 	:= ""	
Local _cFilDR	:= SuperGetMV("MV_XFILDR",.F., "02MT0001") 
Local _cTPIM 	:= SuperGetMV("MV_XTPIM",,"")

_cCnArq += "--INICIO_PARAM " + CRLF
_cCnArq += "--TITULO_JANELA " + CRLF
_cCnArq += "Contratos " + CRLF
_cCnArq += "--RETORNO_CONSULTA " + CRLF
_cCnArq += "CN9_FILIAL " + CRLF
_cCnArq += "CN9_NUMERO " + CRLF
_cCnArq += "CN9_REVISA " + CRLF
_cCnArq += "--FIM_RETORNO_CONSULTA " + CRLF
_cCnArq += "--TAMANHO_TELA_COLUNA " + CRLF
_cCnArq += "650 " + CRLF
_cCnArq += "--INI_PESQUISAS " + CRLF
_cCnArq += "Filial,CN9_FILIAL " + CRLF
_cCnArq += "Contrato,CN9_NUMERO " + CRLF
_cCnArq += "Revisão,CN9_REVISA " + CRLF
_cCnArq += "Cliente,A1_NOME " + CRLF
_cCnArq += "Cotrato Venda, CN9_XNROCV " + CRLF
_cCnArq += "--FIM_PESQUISAS " + CRLF
_cCnArq += "--INI_COLUNAS " + CRLF
_cCnArq += "Filial,2,CN9_FILIAL " + CRLF
_cCnArq += "Contrato,6,CN9_NUMERO " + CRLF
_cCnArq += "Cotrato Venda,6, CN9_XNROCV " + CRLF
_cCnArq += "Revisão,6,CN9_REVISA " + CRLF
_cCnArq += "Cliente,20,A1_NOME " + CRLF
_cCnArq += "--FIM_COLUNAS " + CRLF
_cCnArq += "--FIM_PARAM " + CRLF
_cCnArq += "--INICIO_SQL " + CRLF
_cCnArq += "SELECT CN9_FILIAL, CN9_NUMERO, CN9_REVISA, CN9_XNROCV, CN9_DESCRI, A1_NOME " + CRLF
_cCnArq += "FROM "+ RetSQLName("CN9") +" CN9 INNER JOIN " + CRLF
_cCnArq += " "+RetSQLName("SA1")+" SA1 ON SA1.A1_COD = CN9.CN9_CLIENT AND SA1.A1_LOJA = CN9.CN9_LOJACL AND SA1.D_E_L_E_T_ = ' ' " + CRLF
_cCnArq += "WHERE CN9.D_E_L_E_T_ = ' ' AND " + CRLF
_cCnArq += "CN9.CN9_FILIAL in ('"+xFilial("CN9")+"', '"+_cFilDR+"') AND "  + CRLF
_cCnArq += "CN9.CN9_TPCTO = '"+_cTPIM+"' AND CN9.CN9_SITUAC = '05' "  + CRLF
_cCnArq += "--FIM_SQL " + CRLF
_cCnArq += "--INICIO_PARAM_SQL " + CRLF
_cCnArq += "--FIM_PARAM_SQL " + CRLF

MemoWrite("\temp\cn9fil.txt",_cCnArq)

Return .T.

/*
EXEMPLO DE UM ARQUIVO TXT COM AS CONFIGURACOES NECESSARIAS
--INICIO_PARAM
TITULO_JANELA
Consulta Funcionário
RETORNO_CONSULTA
EMPFILMAT
TAMANHO_TELA_COLUNA
700
--INI_PESQUISAS
Empresa,EMPRESA
Matricula,RA_MAT
Nome,RA_NOME
EmpFilMat,EMPFILMAT
--FIM_PESQUISAS
--INI_COLUNAS
Empresa,5,EMPRESA
Filial,5,RA_FILIAL
Matricula,10,RA_MAT
Nome,50,RA_NOME
Emp Fil Mat,15,EMPFILMAT
--FIM_COLUNAS
--FIM_PARAM
--INICIO_SQL
SELECT * FROM SRAMULTEMP
--FIM_SQL
--INICIO_PARAM_SQL
01,ACOLS[N,ASCAN(AHEADER,{|| X[02]=="AF8_PROJET" })]
--FIM_PARAM_SQL
*/
