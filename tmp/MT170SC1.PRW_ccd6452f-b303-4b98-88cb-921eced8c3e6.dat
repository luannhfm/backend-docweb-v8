#INCLUDE "protheus.ch"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT170SC1  ºAutor  ³Microsiga           º Data ³  03/10/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Gravacao adicional da SC pelo ponto de pedido              º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MP11 - Projeto CNI                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function MT170SC1()
Local _aArea := GetArea()

RecLock("SC1",.f.)

// Comprador do Grupo
SB1->(dbSetOrder(1))
SB1->(dbSeek(XFilial("SB1")+SC1->C1_PRODUTO))

SBM->(dbSetOrder(1))
IF SBM->(FieldPos("BM_XCOD")) > 0 .and. SBM->(dbSeek(XFiliaL("SBM")+SB1->B1_GRUPO))
	SC1->C1_XCODCOM := SBM->BM_XCOD
ENDIF     

SBZ->(dbSetOrder(1))
If SBZ->(dbSeek(XFilial("SBZ")+SC1->C1_PRODUTO)) 

	SC1->C1_VUNIT  := SBZ->BZ_UPRC      
	
	If !Empty(SBZ->BZ_FINCOM)
		SC1->C1_FINCOM := SBZ->BZ_FINCOM    
		
        SZO->(DbSetOrder(1))
        If SZO->(MsSeek(xFilial("SZO")+SBZ->BZ_FINCOM))
     
     		If !Empty(SZO->ZO_XCONTC) 
     		
     			SC1->C1_CONTA := SZO->ZO_XCONTC
     			
     		EndIf
        
        EndIf
        
	EndIf
	
EndIf

// Atualizacao do campo prefixo da conta (C1_PREFIX)
CT1->(dbSetOrder(1))
IF CT1->(FieldPos("CT1_PREFIX")) > 0 .and. CT1->(dbSeek(xFilial("CT1")+SC1->C1_CONTA))
	SC1->C1_PREFIX := CT1->CT1_PREFIX
ENDIF

// Tratamento para gerar com o status de A Classificar
SC1->C1_XCLASSI := .T.
SC1->C1_APROV   := "B"

// Tipo da Solicitacao
SC1->C1_TPSC := CriaVar("C1_TPSC")

SC1->(MsUnLock())

RestArea(_aArea)
Return()
