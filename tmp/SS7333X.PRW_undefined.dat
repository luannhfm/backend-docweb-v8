#INCLUDE "PROTHEUS.CH"
#INCLUDE "TOPCONN.CH"
#INCLUDE "RWMAKE.CH"
#INCLUDE "FONT.CH"
#INCLUDE "COLORS.CH"
#INCLUDE "PARMTYPE.CH"
#INCLUDE "FWMBROWSE.CH"
#INCLUDE "FWMVCDEF.CH"
#INCLUDE "FWCOMMAND.CH"
/*
--------------------------------------------------------------------------------
{Protheus.doc} <SS7333X>
 33 - Relatorio das Propostas Comerciais   

@author<Antonio Dantas>
@since<14/04/2015>
@version
<    ------------------------------------------------------------------
      Antonio Dantas                                        15/12/2015
      Atende Aditivo de 04/12/2015: Implementa Filtros na consulta
      por [Tipo de Produto] e [Grupo de Produtos]
     ------------------------------------------------------------------
      Jose Leite - CSI											11/08/2016
      Adicionado uma coluna para concatenar os produtos da proposta.
>
@return<Nil>
@example<Nil>
@see<Nil>
--------------------------------------------------------------------------------
*/
User Function SS7333X()
Local _oReport			:= Nil     
Private _lCancel		:= .f.  
Private _cPerg 			:= ""
Private _cAlias			:= GetNextAlias()   
Private _cAceAll   	:= SuperGetMv("MV_XACEALL",,"")       
//+------------------------------------------------------------------+
//| Verifica se o operador esta logado na filail DR que tem acesso   |
//| a todas as filiais, ou somente na filial em que esta logada.     |
//+------------------------------------------------------------------+
_cPerg	:= FunName()			//-- Define o Grupo de Perguntas   
//+------------------------------------------------------------------+
//|   Interface de impressao                                         |
//+------------------------------------------------------------------+
_oReport := ReportDef()
If !_lCancel
	_oReport:PrintDialog()
Endif	    
Return


/*
--------------------------------------------------------------------------------
{Protheus.doc} <ReportDef>
 33 - Relatorio das Propostas Comerciais   

@author<Antonio Dantas>
@since<14/04/2015>
@version<1.00>
@receive<Nil>
@return<Nil>
@example<Nil>
@see<Nil>
--------------------------------------------------------------------------------
*/
Static Function ReportDef()
Local _cTitulo		:= "33 - Propostas Comerciais"
Local _cSubTit		:= ""  
Local _oReport		:= Nil
//--
Local _oPropos		:= Nil
//+------------------------------------------------------------------+
//| Carrega as perguntas relativas aos parametros de Impressao       |
//|    Mv_par01 = Filial DE?                                         |
//|    Mv_par02 = Filial ATE?                                        |
//|    Mv_par03 = Polo de Venda DE?                                  |
//|    Mv_par04 = Polo de Venda ATE?                                 |
//|    Mv_par05 = Vendedor DE?                                       |
//|    Mv_par06 = Vendedor ATE?                                      |
//|    Mv_par07 = Cliente DE?                                        |
//|    Mv_par08 = Cliente ATE?                                       |
//|    Mv_par09 = Data de Abertura DE ?                              |
//|    Mv_par10 = Data de Abertura ATE ?                             |
//|    Mv_par11 = Data da Assinatura DE ?                            |
//|    Mv_par12 = Data da Assinatura ATE ?                           |
//|    Mv_par13 = Situação da Oport ?                                |
//|     *1=Aberto;2=Perdido;3=Suspenso;9=Encerrado                   |
//|    Mv_par14 = Status Proposta ?                                  |
//|     *A=Em aberto;B=Fechada;C=Cancelada;                          |
//|      D=Não aprovada;E=Aprovada;F=Bloqueada                       |
//+------------------------------------------------------------------+
//xParPerg(_cPerg)
CriaSX1(_cPerg)
//+------------------------------------------------------------------+
//|  Monta tela de paramentos para usuario, se cancelar sair         |
//+------------------------------------------------------------------+
If !Pergunte(_cPerg,.t.)  
	_lCancel := .T. 
   Return
Endif 
//+------------------------------------------------------------------+
//| Verifica se o operador esta logado na filail DR que tem acesso   |
//| a todas as filiais, ou somente na filial em que esta logada.     |
//+------------------------------------------------------------------+
If !(cFilAnt $ _cAceAll)
	Mv_par01	:= cFilAnt
	Mv_par02	:= cFilAnt
Endif 
//-- Defini o sub-titulo do Relatorio 
_cSubTit := " - Abertura [De: "+DtoC(Mv_par09)+"Ate: "+DtoC(Mv_par10)+"] "  
//+------------------------------------------------------------------+
//|   Seleciona a tabela temporaria que sera referencia              | 
//+------------------------------------------------------------------+
FWMsgRun(, {|| fGet333X() }, "Processando a Consulta das Agendas e Apontamentos!", "Aguarde...")
//+------------------------------------------------------------------+
//|    Construcao do Objeto de Impressao do Relatorio                |
//+------------------------------------------------------------------+
//                    New(cReport,cTitle,uParam,bAction,cDescription,lLandscape,uTotalText,lTotalInLine,cPageTText,lPageTInLine,lTPageBreak,nColSpace)
_oReport := TReport():New(_cPerg,_cTitulo,_cPerg,{|_oReport|  ReportPrint(_oReport) },_cSubTit,.t.)
_oReport:SetLandScape() 			//-- Modo Paisagem 
//&&--  _oReport:SetPortrait() 			//-- Modo Retrato 
//+------------------------------------------------------------------+
//|    *****      S e c a o  -  1      *****                         |
//+------------------------------------------------------------------+
_oPropos := TRSection():New(_oReport,"Propostas",{"ADY"} )
TRCell():New(_oPropos	,"ADY_FILIAL"	,"ADY" 	,"Filial"				,PesqPict("ADY","ADY_FILIAL")  	,TamSX3("ADY_FILIAL")[1]	,.F.) 
TRCell():New(_oPropos	,"ADY_PROPOS"	,"ADY" 	,"Proposta"			,PesqPict("ADY","ADY_PROPOS")  	,TamSX3("ADY_PROPOS")[1]	,.F.) 
TRCell():New(_oPropos	,"ADY_PREVIS"	,"ADY" 	,"Revisão"			,PesqPict("ADY","ADY_PREVIS")  	,TamSX3("ADY_PREVIS")[1]	,.F.)
TRCell():New(_oPropos	,"AD1_NROPOR"	,"AD1" 	,"Oportun."			,PesqPict("AD1","AD1_NROPOR")  	,TamSX3("AD1_NROPOR")[1]	,.F.)
TRCell():New(_oPropos	,"AD1STATUS"		,"" 		,"Situação"			,"@!"									,12								,.F.)
TRCell():New(_oPropos	,"AD1_DATA"		,"AD1" 	,"Abertura"			,PesqPict("AD1","AD1_DATA")  	,10								,.F.) 
TRCell():New(_oPropos	,"ADYVEND"		,"" 		,"Vendedor"			,"@!"									,30								,.F.) 
TRCell():New(_oPropos	,"ADY_DATA"		,"ADY" 	,"Visita"				,PesqPict("ADY","ADY_DATA")  	,10								,.F.)
TRCell():New(_oPropos	,"SA1_CGC"		,"SA1" 	,"CNPJ/CPF"			,"@!"									,20								,.F.)
TRCell():New(_oPropos	,"SA1CLIENTE"	,"" 		,"Cliente"			,"@!"									,60								,.F.)
TRCell():New(_oPropos	,"AD1XPOLO"		,"" 		,"Polo de Venda"	,"@!"									,30								,.F.)
TRCell():New(_oPropos	,"ADZ_DESCRI"	,"ADZ"		,"Prod. Ofertados"	,"@!"									,60								,.F.)
TRCell():New(_oPropos	,"ADYSTATUS"		,"ADY" 	,"Status"				,"@!"							 		,12								,.F.)
TRCell():New(_oPropos	,"AD1_DTASSI"	,"AD1" 	,"Assinatura"		,PesqPict("AD1","AD1_DTASSI")  	,10								,.F.)
Return _oReport

/*
+--------------------------------------------------------------------------+
 {Protheus.doc}<ReportPrint>
 33 - Relatorio das Propostas Comerciais   

@Author<Antonio Dsantas>
@since<14/04/2015>
@version<1.00>
@receive<Nil>
@return<Nil>
@example<Nil>
@see<Nil>
+--------------------------------------------------------------------------+
*/
Static Function ReportPrint(_oReport)
Local _oPropos		:= _oReport:Section(1)
Local _lReturn		:= .T. 
Local _nRecs			:= 0
Local _cTitulo		:= "STATUS da Proposta."				//-- Alltrim(Left(X5Descri(),20))
//-- 
Local _cDescVend	:= ""
Local _cCGC			:= ""
Local _cDescCli		:= ""
Local _cDescPolo	:= "" 
Local _cDescProd	:= ""
//-- 
Local _nSituac 		:= 0
Local _cTpSituac	:= "12EF"
Local _aSituac		:= {"1=Aberto","2=Perdido","E=Ganha SEM Pedido","F=Ganha COM Pedido"}
//-- 
Local _nStatus		:= 0
Local _cTpStatus	:= "ABCDEF"
Local _aStatus		:={	 "A=Em aberto"		,;
							 "B=Fechada"			,;
							 "C=Cancelada"		,;
							 "D=Não aprovada"	,;
							 "E=Aprovada"		,;
							 "F=Bloqueada"		 }
//+------------------------------------------------------------------+
//| Posiciona no inicio o Arquivo Resultado da Consulta Sql          | 
//+------------------------------------------------------------------+
dbSelectArea(_cAlias)  
(_cAlias)->(dbgotop())    
//-- Conta o numero do Registro da Tabela Temporaria
(_cAlias)->(dbEval({|| _nRecs++ }))
_oReport:SetMeter(_nRecs)
//-- 
dbSelectArea(_cAlias)  
(_cAlias)->(dbgotop())
//+------------------------------------------------------------------+
//| Inicia Laco para impressao do Relatorio                          |
//+------------------------------------------------------------------+
_oPropos:Init()
_oReport:SetLeftMargin(3)		//-- Seta a Margem a partir da posição 2
Do While (_cAlias)->(!eof())   
	_oReport:IncMeter()    
	//-- 
	dbSelectArea("SA1")
	SA1->(dbSetOrder(1))
	SA1->(dbSeek(FwxFilial("SA1")+(_cAlias)->ADY_CODIGO+(_cAlias)->ADY_LOJA))
	//-- 
	_cDescVend		:= Alltrim((_cAlias)->ADY_VEND)+"-"+Substr(Posicione("SA3",1,FwxFilial("SA3")+(_cAlias)->ADY_VEND,"A3_NOME"),1,20)
	_cCGC			:= Transform(SA1->A1_CGC,Iif(Len(AllTrim(SA1->A1_CGC))==11,"@R 999.999.999-99","@R 99.999.999/9999-99"))
	_cDescCli		:= (_cAlias)->ADY_CODIGO+"/"+(_cAlias)->ADY_LOJA+"-"+Substr(SA1->A1_NOME,1,40)
	_cDescPolo		:= Alltrim((_cAlias)->AD1_XPOLO)+"-"+Posicione("ZCD",1,FwxFilial("ZCD")+(_cAlias)->AD1_XPOLO,"ZCD_DESCRI") 
	_nSituac 		:= At((_cAlias)->AD1_STATUS,_cTpSituac)			//-- Verifica a Situação da OPORTUNIDADE 
	_nStatus 		:= At((_cAlias)->ADY_STATUS,_cTpStatus)			//-- Verifica a Situação da PROPOSTA 
	
	/*	Jose Leite - CSI 
		Concatenar o produto em uma coluna
	*/
	DbSelectArea('ADZ')
	ADZ->(DbSetOrder(3)) //ADZ_FILIAL+ADZ_PROPOS+ADZ_REVISA+ADZ_FOLDER+ADZ_ITEM
	ADZ->(DbSeek( (_cAlias)->ADY_FILIAL + (_cAlias)->ADY_PROPOS + (_cAlias)->ADY_PREVIS ))
	While .Not. ADZ->(Eof()) .And. ADZ->(ADZ_FILIAL + ADZ_PROPOS + ADZ_REVISA) == (_cAlias)->ADY_FILIAL + (_cAlias)->ADY_PROPOS + (_cAlias)->ADY_PREVIS
		If .Not. ( AllTrim(ADZ->ADZ_DESCRI) $ _cDescProd)
			_cDescProd += AllTrim(ADZ->ADZ_DESCRI) + " / "  
		EndIf
		ADZ->(DbSkip())
	End
	ADZ->(DbCloseArea())
	 
	//+------------------------------------------------------------------+
	//|  Imprime a IDENTIFICAÇÃO DO VENDEDOR                             |
	//+------------------------------------------------------------------+
	_oPropos:Cell( "ADY_FILIAL"	):SetBlock({|| (_cAlias)->ADY_FILIAL	}) 
	_oPropos:Cell( "ADY_PROPOS"	):SetBlock({|| (_cAlias)->ADY_PROPOS  	}) 
	_oPropos:Cell( "ADY_PREVIS"	):SetBlock({|| (_cAlias)->ADY_PREVIS  	})
	_oPropos:Cell( "AD1_NROPOR"	):SetBlock({|| (_cAlias)->AD1_NROPOR  	})
	_oPropos:Cell( "AD1STATUS"	):SetBlock({|| _aSituac[_nSituac]  	})
	_oPropos:Cell( "AD1_DATA"	):SetBlock({|| (_cAlias)->AD1_DATA  	}) 
	_oPropos:Cell( "ADYVEND"		):SetBlock({|| _cDescVend			  	}) 
	_oPropos:Cell( "ADY_DATA"	):SetBlock({|| (_cAlias)->ADY_DATA  	})
	_oPropos:Cell( "SA1_CGC"		):SetBlock({|| _cCGC  					})
	_oPropos:Cell( "SA1CLIENTE"	):SetBlock({|| _cDescCli  				})
	_oPropos:Cell( "AD1XPOLO"	):SetBlock({|| _cDescPolo  				})
	_oPropos:Cell( "ADZ_DESCRI"	):SetBlock({|| _cDescProd  				})
	_oPropos:Cell( "ADYSTATUS"	):SetBlock({|| _aStatus[_nStatus]		})
	_oPropos:Cell( "AD1_DTASSI"	):SetBlock({|| (_cAlias)->AD1DTASS  	})
	_oPropos:PrintLine()		//-- Imprime a Linha 
	//+------------------------------------------------------------------+
	//|  Vai para o Proximo Registro da TABELA TEMPORARIA                | 
	//|  ***Estabelece os Controles de Quebra                            |
	//+------------------------------------------------------------------+
	(_cAlias)->(dbskip()) 	
Enddo 
//+------------------------------------------------------------------+
//|     Finaliza todas as sessões por definitivo                     |
//+------------------------------------------------------------------+
_oPropos:Finish()
//+------------------------------------------------------------------+
//|     Fecha o Arquivo de Trabalho                                  |
//+------------------------------------------------------------------+
(_cAlias)->(dbCloseArea())
//+------------------------------------------------------------------+
//|     Finaliza as sessoes                                          |
//+------------------------------------------------------------------+
Return


/*
+--------------------------------------------------------------------------+
{Protheus.doc}<fGet332X>
 Monta query que busca as matriculas.

@Author<Antonio Dsantas>
@since<10/04/2015>
@version<1.00>
@receive<Nil>
@return<Nil>
@example<Nil>
@see<Nil>
+--------------------------------------------------------------------------+
*/
Static Function fGet333X()
Local _cQuery		:= "" 
_cQuery := ""
_cQuery += "Select  "+CRLF
_cQuery += "ADY.ADY_FILIAL, ADY.ADY_PROPOS, ADY.ADY_PREVIS, AD1.AD1_NROPOR, ADY.ADY_DATA, "+CRLF 
_cQuery += "AD1.AD1_DATA, ADY.ADY_VEND, ADY.ADY_CODIGO, ADY.ADY_LOJA, AD1.AD1_XPOLO, AD1.AD1_STATUS,  "+CRLF
_cQuery += "ADY.ADY_STATUS, (CASE WHEN ADY.ADY_STATUS= 'A' THEN AD1.AD1_DTASSI ELSE ' ' END) AS AD1DTASS "+CRLF
_cQuery += "From "+RetSqlName("ADY")+" ADY "+CRLF
_cQuery += "Inner Join "+RetSqlName("AD1")+" AD1 on AD1.D_E_L_E_T_ = ' '  "+CRLF 
_cQuery += "                      And AD1.AD1_FILIAL = ADY.ADY_FILIAL  "+CRLF
_cQuery += "                      And AD1.AD1_NROPOR = ADY.ADY_OPORTU  "+CRLF
//-- Mv_par13 =     SITUAÇÃO DA OPORTUNIDADE 
//-- *1=Aberto;2=Perdido;3=Ganha SEM Pedido;9=Ganha COM Pedido
If !Empty(Alltrim(Mv_par13))
	_cQuery += "                      And AD1.AD1_STATUS in "+FormatIn(Mv_par13,";")+" "+CRLF
Endif 
_cQuery += "                      And AD1.AD1_DTASSI Between '"+Dtos(Mv_par11)+"' And '"+Dtos(Mv_par12)+"' "+CRLF
_cQuery += "                      And AD1.AD1_XPOLO Between '"+Mv_par03+"' And '"+Mv_par04+"' "+CRLF
_cQuery += "Where ADY.D_E_L_E_T_ = ' '  "+CRLF 
_cQuery += "And ADY.ADY_FILIAL BetWeen '"+Mv_par01+"' And '"+Mv_par02+"' "+CRLF
_cQuery += "And Substr(ADY.ADY_FILIAL,1,4) = '"+Substr(cFilAnt,1,4)+"' "+CRLF
_cQuery += "And ADY.ADY_DATA Between '"+Dtos(Mv_par09)+"' And '"+Dtos(Mv_par10)+"' "+CRLF
_cQuery += "And ADY.ADY_VEND Between '"+Mv_par05+"' And '"+Mv_par06+"' "+CRLF
_cQuery += "And ADY.ADY_CODIGO Between  '"+Mv_par07+"' And '"+Mv_par08+"' "+CRLF
//-- Mv_par14 =     STATUS DA PROPOSTA ?
//-- *A=Em aberto;B=Fechada;C=Cancelada;D=Não aprovada;E=Aprovada;F=Bloqueada
If !Empty(Alltrim(Mv_par14))
	_cQuery += "                      And ADY.ADY_STATUS in "+FormatIn(Mv_par14,";")+" "+CRLF
Endif 
//+------------------------------------------------------------------+
//| Antonio Dantas                                        15/12/2015 |
//| Atende Aditivo de 04/12/2015: Implementa Filtros na consulta     |
//| por [Tipo de Produto] e [Grupo de Produtos]                      |
//+------------------------------------------------------------------+
_cQuery += "And Exists ( Select *From "+RetSqlName("ADZ")+" ADZ "+CRLF
_cQuery += "            Inner Join "+RetSqlName("SB1")+" SB1 on SB1.D_E_L_E_T_ = ' ' "+CRLF
_cQuery += "                                  And SB1.B1_COD = ADZ.ADZ_PRODUT "+CRLF
_cQuery += "                                  And SB1.B1_TIPO Between '"+Mv_par15+"' And '"+Mv_par16+"' "+CRLF   
_cQuery += "                                  And SB1.B1_GRUPO Between '"+Mv_par17+"' And '"+Mv_par18+"' "+CRLF 
_cQuery += "            Where ADZ.D_E_L_E_T_ = ' ' "+CRLF
_cQuery += "            And ADZ.ADZ_FILIAL = ADY.ADY_FILIAL "+CRLF  
_cQuery += "            And ADZ.ADZ_PROPOS = ADY.ADY_PROPOS "+CRLF      
_cQuery += "            ) 
_cQuery += "Order by ADY.ADY_FILIAL, ADY.ADY_DATA, ADY.ADY_VEND, ADY.ADY_CODIGO, ADY.ADY_LOJA, AD1.AD1_NROPOR, ADY.ADY_PROPOS, ADY.ADY_PREVIS"+CRLF 
//+------------------------------------------------------------------+
//| Grava o Resultado da Query para consulta                         |
//+------------------------------------------------------------------+
MemoWrite("C:\temp\"+FunName()+"_"+ProcName()+".TXT",_cQuery)
If Select(_cAlias)>0
	(_cAlias)->(DbCloseArea())
Endif
DbUseArea(.t.,"TOPCONN",TcGenQry(,,_cQuery),_cAlias,.t.,.t.)
//+------------------------------------------------------------------+
//| Converte os campos tipo DATA                                     |
//+------------------------------------------------------------------+
TCSETFIELD( _cAlias, "AD1_DATA"		,"D",8,0 ) 
TCSETFIELD( _cAlias, "ADY_DATA"		,"D",8,0 )
TCSETFIELD( _cAlias, "AD1DTASS"		,"D",8,0 )
Return .t.

/*
--------------------------------------------------------------------------------
{Protheus.doc} <xParPerg>
 Cria as perguntas.	  

@author<Antonio Dantas>
@since<13/02/2015>
@version<1.00>
@receive<Nil>
@return<Nil>
@example<Nil>
@see<Nil>
--------------------------------------------------------------------------------
*/
Static Function xParPerg()	
Local _aPerg := {}
//*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*
//*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*
//   //-- MAPEAMENTOS DOS CAMPOS DE SX1
//   aAdd (_aPerg,{"X1_PERGUNT","X1_PERPA","X1_PERENG","MV_CHL","C",5,0,0,"X1_GSC","X1_VALID",;
//								"X1_VAR01",("X1_DEF01" e "X1_PYNE"),"X1_DEFSPA1","X1_DEFENG1","X1_CNT01",;
//								"X1_VAR02","X1_DEF02","X1_DEFSPA2","X1_DEFENG2","X1_CNT02",;
//								"X1_VAR03","X1_DEF03","X1_DEFSPA3","X1_DEFENG3","X1_CNT03",;
//								"X1_VAR04","X1_DEF04","X1_DEFSPA4","X1_DEFENG4","X1_CNT04",;
//								"X1_VAR05","X1_DEF05","X1_DEFSPA5","X1_DEFENG5","X1_CNT05",;
//								"X1_F3","X1_GRPSXG","","X1_HELP","X1_PICTURE",{"Descricao para Tela PTG"},{"Descricao para Tela EPA"},{"Descricao para Tela USA"}})
//*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*
//*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*&*
//+------------------------------------------------------------------+
//| Verifica se o operador esta logado na filail DR que tem acesso   |
//| a todas as filiais, ou somente na filial em que esta logada.     |
//+------------------------------------------------------------------+
//-- Mv_par01 =     Filial DE?
aAdd(_aPerg, {"Filial DE?","Filial DE?","Filial DE?","MV_CH1","C",TamSX3("AD5_FILIAL")[1],0,0,"G","u_fVldfil()",;
					"MV_PAR01","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SM0EPU","","","","",{"Codigo da Filial"},{"Codigo da Filial"},{"Codigo da Filial"}})

//-- Mv_par02 =     Filial ATE?
aAdd(_aPerg, {"Filial ATE?","Filial ATE?","Filial ATE?","MV_CH2","C",TamSX3("AD5_FILIAL")[1],0,0,"G","u_fVldfil()",;
					"MV_PAR02","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SM0EPU","","","","",{"Codigo da Filial"},{"Codigo da Filial"},{"Codigo da Filial"}})

//-- Mv_par03 =     Polo de Venda DE?
aAdd(_aPerg, {"Polo de Venda DE?","Polo de Venda DE?","Polo de Venda DE?","MV_CH3","C",TamSX3("AD7_XPOLO")[1],0,0,"G","",;
					"MV_PAR03","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"ZCD","","","","",{"Cod do Polo de Venda DE"},{"Cod do Polo de Venda DE"},{"Cod do Polo de Venda DE"}})

//-- Mv_par04 =     Polo de Venda ATE?
aAdd(_aPerg, {"Polo de Venda ATE?","Polo de Venda ATE?","Polo de Venda ATE?","MV_CH4","C",TamSX3("AD7_XPOLO")[1],0,0,"G","",;
					"MV_PAR04","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"ZCD","","","","",{"Cod do Polo de Venda ATE"},{"Cod do Polo de Venda ATE"},{"Cod do Polo de Venda ATE"}})

//-- Mv_par05 =     Vendedor DE?
aAdd(_aPerg, {"Vendedor DE?","Vendedor DE?","Vendedor DE?","MV_CH5","C",TamSX3("A3_COD")[1],0,0,"G","",;
					"MV_PAR05","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SA3","","","","",{"Codigo do Vendedor"},{"Codigo do Vendedor"},{"Codigo do Vendedor"}})

//-- Mv_par06 =     Vendedor ATE?
aAdd(_aPerg, {"Vendedor ATE?","Vendedor ATE?","Vendedor ATE?","MV_CH6","C",TamSX3("A3_COD")[1],0,0,"G","",;
					"MV_PAR06","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SA3","","","","",{"Codigo do Vendedor"},{"Codigo do Vendedor"},{"Codigo do Vendedor"}})

//-- Mv_par07 =     Cliente DE?
aAdd(_aPerg, {"Cliente DE?","Cliente DE?","Cliente DE?","MV_CH7","C",TamSX3("A1_COD")[1],0,0,"G","",;
					"MV_PAR07","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SA1","","","","",{"Codigo do Cliente"},{"Codigo do Cliente"},{"Codigo do Cliente"}})

//-- Mv_par08 =     Cliente ATE?
aAdd(_aPerg, {"Cliente ATE?","Cliente ATE?","Cliente ATE?","MV_CH8","C",TamSX3("A1_COD")[1],0,0,"G","",;
					"MV_PAR08","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SA1","","","","",{"Codigo do Cliente"},{"Codigo do Cliente"},{"Codigo do Cliente"}})     

//-- Mv_par09 =     Data de Abertura DE ?
aAdd(_aPerg, {"Data de Abertura DE ?","Data de Abertura DE ?","Data de Abertura DE ?","MV_CH9","D",8,0,0,"G","",;
					"MV_PAR09","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",{"Data de Abertura DE ?"},{"Data de Abertura DE ?"},{"Data de Abertura DE ?"}})

//-- Mv_par10 =     Data de Abertura ATE ?
aAdd(_aPerg, {"Data de Abertura ATE ?","Data de Abertura ATE ?","Data de Abertura ATE ?","MV_CHA","D",8,0,0,"G","",;
					"MV_PAR10","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",{"Data de Abertura ATE ?"},{"Data de Abertura ATE ?"},{"Data de Abertura ATE ?"}})

//-- Mv_par11 =     Data da Assinatura DE ?
aAdd(_aPerg, {"Data da Assinatura DE ?","Data da Assinatura DE ?","Data da Assinatura DE ?","MV_CHB","D",8,0,0,"G","",;
					"MV_PAR11","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",{"Data da Assinatura DE ?"},{"Data da Assinatura DE ?"},{"Data da Assinatura DE ?"}})

//-- Mv_par12 =     Data da Assinatura ATE ?
aAdd(_aPerg, {"Data da Assinatura ATE ?","Data da Assinatura ATE ?","Data da Assinatura ATE ?","MV_CHC","D",8,0,0,"G","",;
					"MV_PAR12","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",{"Data da Assinatura ATE ?"},{"Data da Assinatura ATE ?"},{"Data da Assinatura ATE ?"}})

//-- Mv_par13 =     Situação da Oport ?
//-- *1=Aberto;2=Perdido;3=Suspenso;9=Encerrado
aAdd(_aPerg, {"Situação Oportunidade ?","Situação Oportunidade ?","Situação Oportunidade ?","MV_CHD","C",99,0,0,"G","u_MrkAD1()",;
					"MV_PAR13","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",{"'Range' Situação Oportunidade separados por (;) Ponto-e-virgula "},{"'Range' dos Situação Oportunidade separados por (;) Ponto-e-virgula "},{"'Range' dos Situação Oportunidade separados por (;) Ponto-e-virgula "}})

//-- Mv_par14 =     Status Proposta ?
//-- *A=Em aberto;B=Fechada;C=Cancelada;D=Não aprovada;E=Aprovada;F=Bloqueada
aAdd(_aPerg, {"Status Proposta ?","Status Proposta ?","Status Proposta ?","MV_CHE","C",99,0,0,"G","u_MrkADY()",;
					"MV_PAR14","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",{"'Range' Status Proposta separados por (;) Ponto-e-virgula "},{"'Range' dos Status Proposta separados por (;) Ponto-e-virgula "},{"'Range' dos Status Proposta separados por (;) Ponto-e-virgula "}})

//-- Mv_par15 =     Tipo de Produto DE ?
aAdd(_aPerg, {"Tipo de Produto DE ?","Tipo de Produto DE ?","Tipo de Produto DE ?","MV_CHF","C",2,0,0,"G","",;
					"MV_PAR15","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"02","","","","",{"Tipo de Produto ?"},{"Tipo de Produto ?"},{"Tipo de Produto ?"}})

//-- Mv_par16 =     Tipo de Produto ATE ?
aAdd(_aPerg, {"Tipo de Produto ATE ?","Tipo de Produto ATE ?","Tipo de Produto ATE ?","MV_CHG","C",2,0,0,"G","",;
					"MV_PAR16","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"02","","","","",{"Tipo de Produto ?"},{"Tipo de Produto ?"},{"Tipo de Produto ?"}})

//-- Mv_par17 =     Grupo de Produto DE ?
aAdd(_aPerg, {"Grupo de Produto DE ?","Grupo de Produto DE ?","Grupo de Produto DE ?","MV_CHH","C",4,0,0,"G","",;
					"MV_PAR17","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SBM","","","","",{"Grupo de Produto ?"},{"Grupo de Produto ?"},{"Grupo de Produto ?"}})


//-- Mv_par18 =     Grupo de Produto ATE ?
aAdd(_aPerg, {"Grupo de Produto ATE ?","Grupo de Produto ATE ?","Grupo de Produto ATE ?","MV_CHI","C",4,0,0,"G","",;
					"MV_PAR18","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"","","","","",;
					"SBM","","","","",{"Grupo de Produto ?"},{"Grupo de Produto ?"},{"Grupo de Produto ?"}})

u_SFAJUSX1(_cPerg,_aPerg) 
Return 

/*/{Protheus.doc} CriaSx1
	Função para criar as perguntas/parâmetros de relatório
	
@author Franklin B. Oliveira
@since 26/04/2018
@param cPerg, characters, grupo de perguntas 
@type function
/*/
Static Function CriaSx1(cPerg)

	Local nI		:= 0
	Local nJ		:= 0
	Local lSX1		:= .F.
	Local aSaveArea	:= GetArea()
	Local aPergs	:= {}
	Local aEstrut	:= {}
	Local aHelpEng	:= {}
	Local aHelpSpa	:= {}
	Local aHelpPor	:= {}
	
	//				X1_GRUPO   X1_ORDEM   X1_PERGUNT X1_PERSPA X1_PERENG  X1_VARIAVL X1_TIPO    X1_TAMANHO X1_DECIMAL X1_PRESEL
	//				X1_GSC     X1_VALID   X1_VAR01   X1_DEF01  X1_DEFSPA1 X1_DEFENG1 X1_CNT01   X1_VAR02   X1_DEF02
	//				X1_DEFSPA2 X1_DEFENG2 X1_CNT02   X1_VAR03  X1_DEF03   X1_fDEFSPA3 X1_DEFENG3 X1_CNT03   X1_VAR04   X1_DEF04
	// 				X1_DEFSPA4 X1_DEFENG4 X1_CNT04   X1_VAR05  X1_DEF05   X1_DEFSPA5 X1_DEFENG5 X1_CNT05   X1_F3      X1_GRPSXG X1_PYME
	
	aEstrut := { "X1_GRUPO","X1_ORDEM"  ,"X1_PERGUNT","X1_PERSPA" ,"X1_PERENG" ,"X1_VARIAVL","X1_TIPO" ,"X1_TAMANHO","X1_DECIMAL","X1_PRESEL" ,;
	"X1_GSC"    ,"X1_VALID","X1_VAR01"  ,"X1_DEF01"  ,"X1_DEFSPA1","X1_DEFENG1","X1_CNT01","X1_VAR02"  ,"X1_DEF02"  ,"X1_DEFSPA2",;
	"X1_DEFENG2","X1_CNT02","X1_VAR03"  ,"X1_DEF03"  ,"X1_DEFSPA3","X1_DEFENG3","X1_CNT03","X1_VAR04"  ,"X1_DEF04"  ,"X1_DEFSPA4",;
	"X1_DEFENG4","X1_CNT04","X1_VAR05"  ,"X1_DEF05"  ,"X1_DEFSPA5","X1_DEFENG5","X1_CNT05","X1_F3"     ,"X1_GRPSXG" ,"X1_PYME"}
	
	//-- Mv_par01 =     Filial DE?
	aAdd(aPergs,{cPerg,"01","Filial DE?","","","MV_CH1","C",TamSX3("AD5_FILIAL")[1],00,00,"G","u_fVldfil()","MV_PAR01","","","","","","","","","","","","","","","","","","","","","","","","","SM0EPU",""})
	
	//-- Mv_par02 =     Filial ATE?
	aAdd(aPergs,{cPerg,"02","Filial ATE?","","","MV_CH2","C",TamSX3("AD5_FILIAL")[1],00,00,"G","u_fVldfil()","MV_PAR02","","","","","","","","","","","","","","","","","","","","","","","","","SM0EPU",""})
	
	//-- Mv_par03 =     Polo de Venda DE?
	aAdd(aPergs,{cPerg,"03","Polo de Venda DE?","","","MV_CH3","C",TamSX3("AD7_XPOLO")[1],00,00,"G","","MV_PAR03","","","","","","","","","","","","","","","","","","","","","","","","","ZCD",""})

	//-- Mv_par04 =     Polo de Venda ATE?
	aAdd(aPergs,{cPerg,"04","Polo de Venda ATE?","","","MV_CH4","C",TamSX3("AD7_XPOLO")[1],00,00,"G","","MV_PAR04","","","","","","","","","","","","","","","","","","","","","","","","","ZCD",""})   
	
	//-- Mv_par05 =     Vendedor DE?
	aAdd(aPergs,{cPerg,"05","Vendedor DE?","","","MV_CH5","C",TamSX3("A3_COD")[1],00,00,"G","","MV_PAR05","","","","","","","","","","","","","","","","","","","","","","","","","SA3",""})
	
	//-- Mv_par06 =     Vendedor ATE?
	aAdd(aPergs,{cPerg,"06","Vendedor ATE?","","","MV_CH6","C",TamSX3("A3_COD")[1],00,00,"G","","MV_PAR06","","","","","","","","","","","","","","","","","","","","","","","","","SA3",""})
	
	//-- Mv_par07 =     Cliente DE?
	aAdd(aPergs,{cPerg,"07","Cliente DE?","","","MV_CH7","C",TamSX3("A1_COD")[1],00,00,"G","","MV_PAR07","","","","","","","","","","","","","","","","","","","","","","","","","SA1",""})
	
	//-- Mv_par08 =     Cliente ATE?
	aAdd(aPergs,{cPerg,"08","Cliente ATE?","","","MV_CH8","C",TamSX3("A1_COD")[1],00,00,"G","","MV_PAR08","","","","","","","","","","","","","","","","","","","","","","","","","SA1",""})
	
	//-- Mv_par09 =     Data de Abertura DE ?
	aAdd(aPergs,{cPerg,"09","Data de Abertura DE ?","","","MV_CH9","D",08,00,00,"G","","MV_PAR09","","","","","","","","","","","","","","","","","","","","","","","","","",""})
	
	//-- Mv_par10 =     Data de Abertura ATE ?
	aAdd(aPergs,{cPerg,"10","Data de Abertura ATE ?","","","MV_CHA","D",08,00,00,"G","","MV_PAR10","","","","","","","","","","","","","","","","","","","","","","","","","",""})
	
	//-- Mv_par11 =     Data da Assinatura DE ?
	aAdd(aPergs,{cPerg,"11","Data da Assinatura DE ?","","","MV_CHB","D",08,00,00,"G","","MV_PAR11","","","","","","","","","","","","","","","","","","","","","","","","","",""})
	
	//-- Mv_par12 =     Data da Assinatura ATE ?
	aAdd(aPergs,{cPerg,"12","Data da Assinatura ATE ?","","","MV_CHC","D",08,00,00,"G","","MV_PAR12","","","","","","","","","","","","","","","","","","","","","","","","","",""})
	
	//-- Mv_par13 =     Situação da Oport ?
	aAdd(aPergs,{cPerg,"13","Situação Oportunidade ?","","","MV_CHD","C",99,00,00,"G","u_MrkAD1()","MV_PAR13","","","","","","","","","","","","","","","","","","","","","","","","","",""})
	
	//-- Mv_par14 =     Status Proposta ?
	aAdd(aPergs,{cPerg,"14","Status Proposta ?","","","MV_CHE","C",99,00,00,"G","u_MrkADY()","MV_PAR14","","","","","","","","","","","","","","","","","","","","","","","","","",""})
	
	//-- Mv_par15 =     Tipo de Produto DE ?
	aAdd(aPergs,{cPerg,"15","Tipo de Produto DE ?","","","MV_CHF","C",02,00,00,"G","","MV_PAR15","","","","","","","","","","","","","","","","","","","","","","","","","02",""})
	
	//-- Mv_par16 =     Tipo de Produto ATE ?
	aAdd(aPergs,{cPerg,"16","Tipo de Produto ATE ?","","","MV_CHG","C",02,00,00,"G","","MV_PAR16","","","","","","","","","","","","","","","","","","","","","","","","","02",""})
	
	//-- Mv_par17 =     Grupo de Produto DE ?
	aAdd(aPergs,{cPerg,"17","Grupo de Produto DE ?","","","MV_CHH","C",04,00,00,"G","","MV_PAR17","","","","","","","","","","","","","","","","","","","","","","","","","SBM",""})
	
	//-- Mv_par18 =     Grupo de Produto ATE ?
	aAdd(aPergs,{cPerg,"18","Grupo de Produto ATE ?","","","MV_CHI","C",04,00,00,"G","","MV_PAR18","","","","","","","","","","","","","","","","","","","","","","","","","SBM",""})   
	
	ProcRegua(Len(aPergs))
	dbSelectArea("SX1")
	dbSetOrder(1)
	IF ! dbSeek(cPerg)
		For nI:= 1 To Len(aPergs)
			If !Empty(aPergs[nI][1])
				If !dbSeek(aPergs[nI,1]+aPergs[nI,2])
					lSX1 := .T.
					RecLock("SX1",.T.)
					For nJ:=1 To Len(aPergs[nI])
						If !Empty(FieldName(FieldPos(aEstrut[nJ])))
							FieldPut(FieldPos(aEstrut[nJ]),aPergs[nI,nJ])
						EndIf
					Next nJ
					MsUnLock()
					dbCommit()
					IncProc("Atualizando Perguntas de Relatorios" + "...")		//"Atualizando Perguntas de Relatorios"
				EndIf
			EndIf
		Next nI
	EndIf
	
	/*
	Inclusao do "help" 
	*/
	AADD(aHelpPor,"Codigo da Filial")
	AADD(aHelpPor,"Codigo da Filial")
	AADD(aHelpPor,"Cod do Polo de Venda DE")
	AADD(aHelpPor,"Cod do Polo de Venda ATE")
	AADD(aHelpPor,"Codigo do Vendedor")
	AADD(aHelpPor,"Codigo do Vendedor")
	AADD(aHelpPor,"Codigo do Cliente")
	AADD(aHelpPor,"Codigo do Cliente")
	AADD(aHelpPor,"Data de Abertura DE ?")
	AADD(aHelpPor,"Data de Abertura ATE ?")
	AADD(aHelpPor,"Data da Assinatura DE ?")
	AADD(aHelpPor,"Data da Assinatura ATE ?")
	AADD(aHelpPor,"'Range' Situação Oportunidade separados por (;) Ponto-e-virgula ")
	AADD(aHelpPor,"'Range' Status Proposta separados por (;) Ponto-e-virgula ")
	AADD(aHelpPor,"Tipo de Produto ?")
	AADD(aHelpPor,"Tipo de Produto ?")
	AADD(aHelpPor,"Grupo de Produto ?")
	AADD(aHelpPor,"Grupo de Produto ?")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	
	PutSX1Help("P." + cPerg + "01.",aHelpPor,aHelpEng,aHelpSpa,.T.)
	AHelpPor := {}
	AHelpEng := {}
	AHelpSpa := {}
	/*..*/
	AADD(aHelpPor,"Codigo da Filial")
	AADD(aHelpPor,"Codigo da Filial")
	AADD(aHelpPor,"Cod do Polo de Venda DE")
	AADD(aHelpPor,"Cod do Polo de Venda ATE")
	AADD(aHelpPor,"Codigo do Vendedor")
	AADD(aHelpPor,"Codigo do Vendedor")
	AADD(aHelpPor,"Codigo do Cliente")
	AADD(aHelpPor,"Codigo do Cliente")
	AADD(aHelpPor,"Data de Abertura DE ?")
	AADD(aHelpPor,"Data de Abertura ATE ?")
	AADD(aHelpPor,"Data da Assinatura DE ?")
	AADD(aHelpPor,"Data da Assinatura ATE ?")
	AADD(aHelpPor,"'Range' Situação Oportunidade separados por (;) Ponto-e-virgula ")
	AADD(aHelpPor,"'Range' Status Proposta separados por (;) Ponto-e-virgula ")
	AADD(aHelpPor,"Tipo de Produto ?")
	AADD(aHelpPor,"Tipo de Produto ?")
	AADD(aHelpPor,"Grupo de Produto ?")
	AADD(aHelpPor,"Grupo de Produto ?")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	AHelpPor := {}
	AHelpEng := {}
	AHelpSpa := {}
	/*..*/
	AADD(aHelpPor,"Codigo da Filial")
	AADD(aHelpPor,"Codigo da Filial")
	AADD(aHelpPor,"Cod do Polo de Venda DE")
	AADD(aHelpPor,"Cod do Polo de Venda ATE")
	AADD(aHelpPor,"Codigo do Vendedor")
	AADD(aHelpPor,"Codigo do Vendedor")
	AADD(aHelpPor,"Codigo do Cliente")
	AADD(aHelpPor,"Codigo do Cliente")
	AADD(aHelpPor,"Data de Abertura DE ?")
	AADD(aHelpPor,"Data de Abertura ATE ?")
	AADD(aHelpPor,"Data da Assinatura DE ?")
	AADD(aHelpPor,"Data da Assinatura ATE ?")
	AADD(aHelpPor,"'Range' Situação Oportunidade separados por (;) Ponto-e-virgula ")
	AADD(aHelpPor,"'Range' Status Proposta separados por (;) Ponto-e-virgula ")
	AADD(aHelpPor,"Tipo de Produto ?")
	AADD(aHelpPor,"Tipo de Produto ?")
	AADD(aHelpPor,"Grupo de Produto ?")
	AADD(aHelpPor,"Grupo de Produto ?")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpSpa,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	Aadd(aHelpEng,"")
	PutSX1Help("P." + cPerg + "03.",aHelpPor,aHelpEng,aHelpSpa,.T.)
	AHelpPor := {}
	AHelpEng := {}
	AHelpSpa := {} 
	
	RestArea(aSaveArea)
	
Return