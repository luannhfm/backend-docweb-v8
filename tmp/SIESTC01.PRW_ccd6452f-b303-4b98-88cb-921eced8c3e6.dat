#Include "Protheus.ch"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³SIESTC01   ºAutor  ³Thiago L. Dyonisio º Data ³  28/09/12   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Rotina para mostrar os gestores amarrados ao contrato       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ CNI - SISTEMA INDÚSTRIA                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function SIESTC01()
Local   _aArea     := GetArea()
Private _aGestores := {} // Vetor que receberá as informações
Private   _cQuery    := ""
Private   _cArqTRB   := CriaTrab(nil,.f.)//Cria um arquivo sem estrutura

_cQuery := "SELECT * FROM "+RetSqlName("CNN")+" WHERE D_E_L_E_T_ = ' ' AND "
_cQuery += "CNN_FILIAL = '"+XFilial("CNN")+"' AND CNN_CONTRA = '"+CN9->CN9_NUMERO+"'"
_cQuery := ChangeQuery(_cQuery)

dbUseArea(.T.,"TOPCONN",TCGenQry(,,_cQuery),_cArqTRB,.t.,.t.)

While (_cArqTRB)->(!Eof())
	
//	Aadd(_aGestores,{(_cArqTRB)->CNN_USRCOD,UsrRetName((_cArqTRB)->CNN_USRCOD)})
	Aadd(_aGestores,{(_cArqTRB)->CNN_FILIAL,(_cArqTRB)->CNN_CONTRA,(_cArqTRB)->CNN_USRCOD,UsrRetName((_cArqTRB)->CNN_USRCOD)})
	
	(_cArqTRB)->(dbSkip())
Enddo

(_cArqTRB)->(dbCloseArea())
FErase(_cArqTRB+GetDBExtension())// Deleta a área temporária
FErase(_cArqTRB+OrdBagExt())// Deleta o índice
RestArea(_aArea)

_ESTC01Say(_aGestores)

Return()

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³_ESTC01Say   ºAutor  ³Thiago L. Dyonisio Data ³  28/09/12   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para montar tela com ListBox com as informações     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ CNI - SISTEMA INDÚSTRIA                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function _ESTC01Say()  

Local _oDlg
Local _oLbx

DEFINE MSDIALOG _oDlg TITLE "Gestores por Edital" FROM 0,0 TO 240,500 PIXEL

   @ 10,10 LISTBOX _oLbx FIELDS HEADER ;
   "Filial", "Contrato", "Cód.Gestor", "Nome do Gestor" ;
   SIZE 230,95 OF _oDlg PIXEL	

  _oLbx:SetArray( _aGestores )
  _oLbx:bLine := {|| {_aGestores[_oLbx:nAt,1],;
                      _aGestores[_oLbx:nAt,2],;
	                  _aGestores[_oLbx:nAt,3],;
                      _aGestores[_oLbx:nAt,4]}}
	                    
DEFINE SBUTTON FROM 107,213 TYPE 1 ACTION _oDlg:End() ENABLE OF _oDlg
ACTIVATE MSDIALOG _oDlg CENTER

Return()