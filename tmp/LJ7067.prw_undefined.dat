#INCLUDE 'PROTHEUS.CH'


/*/{Protheus.doc} LJ7067
@description Ponto de entrada no final do fechamento automatico do caixa apos a Reducao Z.
@obs Utilizado para automatizar o lançamento do valor de sangria dos caixas com valor total movimentado no dia e controle dos valores digitados no cartão de credito e debito.
@type User Function
@author Alan Teles de Oliveira
@since 11/01/2019
@version 11.8
@history 10/02/2020, Franklin B. Oliveira, Correção para registrar as informações apenas quando houver confirmação do fechamento.
/*/
User Function LJ7067()

    Local lRet := .T.

    If cFilAnt = '02MT0012'
    
	    If lRetPanel .and. Type('_nVCC') == 'N' .and. Type('_nVCD') == 'N' .and. Type('_nVSangr') == 'N'
	
	        If SA6->A6_COD == cCaixa
	            RecLock('SA6', .F.)
	            SA6->A6_XDTULFC := dDataBase
	            SA6->A6_XSCCUFC := _nVCC
	            SA6->A6_XSCDUFC := _nVCD
	            SA6->(MsUnLock())
	        EndIf    
	
	        lRet := Frt050SE5(1, cCodOrigem, cCodDestin, _nVSangr, 0, 0, 0, 0, 0, 0, 0, {}, .F., .T.)
	
	        If .not. lRet 
	            MsgInfo('Problemas no lançamento da sangria, acione a CTINF.', 'Atenção - LJ35001')
	        EndIf        
	
	    EndIf
    
    EndIf
    
Return 
