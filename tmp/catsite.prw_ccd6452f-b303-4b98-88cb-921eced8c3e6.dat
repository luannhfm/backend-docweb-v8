#include "totvs.ch"
#include "restful.ch"

//-------------------------------------------------------------------
/*/{Protheus.doc} products
Declaração do ws producs
@author SERGIO SALUSTIANO
@since 25/04/2019
@version 1.0
/*/
//-------------------------------------------------------------------
WSRESTFUL catsite DESCRIPTION 'endpoint  Categoria Site API' FORMAT "application/json,text/html"
    WSDATA Page                   AS INTEGER OPTIONAL
    WSDATA aQueryString      AS ARRAY    OPTIONAL
    
 	WSMETHOD GET CatList;
	    DESCRIPTION "Retorna uma lista com a Categori Site";
	    WSSYNTAX "/api/sti/catsite" ;
        PATH "/api/sti/catsite" ;
	    PRODUCES APPLICATION_JSON
 	
END WSRESTFUL
//-------------------------------------------------------------------
/*/{Protheus.doc} GET ProdList
Método GET com id ProdList
@author SERGIO SALUSTIANO
@since 25/04/2019
@version 1.0
/*/
//-------------------------------------------------------------------
WSMETHOD GET CatList QUERYPARAM Page WSREST catsite
Return getCatList(self)
//-------------------------------------------------------------------
/*/{Protheus.doc} GET getPrdList
Função para tratamento da requisição GET
@author SERGIO SALUSTIANO
@since 25/04/2019
@version 1.0
/*/
//-------------------------------------------------------------------
Static Function getCatList( oWS )
   Local lRet  as logical
   Local oCateg as object
   DEFAULT oWS:Page      := 1  
   lRet        := .T.
   
   oCateg := CatAdapter():new( 'GET' )
   oCateg:setPage(oWS:Page)
   oCateg:setPageSize(10)
   oCateg:setUrlFilter(oWS:aQueryString)
   oCateg:GetListCat()
   //Se tudo ocorreu bem, retorna os dados via Json
   If oCateg:lOk
       //oWS:SetResponse(oCateg:getJSONResponse())
       oWS:SetResponse(EncodeUTF8(oCateg:getJSONResponse(),"cp1252"))
   Else
   //Ou retorna o erro encontrado durante o processamento
       SetRestFault(oCateg:GetCode(),oCateg:GetMessage())
       lRet := .F.
   EndIf
   //faz a desalocação de objetos e arrays utilizados
   oCateg:DeActivate()
   oCateg := nil
   
Return lRet
