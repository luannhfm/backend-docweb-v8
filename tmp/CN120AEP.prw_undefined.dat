#INCLUDE "protheus.ch" 
      
/*/{Protheus.doc} CN120AEP
@description Ponto de entrada para alterar a filial corrente antes do processamento da exclusão do pedido de compra
@type  Function
@author Bruna Paola 
@since 30/01/2012
@version 11.0
@hirtory 19/02/2016, Walmir Junior, Recuperar a Filial do item da medição. O Loop é apenas para posicionar no item que possui vinculo com SC.
@hirtory 19/02/2016, Walmir Junior, Altera Filial se for diferente da atual.
@hirtory 06/02/2019, Alan Teles de Oliveira, no while da CNE verifico se ainda esta posicionado na medição correta e saio o loop caso CNE_XFILSC seja diferente de vazio.
/*/
User Function CN120AEP()

	Local cFilCNE 	:= ''
	Local cNumMed 	:= ''
	Local _aAreaCNE	:= GetArea()

	If Empty(CNE->CNE_XFILSC)

		cFilCNE := CNE->CNE_FILIAL
		cNumMed := CNE->CNE_NUMMED

		DBSelectArea("CNE")

		CNE->(dbGoTop())
		CNE->(dbSetOrder(4))
		CNE->(dbseek(cFilCNE + cNumMed))
		
		While .not. CNE->(Eof()) .and. CNE->CNE_FILIAL = cFilCNE .and. CNE->CNE_NUMMED = cNumMed

			If .not. Empty(CNE->CNE_XFILSC)
				Exit
			EndIf

			CNE->(dbSkip())

		EndDo

	EndIf
	
	If !Empty(CNE->CNE_XFILSC) .And. cFilAnt != CNE->CNE_XFILSC
		U_SF0205X(cEmpAnt, CNE->CNE_XFILSC)
	EndIf

	RestArea(_aAreaCNE)
		
Return .T.
