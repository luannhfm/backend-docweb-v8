#INCLUDE "protheus.ch"
/*
--------------------------------------------------------------------------------
{Protheus.doc} <CN120ENVL>
   Ponto-de-Entrada para validar o encerramento da medição, chamado logo
   no botão de confirmação de medição na rotina CNTA120.PRW 
   --------------------------------------------------------------------------
    Antonio Dantas                                          21/08/2015
     Não permite o ENCERRAMENTO de medição em CONTRATOS COMPARTILHADOS
     pela rotina PADRÃO, o operador devera utilizar a Rotina Customizada
     para executar ENCERRAMENTO em CONTRATOS COMPARTILHADOS.  
   --------------------------------------------------------------------------
    Walmir junior                                          04/02/2016
     Valida se o a rotina está sendo executada por rotina automática se sim,  
     não permite o encerramento da medição.
   --------------------------------------------------------------------------
@author<Antonio Dantas>
@since<21/08/2015>
@version<1.0>
@receive<>
@return
<  _lReturn (L) - (.T.) - Permite Encerramento; 
                  (.F.) - Não permite Encerramento
>
@example<Nil>
@see<Nil>
--------------------------------------------------------------------------------
*/     
User Function CN120ENVL()
Local _lReturn		:= .T.
Local _cMensagem 	:= ""
If IsInCallStack("CNTA120")
	// Walmir Junior 04/02/2016 - Se for encerramento por rotina automática, não permite.
	If "Medição gerada automaticamente" $ Alltrim(CND->CND_OBS) .And. IsBlind()
		_lReturn		:= .F.
	/* Descomentar quando for utilizar a rotina de contratos compartilhados
	ElseIf !Empty(Alltrim(CND->CND_XUNEXE)) .And. CND->CND_FILIAL != CND->CND_XUNEXE 
		_lReturn := .f.
		_cMensagem 	:= "Medição de CONTRATO COMPARTILHADO, só pode ser ENCERRADA na filial EXECUTORA ["+CND->CND_XUNEXE+"], "
		_cMensagem 	+= "a partir da rotina ESPECIFICA para Mendição de Contratos Compartilhados!"
		Aviso(FunName()+"/"+ProcName(),_cMensagem,{"OK"})*/
	Endif 
Endif 
Return _lReturn