#INCLUDE "TOTVS.CH"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ SICOMA29 º Autor ³ TOTVS              º Data ³ Fev/2012    º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Envio de e-mail do Pedido de Compra ao Fornecedor          º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ P11 - SISTEMA INDUSTRIA                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function SICOMA29()

Local lProcessa := .T.
Local cRotina   := "Envia Workflow"
Local cEOL      := Chr(13) + Chr(10)

// Verifica se o pedido esta liberado
If SC7->C7_QUJE >= SC7->C7_QUANT
	MsgStop("O e-mail não será enviado porque o Pedido de Compra não possui saldo.",cRotina)
	lProcessa := .F.
// Verifica se o PC esta bloqueado
ElseIf SC7->C7_CONAPRO # "L"
	MsgStop("O e-mail não será enviado porque o Pedido não está liberado.",cRotina)
	lProcessa := .F.
// Verifica se o PC está eliminado
ElseIf SC7->C7_RESIDUO == "S"
	MsgStop("O e-mail não será enviado porque o Resíduo do Pedido foi eliminado.",cRotina)
	lProcessa := .F.
// Verifica se existe e-mail no cadastro do Fornecedor
ElseIf Empty(Posicione("SA2",1,xFilial("SA2")+SC7->C7_FORNECE+SC7->C7_LOJA,"A2_EMAIL") )
	MsgStop("O e-mail não será enviado porque não existe endereço de e-mail informado no cadastro do Fornecedor.",cRotina)
	lProcessa := .F.
// Verifica se o e-mail já foi enviado
ElseIf SC7->C7_WFE_FOR
	lProcessa := MsgYesNo("Este pedido já foi enviado ao fornecedor. Deseja enviar novamente?",cRotina)
EndIf

If lProcessa
	MsgRun("Enviando pedido para fornecedor...",, {|| U_CWKFA005(SC7->C7_NUM,.T.) } )
EndIf

Return