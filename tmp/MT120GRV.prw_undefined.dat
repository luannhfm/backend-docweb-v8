#Include "Protheus.Ch"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT120GRV  ºAutor  ³Microsiga           º Data ³  01/31/12   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Ponto de entrada para gravar o pedido de compra e gerar a   º±±
±±º          ³medição do contrato de registro de preço                    º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User Function MT120GRV()
Local lValido 	 := .F.
Local cA120Num
Local l120Inclui
Local l120Altera
Local l120Deleta
Local cParam
Local lPrjCni    := FindFunction("PRJCNI") .Or. GetRpoRelease("R6")

cA120Num   := PARAMIXB[1]
l120Inclui := PARAMIXB[2]
l120Altera := PARAMIXB[3]
l120Deleta := PARAMIXB[4]

If lPrjCni
	
	cParam	 := GetMv("SI_XMED", .F.)
	// Só gera medição se o parametro SI_XMED estiver configurado como 2, se estiver como 1 a medição será gerada na aprovação da Solicitação de Compras
	If (cParam == "2")
		
		If ExistBlock("CNIA109m")
			lValido := Execblock("CNIA109m",.F.,.F.,{cA120Num,l120Inclui,l120Altera,l120Deleta })
		EndIf
	Else
		lValido 	 := .T.
	EndIf
	
EndIf

// Lançamento dos movimentos orçamentarios - GAP091
IF lValido .and. l120Deleta
	MsgRun("Excluindo Movimentos do PC "+SC7->C7_NUM,"",{|| U_SICOMA11({5,SC7->C7_NUM,1}) })
ENDIF

Return lValido
