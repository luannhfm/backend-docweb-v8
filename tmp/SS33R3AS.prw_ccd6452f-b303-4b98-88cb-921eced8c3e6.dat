#Include 'Protheus.ch'
#INCLUDE "RPTDEF.CH"
#INCLUDE "FWPrintSetup.ch"
#INCLUDE "TOTVS.ch"
#INCLUDE "Topconn.ch"
#INCLUDE "TBICONN.CH"

User Function SS33R3AS()
	Local cPerg            := 'SS33R3AS'
	Local lAdjustToLegacy  := .F.
	Local lDisableSetup    := .T.
	Local cLocal           := "C:\PDF\"
	Local cTotal           := 0
	Local nLin1            := 552
	Local cTpAtend         := " "
	Local cProfis          := " "
	Local cDProfis		  := " "
	//Alterado 16/07/2014 AS 10:20
	Local cCodUser         := ZZM->ZZM_CODUS + SUBSTR(ZZM->ZZM_ATEND,8,1) + "6.REL"
	 
	Local oNew14N			  := TFont():New("Courier New"	,10,10,,.T.,,,,.F.,.F.)		// Negrito
	
	//PRIVATE cNomRel        := "Relatorio Caixa por Operador Analitico"
	//PRIVATE cNomRel1       := "Relatorio Caixa por Operador Sintetico"
	Local cCompanyName     := AllTrim(FWFilialName())
	
	/*	Jose Leite - 23-07-14
		Logo da Empresa
		Nome do Relatorio
	*/
	//Inicio
	Local cLogo 			  := ""
	Local cNomRel			  := ZZM->ZZM_FILIAL+"_"+ZZM->ZZM_CODUS+"_"+DTOS(dDataBase)
	//Fim
	
	PRIVATE nLin           := 150
	
		
	//Jose Leite - Logo da empresa - 23-07-14
	//Inicio
	If File('\system\sesi.bmp')
		cLogo := 'sesi.bmp'
	Else
		cLogo := 'msmdilogo.bmp'
	EndIf
	//Fim
	
	
	oPrinter := FWMSPrinter():New(cNomRel, IMP_SPOOL, lAdjustToLegacy, , lDisableSetup, , , , , , .F., )
	oPrinter:SetResolution(72)
	oPrinter:SetPortrait( )
	oPrinter:SetPaperSize(DMPAPER_A4)
	oPrinter:SetMargin(60,60,60,60) // nEsquerda, nSuperior, nDireita, nInferior
	
	CRIASX1(cPerg)
	Pergunte(cPerg, .T.)
	
	_cQuery := ""
	_cQuery += " SELECT ZZM_ATEND, ZZM_TPATEN, ZZM_DATA, ZZM_DTPROC, ZZM_TRABAL, ZZM_NOMTRA, ZZM_CODCLI, ZZM_LOJA, ZZM_NOME, ZZM_CODUS "
	_cQuery += "	FROM "+ RETSQLNAME("ZZM") + " ZZM "
	_cQuery += "	WHERE ZZM_FILIAL = '"+xFilial("ZZM")+"' "
	_cQuery += " 		AND ZZM.ZZM_ATEND  	BETWEEN '"+mv_par01+"' AND '"+mv_par02+"'							"
	_cQuery += " 		AND ZZM.ZZM_CODUS		BETWEEN '"+mv_par03+"' AND '"+mv_par04+"'							"
	_cQuery += " 		AND ZZM.ZZM_DATA 		BETWEEN '"+DtoS(mv_par05)+"' AND '"+DtoS(mv_par06)+"'			"
	_cQuery += " 		AND ZZM.D_E_L_E_T_ <> '*'
	_cQuery += "		ORDER BY ZZM_ATEND

	TCQUERY _cQuery NEW ALIAS "TMPZZM"
	
	
	DbSelectArea('TMPZZM')
	DBGoTop()
  
	While TMPZZM->(!EOF())
	oPrinter:StartPage()
	
	nLin           := 150
	nLin1          := 552
	cTotal         := 0
	
	
	//Tipo de Atendimento
		If (TMPZZM->ZZM_TPATEN == '1')
			cTpAtend := 'ADMISSAO'
		ElseIf(TMPZZM->ZZM_TPATEN == '2')
			cTpAtend := 'DEMISSAO'
		ElseIf(TMPZZM->ZZM_TPATEN == '3')
			cTpAtend := 'MUDANCA DE FUNCAO'
		ElseIf(TMPZZM->ZZM_TPATEN == '4')
			cTpAtend := 'PERIODICO'
		ElseIf(TMPZZM->ZZM_TPATEN == '5')
			cTpAtend := 'RETORNO AO TRABALHO'
		ElseIf(TMPZZM->ZZM_TPATEN == '6')
			cTpAtend := 'AVALIACAO MEDICA'
		ElseIf(TMPZZM->ZZM_TPATEN == '7')
			cTpAtend := 'ADMISSIONAL 6 MES'
		ElseIf(TMPZZM->ZZM_TPATEN == '8')
			cTpAtend := 'TAP'
		ElseIf(TMPZZM->ZZM_TPATEN == '9')
			cTpAtend := 'OUTROS'
		EndIf
		
	//Cabeçalho
		oPrinter:Box( 010,010, 43, 565, "-4")
	//oPrinter:SayBitmap(011,011,"C:\Desenvolvimento\Projetos\SESICLINICA\SESI.BMP",120,30)
	//oPrinter:SayBitmap(011,011,"C:\PDF\SESI.BMP",120,30)
	
	//Jose Leite - Logo da empresa - 23-07-14
	//Inicio
		oPrinter:SayBitmap(011,011,cLogo,120,30)
	//Fim
	
		oPrinter:Say( 020, 260, cCompanyName         , oNew14N)
		oPrinter:Say( 020, 395, 'Dt. Atendimento:  ' +  SUBSTR(TMPZZM->ZZM_DATA,7,2) + '/' + SUBSTR(TMPZZM->ZZM_DATA,5,2) + '/' + SUBSTR(TMPZZM->ZZM_DATA,1,4) ,  oNew14N)
		oPrinter:Say( 030, 395, 'Dt. Procedimento: ' +  SUBSTR(TMPZZM->ZZM_DTPROC,7,2) + '/' + SUBSTR(TMPZZM->ZZM_DTPROC,5,2) + '/'  + SUBSTR(TMPZZM->ZZM_DTPROC,1,4),  oNew14N)
		oPrinter:Say( 042, 250, "GUIA DE ATENDIMENTO", oNew14N)
		oPrinter:Say( 042, 395, "Nº " + TMPZZM->ZZM_ATEND    , oNew14N)
	
	//Trabalhadores
		oPrinter:Box(050,010, 100, 565, "-4")
		oPrinter:Say(062,020, 'Trabalhador  - ', oNew14N)
		oPrinter:Say(062,105, TMPZZM->ZZM_TRABAL  , oNew14N)
		oPrinter:Say(062,156, TMPZZM->ZZM_NOMTRA  , oNew14N)
		oPrinter:Say(074,020, 'Empresa      - ', oNew14N)
		oPrinter:Say(074,105, TMPZZM->ZZM_CODCLI  , oNew14N)
		oPrinter:Say(074,155, TMPZZM->ZZM_LOJA    , oNew14N)
		oPrinter:Say(074,180, TMPZZM->ZZM_NOME    , oNew14N)
		oPrinter:Say(086,020, 'Profissional - ' , oNew14N)
		oPrinter:Say(098,020, 'Tipo Atend   - ' , oNew14N)
		oPrinter:Say(098,105, cTpAtend          , oNew14N)
	
	//Procedimentos
		oPrinter:Box(108, 010, 300, 565, "-4")
		oPrinter:Say(121, 260, "PROCEDIMENTO", oNew14N)
		oPrinter:Line(130, 10, 130, 565, , "-4")
		oPrinter:Line(142, 10, 142, 565, , "-4")
		oPrinter:Say(139,023, 'Codigo' , oNew14N)
		oPrinter:Line(130,70, 300, 70, , "-4")
		oPrinter:Say(139,240, 'Especificação', oNew14N)
		oPrinter:Line(130,450, 300, 450, , "-4")
		oPrinter:Say(139,500, 'Valor', oNew14N)
		oPrinter:Box(350, 010,300, 565, "-4")
		oPrinter:Line(300,300, 350, 300, , "-4")
    //oPrinter:Say(300 ,020,"Observação:"                                 , oNew14N) 
		oPrinter:Say(330,045, "__________________________________________" , oNew14N)
		//oPrinter:Say(342,080, UsrFullName(TMPZZM->ZZM_CODUS)               , oNew14N)
		oPrinter:Say(330,350, "TOTAL    "                                  , oNew14N)
		oPrinter:Line(300,450, 350, 450, , "-4")
	
	/*Jose Leite - 31/07/2014
  		Assinatura do Trabalhador
  	*/
  	//Inicio
		oPrinter:Say(365,045, "__________________________________________" , oNew14N)
		oPrinter:Say(375,080, TMPZZM->ZZM_NOMTRA                  				, oNew14N)
  	//Fim
  	
  	//Linha de Corte
		oPrinter:Line(390, 10, 390, 565, , "-3")
  	
  	//Parte Inferior
  	//Cabeçalho
		oPrinter:Box( 400,010, 435, 565, "-4")
	
	
	//Jose Leite - Logo da empresa - 23-07-14
	//Inicio 
		oPrinter:SayBitmap(402,011,cLogo,120,30)
	//Fim
	
		oPrinter:Say( 410, 260, cCompanyName         , oNew14N)
		oPrinter:Say( 410, 395, 'Dt. Atendimento:  '  + SUBSTR(TMPZZM->ZZM_DATA,7,2) + '/' + SUBSTR(TMPZZM->ZZM_DATA,5,2) + '/' + SUBSTR(TMPZZM->ZZM_DATA,1,4),  oNew14N)
		oPrinter:Say( 420, 395, 'Dt. Procedimento: '  + SUBSTR(TMPZZM->ZZM_DTPROC,7,2) + '/' + SUBSTR(TMPZZM->ZZM_DTPROC,5,2) + '/'  + SUBSTR(TMPZZM->ZZM_DTPROC,1,4), oNew14N)
		oPrinter:Say( 432, 250, "GUIA DE ATENDIMENTO", oNew14N)
		oPrinter:Say( 432, 395, "Nº " + TMPZZM->ZZM_ATEND   , oNew14N)
	
	//Trabalhadores
		oPrinter:Box(450,010, 500, 565, "-4")
		oPrinter:Say(462,020, 'Trabalhador  - ' , oNew14N)
		oPrinter:Say(462,105, TMPZZM->ZZM_TRABAL  , oNew14N)
		oPrinter:Say(462,156, TMPZZM->ZZM_NOMTRA  , oNew14N)
		oPrinter:Say(474,020, 'Empresa      - ' , oNew14N)
		oPrinter:Say(474,105, TMPZZM->ZZM_CODCLI  , oNew14N)
		oPrinter:Say(474,155, TMPZZM->ZZM_LOJA    , oNew14N)
		oPrinter:Say(474,180, TMPZZM->ZZM_NOME    , oNew14N)
		oPrinter:Say(486,020, 'Profissional - ' , oNew14N)
		oPrinter:Say(498,020, 'Tipo Atend   - ' , oNew14N)
		oPrinter:Say(498,105, cTpAtend    , oNew14N)
	
	//Procedimentos
		oPrinter:Box(508, 010, 750, 565, "-4")
		oPrinter:Say(521, 260, "PROCEDIMENTO", oNew14N)
		oPrinter:Line(530, 10, 530, 565, , "-4")
		oPrinter:Line(542, 10, 542, 565, , "-4")
		oPrinter:Say(539,023, 'Codigo' , oNew14N)
		oPrinter:Line(530,70, 750, 70, , "-4")
		oPrinter:Say(539,240, 'Especificação', oNew14N)
		oPrinter:Line(530,450, 750, 450, , "-4")
		oPrinter:Say(539,500, 'Valor', oNew14N)
   	 
   	/*Jose Leite - 31/07/2014
  		Assinatura do Trabalhador
  	*/
  	//Inicio
		oPrinter:Say(770,050, "__________________________________________" , oNew14N)
		oPrinter:Say(780,080, TMPZZM->ZZM_NOMTRA                  			, oNew14N)
  	//Fim
  	
  	//Imprime Procedimentos
		DbSelectArea('ZZN')
		DbSetOrder(1)
		DbGoTop()
		DbSeek(xFilial() + Alltrim(TMPZZM->ZZM_ATEND))
  	 
		While (ZZN->(!EOF()) .AND. xFilial() = ZZN->ZZN_FILIAL .AND. TMPZZM->ZZM_ATEND = ZZN->ZZN_ATEND)
			oPrinter:Say(nLin,020,ZZN->ZZN_PROCED, oNew14N)
			oPrinter:Say(nLin,080,ZZN->ZZN_DESPRO, oNew14N)
			oPrinter:Say(nLin,495,Transform(ZZN->ZZN_VUNIT,"@R 999999.99"), oNew14N)
  	 	
			oPrinter:Say(nLin1,020,ZZN->ZZN_PROCED, oNew14N)
			oPrinter:Say(nLin1,080,ZZN->ZZN_DESPRO, oNew14N)
	//	oPrinter:Say(nLin1,525,Transform(ZZN->ZZN_VUNIT,"@R 999999.99"), oNew14N)
  	 	
			cTotal := cTotal + ZZN->ZZN_VUNIT
		
			cProfis := ZZN->ZZN_CODCRE
  	 			
			nLin := nLin + 12
			nLin1 := nLin1 + 12
			DbSkip()
		EndDo
			
			
	
		cDProfis := Posicione("ZZG",1, xFilial("ZZG")+ cProfis,"ZZG_NOME")
	
		oPrinter:Say(086,105, cDProfis , oNew14N)
		oPrinter:Say(486,105, cDProfis , oNew14N)
	
		oPrinter:Say(330,495,Transform(cTotal,"@R 999999.99"), oNew14N)
		
		DbcloseArea('ZZN')
		TMPZZM->(DBSKIP())
		oPrinter:EndPage()
		
		
		EndDo	
  	 	
		oPrinter:Setup()
	
		if oPrinter:nModalResult == PD_OK
			oPrinter:Preview()
		EndIf
	
		//oPrinter:EndPage()
 
		Return



	Static Function CriaSX1(cPerg)
	
		Local aHelp := {}
	
		AAdd(aHelp, {{"G.A.  de?"		      }, {""}, {""}})
		AAdd(aHelp, {{"G.A   ate?"		      }, {""}, {""}})
		AAdd(aHelp, {{"Operador de?"		   }, {""}, {""}})
		AAdd(aHelp, {{"Operador Ate?"         }, {""}, {""}})
		AAdd(aHelp, {{"Date De?"              }, {""}, {""}})
		AAdd(aHelp, {{"Date Ate?"			   }, {""}, {""}})
	
	
		u_SFPUTSX1(cPerg,"01","G.A de?....................?","","","mv_ch1","C",008,00,00,"G","","   "	,"","","mv_par01","","","","","","","","","","","","","","","","",aHelp[1,1],aHelp[1,2],aHelp[1,3],"")
		u_SFPUTSX1(cPerg,"02","G.A Ate?...................?","","","mv_ch2","C",008,00,00,"G","","   "	,"","","mv_par02","","","","","","","","","","","","","","","","",aHelp[2,1],aHelp[2,2],aHelp[2,3],"")
		u_SFPUTSX1(cPerg,"03","Operador...................?","","","mv_ch1","C",006,00,00,"G","","USR"	,"","","mv_par03","","","","","","","","","","","","","","","","",aHelp[3,1],aHelp[3,2],aHelp[3,3],"")
		u_SFPUTSX1(cPerg,"04","Operador...................?","","","mv_ch2","C",006,00,00,"G","","USR"	,"","","mv_par04","","","","","","","","","","","","","","","","",aHelp[4,1],aHelp[4,2],aHelp[4,3],"")
		u_SFPUTSX1(cPerg,"05","Data De....................?","","","mv_ch3","D",008,00,00,"G","",""		,"","","mv_par05","","","","","","","","","","","","","","","","",aHelp[5,1],aHelp[5,2],aHelp[5,3],"")
		u_SFPUTSX1(cPerg,"06","Data Ate...................?","","","mv_ch4","D",008,00,00,"G","",""		,"","","mv_par06","","","","","","","","","","","","","","","","",aHelp[6,1],aHelp[6,2],aHelp[6,3],"")
	
	
	
	
		Return




