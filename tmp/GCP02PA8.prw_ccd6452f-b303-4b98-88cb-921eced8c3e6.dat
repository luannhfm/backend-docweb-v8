#INCLUDE "PROTHEUS.CH"     
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³GCP02PA8  ºAutor  ³Microsiga           º Data ³  19/08/12   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Tratamento do Numero do Processo                           º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ P11 - SISTEMA INDUSTRIA                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function GCP02PA8()
Local _cMod    := SubStr(PARAMIXB[1],1,2)
Local _cSeque  := SubStr(PARAMIXB[1],3,5)
Local _cAno    := SubStr(PARAMIXB[1],8)
Local nOpc 	   := PARAMIXB[2]
Local _lOk     := .F.

If nOpc==5 .Or. nOpc==3  //Gerar Edital ou Incluir
	_lOk := .T.
	
	// Atualiza parâmetro de numeração
	/*
	CO1->(dbSetOrder(1))
	IF CO1->(DbSeek(xFilial("CO1")+M->CO1_CODEDT))
		_cNum := Soma1(M->CO1_CODEDT)
		_aAreaCO1 := CO1->(GetArea())
		
		While CO1->(DbSeek(xFilial("CO1")+_cNum))
			
			// Incrementa numeracao
			_cNum := Soma1(_cNum)
			
			CO1->(dbSkip())
		Enddo
		
		// Atualiza numeração
		M->CO1_CODEDT := _cNum
		
		Aviso("Aviso","O número do edital foi alterado para : "+_cNum,{"Ok"})
		
		RestArea(_aAreaCO1)
	ENDIF
	
	// Atualiza parâmetro de numeração
	PutMV("SI_NUMEDT",Soma1(M->CO1_CODEDT))
	*/
	
	While _lOk
		DbSelectArea("PA8")
		DBSETORDER(1)
		If DbSeek(xFilial("PA8")+_cMod+_cAno)
			If PA8_BLQ == "0"
				RecLock("PA8",.F.)
				/*PA8->PA8_BLQ == "1"*/
				PA8->PA8_BLQ := "1"
				MsUnlock()
				If PA8->PA8_SEQ == _cSeque .OR. PA8->PA8_SEQ > _cSeque
					_cSeque := Soma1(PA8->PA8_SEQ)
					RecLock("PA8",.F.)
					PA8->PA8_BLQ := "0"
					PA8->PA8_SEQ := _cSeque
					MsUnlock()
					MsgAlert("O Numero do Processo Mudou para: "+ _cMod + _cSeque + "/" + _cAno )
					M->CO1_NUMPRO := _cMod + _cSeque + _cAno
					M->CO1_CODEDT := M->CO1_NUMPRO //Essa linha foi incluida pq o numero do edital eh o mesmo numero do processo.
					_lOk := .F.
					
				Else
					If PA8->PA8_SEQ < _cSeque
						RecLock("PA8",.F.)
						PA8->PA8_BLQ := "0"
						PA8->PA8_SEQ := _cSeque
						MsUnlock()
						_lOk := .F.
					EndIf
				EndIf
				
			EndIf
		Else
			If DbSeek(xFilial("PA8")+_cMod)
				RecLock("PA8",.F.)
				PA8->PA8_FILIAL := xFilial("PA8")
				PA8->PA8_BLQ 	:= "0"
				PA8->PA8_SEQ 	:= _cSeque
				PA8->PA8_ANO 	:= _cAno
				MsUnlock()
			Else
				RecLock("PA8",.T.)
				PA8->PA8_FILIAL := xFilial("PA8")
				PA8->PA8_MOD 	:= _cMod
				PA8->PA8_BLQ 	:= "0"
				PA8->PA8_SEQ 	:= _cSeque
				PA8->PA8_ANO 	:= _cAno
				MsUnlock()
			EndIf
			_lOk := .F.
		EndIf
	EndDo
Endif
Return