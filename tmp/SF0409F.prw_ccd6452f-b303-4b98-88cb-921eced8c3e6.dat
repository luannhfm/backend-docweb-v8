#Include 'Protheus.ch'


/*/{Protheus.doc} SF0409F
Função para registrar usuário da retirada dos livros no estoque

@type function
@author franklin.oliveira
@since 10/09/2015
@version 1.0
@return ${return}, ${return_description}
@example
(examples)
@see (links_or_references)
/*/User Function SF0409F()

Local aAreaAnt := GetArea()
Local cTabSol := "US3"
Local cGet1   := Space(10)
Local lRet		:= .T.
Local oGet1, oSay1, oSButton1, oSButton2, oDlg

	If ( ExistChav("ZE0", xFilial("ZE0") + SCP->CP_NUM, 2) ) 

		DEFINE MSDIALOG oDlg FROM 000, 000  TO 175, 350 TITLE "Registro de Retirada" STYLE DS_MODALFRAME PIXEL
		
		@ 022, 012 Say "Usuário Retirada:" SIZE 053, 007 OF oDlg PIXEL
		@ 020, 065 MSGET oGet1 VAR cGet1 F3 cTabSol SIZE 100, 010 OF oDlg  F3 cTabSol PIXEL
		DEFINE SBUTTON FROM 040,040 TYPE 1 ACTION (IIf(TudoOk(cGet1),lRet:= .T., lRet:= .F.), oDlg:End())  ENABLE OF oDlg
		DEFINE SBUTTON FROM 040,080 TYPE 2 ACTION (oDlg:End(), lRet:= .F.)  ENABLE OF oDlg
		ACTIVATE MSDIALOG oDlg CENTERED

		If lRet
		
			dbSelectArea("ZE0")
			dbSetOrder(2)
			dbSeek(xFilial("ZE0") + SCP->CP_NUM)
			
			While !ZE0->( EoF() ) .And. ( ZE0->ZE0_FILIAL + ZE0->ZE0_NUMSA ==  xFilial("ZE0") + SCP->CP_NUM )
			
				RecLock("ZE0", .F.)
				ZE0->ZE0_USRETI := cGet1
				msUnlock()
				
				ZE0->( dbSkip() )
			
			EndDo
		
		EndIf

	EndIf
	
	RestArea(aAreaAnt)
	
Return lRet


/*/{Protheus.doc} TudoOk
Função para validação dos dados

@type function
@author franklin.oliveira
@since 10/09/2015
@version 1.0
@param cGet1, character, (Descrição do parâmetro)

@return lOk, Indica se encontrou alguma inconsistência.

/*/
Static Function TudoOk(cGet1)

Local lOk     := .T.

 	If (lOk := NaoVazio(cGet1))
		
		PSWOrder(2)
		
		If !(lOk := PSWSeek(cGet1, .T.))
		
			Help(' ', 1, 'USR_EXIST')
		
		EndIf
					
	EndIf

Return lOk

