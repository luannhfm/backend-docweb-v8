#INCLUDE "TOTVS.CH"

/*/{Protheus.doc} User Function FIXVALMNAT
    (Ponto de entrada para validar a obrigatoriedade de centro de custo para natureza)
    @type  Function
    @author Joao Tavares Silva Junior
    @since 12/05/2021
    @version 12.1.27
    @param param_name, param_type, param_descr
    @return return_var, return_type, return_description
    @example
    (examples)
    @see (links_or_references)
    /*/
User Function FIXVALMNAT()

Local lRet	    := .T.
Local aArea	    := GetArea()
Local aAreaSED  := SED->(GetArea())
Local cNatur    := ""
Local cRat      := ""
Local nX        := 0   

For nX :=1 to Len(Acols)
    IF !Acols[nX][Len(Aheader)+1]

        cNatur  := aCols[nX][ aScan(aHeader, { |x| AllTrim(x[2]) == "EV_NATUREZ" }) ]
             
        dbSelectarea("SED")
        If dbSeek(xFilial("SED")+cNatur)

            dbSelectArea("CT1")
            dbSeek(xFilial("CT1")+SED->ED_CONTA)
            cRat  := aCols[nX][ aScan(aHeader, { |x| AllTrim(x[2]) == "EV_RATEICC" }) ]
            If CT1->CT1_CCOBRG == "1" .and. cRat <> "1"
                Alert("Obrigatrio Informar o rateio de centro de custo para Natureza "+cNatur+". Linha:"+StrZero(nX,2)+" ") 
                lRet := .F.  
                Exit
            EndIf    
        Else
            Alert("NÃ£o existe esta Natureza cadastrada, "+cNatur+"")
            lRet := .F.  		
        EndIf
    EndIF    
Next
   
RestArea(aAreaSED)
RestArea(aArea)

Return lRet
