#INCLUDE "PROTHEUS.CH"
#INCLUDE "TOPCONN.CH"
#INCLUDE "RWMAKE.CH"
#INCLUDE "FONT.CH"
#INCLUDE 'PARMTYPE.CH'
#INCLUDE "FWMBROWSE.CH"
#INCLUDE "FWMVCDEF.CH"
#INCLUDE "FWCOMMAND.CH"
/*/
{Protheus.doc} MTALCFIM
Ponto de Entrada MTALCFIM no final da função MaAlcDoc - Controla a alçada dos documentos.
Permite customizações do usuário para a aprovação ou não de documentos.
@type  Function
@author J2A --> Gustavo Krebs 
@since 04/07/2022
<
ParamIXB[1] = Array com informações do documento  onde:
[1,1] Número do documento
[1,2] Tipo de Documento
[1,3] Valor do Documento
[1,4] Código do Aprovador
[1,5] Código do Usuário
[1,6] Grupo do Aprovador
[1,7] Aprovador Superior
[1,8] Moeda do Documento
[1,9] Taxa da Moeda
[1,10] Data de Emissão do Documento
[1,11] Grupo de Compras
>
(examples)
@see  https://tdn.totvs.com/display/public/PROT/MTALCFIM
/*/
User Function MTALCFIM()
	Local _aArea		:= GetArea()
	Local _aAreaSC7		:= SC7->(GetArea())
	Local _aAreaSF1		:= SF1->(GetArea())
	Local _aAreaSD1		:= SD1->(GetArea())
	Local _aAreaSC1		:= SC1->(GetArea())

	Local _nOper     	:= ParamIXB[3] 	// [Caracter] Operação a ser executada. 1-Incluir Alçada | 3-Alterar Pedido (Na vdd ele exclui e inclui novamente)
	Local _aDocto    	:= ParamIXB[1] 	// [Array] Array com informações do documento.
	Local _lReturn      := .T.
	Local _nPed       	:= _aDocto[1]
	Local _cTpDoc       := _aDocto[2]

//Posiciona o cursor da tabela no primeiro registro.
	dbSelectArea("SCR")
	SCR->(dbSetOrder(1))
	SCR->(dbGoTop())
	If SCR->(dbSeek(FwxFilial("SCR")+_cTpDoc+_nPed)) .AND. _nOper == 1
		_lReturn := .F.
	//ELSE

//Posiciona o cursor da tabela no primeiro registro.
		SCR->(dbSetOrder(4))
		SCR->(dbGoTop())
		If SCR->(dbSeek(FwxFilial("SCR")+_cTpDoc+_nPed+"01")) .OR. SCR->(dbSeek(FwxFilial("SCR")+_cTpDoc+_nPed+"02")) // DBSeek(xFilial("SCR")+"PC"+Alltrim(cPedido)+SPACE(44)+"02")
			Alert("Entrou IF")
			_lReturn := .T.
		EndIf
	EndIf
//Restaura as tabelas em uso 
	RestArea(_aArea)
	RestArea(_aAreaSC7)
	RestArea(_aAreaSF1)
	RestArea(_aAreaSD1)
	RestArea(_aAreaSC1)

Return _lReturn
