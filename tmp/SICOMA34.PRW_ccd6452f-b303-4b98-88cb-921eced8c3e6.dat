#INCLUDE "PROTHEUS.CH"
#DEFINE ENTER 						  		Chr(13)+Chr(10)
                           
/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 袖ICOMA34   � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o � Ponto de entrada com customiza踥es do Edital da CNI 		   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 � Executa uma serie de funcoes pertinentes as regras de negocio陰�
控�            aplicadas sobre a manutencao de Editais na empresa CNI      陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
                                    


User Function SICOMA34(nTipo, cPar1, cPar2, cPar3, cPar4, cPar5, aPar6, aPar7, nPar8, aPar9, aPar10, cPar11, cPar12, aPar13)            
Local aRet, cRet
Default nTipo := 0 , cPar1 := "", cPar2 := "", cPar3 := "", cPar4 := "", ;
        cPar5 := "", aPar6 := {}, aPar7 := {}, nPar8 := 0, aPar9 := {}, aPar10 := {}, cPar11 := "", aPar13 := {}
                   
	if nTipo = 1    //Lista na tela de Edicao as solicitacoes ja vinculadas anteriormente ao detalhe de Edital
		Return (SqlSolVinculadas(cPar1, cPar2, cPar3, cPar4))		

	elseif nTipo = 2
        aRet := aPar6
        if AllTrim(cPar1) != ''   
	        Aadd(aRet, .T. )
        else
	        Aadd(aRet, .F. )
        EndIf     
        
		Return(aRet)


	elseif nTipo = 3 //Monta Script da tela de Solicitacoes
        cRet := " AND SC1.C1_PRODUTO = '" + cPar1 + "' "                                                             
   		Return(cRet)


	elseif nTipo = 4     //obtem lista de Qtdes Originais do Edital, antes de qualquer manuten誽o

        return (MontaListaQtdesOrginais(cPar1,cPar2,cPar3))  
		                                          
		

	elseif nTipo = 5 //Confere a Qtde editada com a Qtde original do Eidtal. Caso ele tenha aumentado a qtde, criticar e impedir!
		return (VrfErrQtde(aPar6/*Vetor com novas qtdes*/, aPar7/*Vetor com qtdes originais*/, cPar1, cPar2, aPar13))		
		
	 

	elseif nTipo = 6 //Confere a Qtde editada com a Qtde original do Eidtal. Caso ele tenha aumentado a qtde, criticar e impedir!		

        Return (AtQtde(aPar7, nPar8))                


	elseif nTipo = 7 //Confere a Qtde editada com a Qtde original do Eidtal. Caso ele tenha aumentado a qtde, criticar e impedir!		
        return AjustStatus()


	elseif nTipo = 8  
		DelItemEdital (cPar1, cPar2, aPar7)   		
		aPar7 := DelAlterados  (aPar6, aPar7)
		
		Return (aPar7)       			
   

	elseif nTipo = 9   //AJUSTA CAMPO REFERENTE A QTDE ENTREGUE

	 	AjSC1QtEntregue(.F.,"",cPar1, cPar2, cPar3, cPar4, aPar6, aPar7, aPar13)
		
		Return ("")       			
		                   

	elseif nTipo = 10 //Sempre apos editar as solicitacoes, sobreescrever a co2_orig !!
	 	
		Return (SetItemEdital(cPar1, cPar2, cPar3, cPar4, cPar5, aPar6, aPar7, nPar8, aPar9, aPar10, cPar11))    		


	elseif nTipo = 11 //Sempre apos editar as solicitacoes, sobreescrever a co2_orig !!
		Return (SetLstSolicitacoes(aPar6,aPar7))    		

	elseif nTipo = 12 //EXCLUI 
		Return (ClearSC(cPar1, cPar2, cPar3, cPar4, aPar6, aPar7, aPar13))

	elseif nTipo = 13 //MARCA ITENS EXCLUIDOS OU INCLUIDO DO GRID DO EDITAL
	 	
	 	if nPar8 == 1
			Return (MarcaExclInc(cPar1, aPar7, .T.) )    		
		Else
			Return (MarcaExclInc(cPar1, aPar7, .F.) )    		
		EndIf
				            
	elseif nTipo = 14 //Verifica se o Edital passou por um processo de estorno em algum momento 
		Return (NaoMarkNoEstorno(cPar1, cPar2, cPar3))

	elseif nTipo = 15 //Verifica se o Edital passou por um processo de estorno em algum momento  
		Return (TemRegsNaoMarkNoEstorno(cPar1, cPar2,0))


	//else if 16   ----  NAO EXISTIRA MAIS O TOPICO "16"
	
	elseif nTipo = 17 //produtos mostrados na hora de "dar Andamento" e apontar fornecedores ganhadores
		Return (MostraProd())
		
	elseif nTipo = 18 //fornecedores mostrados na hora de "dar Andamento" e apontar fornecedores ganhadores
		Return (MostraFornec())

	elseif nTipo = 19 //fornecedores mostrados na hora de "dar Andamento" e apontar fornecedores ganhadores
		
		Return (FiltroSql())   
		
	elseif nTipo = 20 //Verifica se o Edital passou por um processo de estorno em algum momento 
		             
		Return (TemRegsNaoMarkNoEstorno(cPar1, cPar2,1))

	elseif nTipo = 21 //Verifica se o Edital passou por um processo de estorno em algum momento 
		
		Return (PgSaldo(cPar1, cPar2, cPar3))         

	elseif nTipo = 22 //Verifica se o Edital passou por um processo de estorno em algum momento 
		
		Return (SaldoCO2())
								    
	EndIf

Return()


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  SetItemEdital � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Sempre que entrar Editando, re-setar qtde original CO2 	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  SetItemEdital(cPar1, cPar2, cPar3, cPar4, cPar5, aPar6, aPar7, nPar8, aPar9, aPar10, cPar11)

Local lGrava := .F.

Local aArea		:= GetArea()                                

Local aRets := aclone(aPar7)

Local nIndexProd := aScan(aRets, { |X| x[2] == cPar11 } )    


Select("CO2")  

CO2->(dbSetOrder(2))
lGrava :=   CO2->(dbSeek(xFilial("CO2")+cPar1+cPar2+cPar5) ) 	
	
if lGrava  .And. nIndexProd > 0
	RecLock("CO2",.F.)
	CO2->CO2_ORIG:= nPar8

	aPar7[nIndexProd][1]:= nPar8//seta lista de qtdes usadas para criticas no final da Manutencao
	MsUnLock()
EndIf

RestArea(aArea)
Return (aPar7)
                                                                                                
                      

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � DelItemEdital � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Se usu嫫io zerou algum registro , limpa item do edital CO2 陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �                										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  DelItemEdital(cPar1,cPar2, aPar7)
Local nCont,lGrava := .F.
Select("CO2") 	        
                                                                        
for nCont := 1 to Len(aPar7)

	CO2->(dbSetOrder(1))
	lGrava := CO2->(dbSeek(xFilial("CO2")+cPar1+cPar2+aPar7[nCont][2]) ) 	
	
	if lGrava .and. CO2->CO2_QUANT == 0 //se zerou qtde do detalhe apaga do sistema!

		RecLock("CO2",.F.)                  
		CO2->(dbDelete())
		MsUnlock()
	EndIf
	
Next  

Return


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � DelAlterados � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Se na lista de controle Interno havia um produto X que gerou 陰�
控�             CO2, SC vinculados .... e o usuario apenas mudou o produto   陰�
控�             no grid para Y, esta rotina marca o antigo produto X com     陰�
控�             o flag referente a exclusao. Desta forma o sistema desvincula|控
控�           tudo que havia no nome do antigo X, evitando deixar lixo no SQL陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  DelAlterados(aPar6, aPar7)
Local nCont := 1        
Local aRet := {}
Local nIndexProd
                               
for nCont := 1 to Len(aPar7)            		 
                                            
    aRet := aPar6            
	nIndexProd := aScan(aRet, { |X| x[2] == aPar7[nCont][2] } )    

	if (nIndexProd == 0)  
		aPar7[nCont][3] := .T.//excluir da lista
	EndIf
	
Next  

Return	 (aPar7)
/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � AjSC1QtEntregue � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Fun誽o que atualizada campo qt entregue na Solcitacao	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/

Static Function AjSC1QtEntregue(lLimpeza, lProdExcluido,cPar1, cPar2,cPar3,cPar4, aPar6, aPar7, aPar13)

Local cQuery, nIndexProd    
Local cTpCto        := GETMV("MV_TPSCCT")  // FSW - TIPO DE SC ADITIVO CONTRATO	
Local aRets := {}
Local lGrava := .F.
Local aArea		:= GetArea()                                
Local nPQUANT := GDFieldPos("CO2_QUANT",aPar13)
	
Select("SC1")	
cQuery := " SELECT SC1.* FROM " + RetSqlName('SC1')  + " SC1 "
cQuery += " WHERE SC1.C1_CODED = '" + cPar1  
cQuery += "' AND SC1.C1_NUMPR = '"  + cPar2
cQuery += "' AND SC1.C1_XTIPOSC <> '"+cTpCto+"' "

if lLimpeza                          
	cQuery += " AND SC1.C1_PRODUTO = '" +lProdExcluido+ "' "
else
	aRets := aclone(aPar6) 	
EndIf                                                      

cQuery += " AND " + RetSQLCond("SC1")
cQuery += " ORDER BY SC1.C1_PRODUTO"                      

cQuery 	:= ChangeQuery(cQuery)     

dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),"TRB_SC1",.T.,.T.)
dbSelectArea("TRB_SC1") 
		                                  
while (TRB_SC1->(!Eof()))

	nIndexProd := aScan(aRets, { |X| x[2] == TRB_SC1->(C1_PRODUTO) } )                                 
                     
	if (nIndexProd > 0 .and. !lLimpeza) .or. lLimpeza //se o usuario apenas alterou a coluna PRODUTO para um c鏚igo que nao havia antes, evito efetuar as consistencias abaixo
	
		Select("SC1")                     
		SC1->(dbSetOrder(1))                      
       
    	lGrava := SC1->( MsSeek(TRB_SC1->(C1_FILIAL) + TRB_SC1->(C1_NUM) + TRB_SC1->(C1_ITEM)) )
    
		If  lGrava 
	    
		    if lLimpeza 
			    //rotina que limpa SCs vinculadas a um item de edital que fora excluido do grid   
		    	ExcluiSC1()
		    ELSE       
		    	//rotina que aloca qtdes e desvincula SCs sem nece ssidade de uso(caso n緌 precisemos mais alocacoes de qtdes)
				if SCMarcada (aPar7, TRB_SC1->(C1_NUM),TRB_SC1->(C1_ITEM))
		   		
			   		if aPar6[nIndexProd,nPQUANT] > 0
				   		ModifSC1(nIndexProd, cPar1, cPar2,cPar3,cPar4,aPar6,aPar13)
	   				else
		   				ExcluiSC1()
					EndIf
				
				else
		   			ExcluiSC1()
				EndIf
				
			EndIf
		
		EndIf	
		
	EndIf
	
	dbSelectArea("TRB_SC1") 		                      
	TRB_SC1->(dbSKip())          
	            
End
		                                                
TRB_SC1->(dbCloseArea())   

if lLimpeza
	ExcluiCO2(lProdExcluido,cPar1, cPar2)
EndIf
    
RestArea(aArea)

return 


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � ExcluiCO2 � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Apaga item do CO2, apos usuario alterar conteudo da coluna Produto  陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function ExcluiCO2(lProdExcluido,cPar1,cPar2)
Local lGrava := .F.
Select("CO2")  

CO2->(dbSetOrder(1))
lGrava := CO2->(dbSeek(xFilial("CO2")+cPar1+cPar2+lProdExcluido) ) 	
	
if lGrava
	RecLock("CO2",.F.)
	CO2->(dbDelete())
	MsUnLock()
EndIf

Return                
/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � ClearSC � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Apaga vinculo entre SC e produtos excluidos do Edital(CO2)  陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function ClearSC(cPar1, cPar2, cPar3, cPar4, aPar6, aPar7, aPar13)
Local nCont := 0                          
                          
for nCont := 1 to len(aPar7)

	if aPar7[nCont][3] == .T.

	 	AjSC1QtEntregue(.T.,aPar7[nCont][2],cPar1, cPar2, cPar3, cPar4, aPar6, aPar7, aPar13)

	EndIf	
	
Next nCont

Return ("")


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 SCMarcada  Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o 莧 partir de lista das SC editadas, limpa da SC1 as que foram 陰�
控藥闡闡闡闡霰desmarcadas pelo usuario atraves do botao edit,para evitar   敢�
控�           alocar indevidamente a qtde destas na funcao AjSC1QtEntregue 敢�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/

Static Function SCMarcada(aListSC, nNumSC, nItemSC)
Local nCont := 1                                            
Local aArea		:= GetArea()                                
                                          
For nCont := 1	to Len(aListSC)
    
  	if aListSC[nCont][1] == .F. .AND. aListSC[nCont][2] == nNumSC  .AND. aListSC[nCont][3] ==  nItemSC
		RestArea(aArea)		 
		Return .F. 	
	EndIf
	
Next nCont

RestArea(aArea)
return .T.         

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 蛉odifSC1   � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Fun誽o que atualiza vinculo com a solicitacao (Qtdes)  	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           						         				   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/

Static Function ModifSC1(nIndexProd,cPar1,cPar2,cPar3,cPar4,aPar6,aPar13)
Local nPQUANT := GDFieldPos("CO2_QUANT",aPar13)

	RecLock("SC1",.F.)
	SC1->(C1_CODED):= cPar1
	SC1->(C1_NUMPR):= cPar2
	SC1->(C1_MODAL):= cPar3
	SC1->(C1_TPMOD):= cPar4

// Comentado por Carlos Queiroz em 25/09/13 decorrente de inconsist瘽cia apresentada na Manutencao e no Cancelamento do Edital
/*                   
    if aPar6[nIndexProd,nPQUANT] < SC1->(C1_QUANT)
		SC1->(C1_QUJE) := aPar6[nIndexProd,nPQUANT]
		aPar6[nIndexProd,nPQUANT] := 0
	else
		SC1->(C1_QUJE) := SC1->(C1_QUANT)
		aPar6[nIndexProd,nPQUANT] := aPar6[nIndexProd,nPQUANT] - SC1->(C1_QUANT)
	EndIf
							
	SC1->(C1_APROV):="B"
*/	
	MsUnLock()
	
	//Caio.Santos - FSW - 15/03/2012 - Geracao log ao vincular SC no Edital
	COMA080(SC1->C1_NUM,SC1->C1_ITEM,"COI",{},"COI_DTHEDT","COI_UEDT",/*lEstorno*/,/*cUser*/,"COI_DOCEDT",cPar1)
	
Return                                         

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 蛀xcluiSC1  � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Fun誽o que REMOVE vinculo com a solicitacao         	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/

Static Function ExcluiSC1()

	RecLock("SC1",.F.)
	SC1->C1_CODED:= ''
	SC1->C1_NUMPR:= ''
	SC1->C1_MODAL:= ''
	SC1->C1_TPMOD:= ''         
	SC1->C1_QUJE := 0     
	SC1->C1_APROV:= ''
    SC1->C1_COTACAO:= ''

	MsUnLock()
	
	//Caio.Santos - FSW - 15/03/2012 - Estorno de log ao desvincular SC do edital
	COMA080(SC1->C1_NUM,SC1->C1_ITEM,"SC1",{},"COI_DTHEDT","COI_UEDT",.T.,/*cUser*/,"COI_DOCEDT")
	
Return
/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � VrfErrQtde� Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Evita que usuario aumente a qtde do Edital       		   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function	VrfErrQtde(aPar6, aPar7, cPar1, cPar2, aPar13)		
Local cRet := "", nCont, nCont2
Local lTemItem := .F.
Local nPITEM   := GDFieldPos("CO2_ITEM",aPar13)
Local nPCODPRO := GDFieldPos("CO2_CODPRO",aPar13)
Local nPQUANT  := GDFieldPos("CO2_QUANT",aPar13)
                                                         
for nCont := 1 to  Len(aPar6)
                            
	for nCont2 := 1 to Len(aPar7)    
	                       
	    IF aPar7[nCont2][3] == .F.                        
	                
			if aPar6[nCont,nPQUANT] > 0
			    lTemItem := .T.             
		    EndIf
		    
	    	if aPar7[nCont2][2] == aPar6[nCont,nPCODPRO] //Os itens Nao necessariamente estao ordenados da mesma forma nestas duas arrays 
				if (aPar6[nCont,nPQUANT] > aPar7[nCont2][1]) 
			    	cRet := cRet + "Item: " + (aPar6[nCont,nPITEM]) +  " (Qtde: " + AllTrim(STR(aPar6[nCont,nPQUANT])) + ") " + ; 
        		        "� superior a Qtde Original ( " + AllTrim(STR(aPar7[nCont2][1])) + ") " + ENTER
				EndIf    
	
				cRet := cRet + QtSuperiorAsSolicitacoes (aPar6[nCont,nPQUANT],aPar7[nCont2][2], cPar1, cPar2)
				exit
			EndIf
		
		EndIf
	Next        
Next           

if !lTemItem                                                  
	cRet := "Informar Item para o Edital!"
EndIf

return(cRet)
                             
     /*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 被tSuperiorAsSolicitacoes� Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Evita que usu嫫io informe uma quantidade em tela , menor q 陰�
控�             a qtde original, mas maior que a somat鏎ia das solicita踥es陰�
控�             apontadas pelo usu嫫io!!                                   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/

Static Function QtSuperiorAsSolicitacoes(nQtInformada, cProd, cPar1, cPar2)
                                                                                        
Local cQuery,  cRet := ""
Local cTpCto        := GETMV("MV_TPSCCT")  // FSW - TIPO DE SC ADITIVO CONTRATO	
Local lProdUsouSolicitacoes := .F.                     

Select("SC1")	
cQuery := " SELECT SC1.* FROM " + RetSqlName('SC1') + " SC1 "
cQuery += " WHERE SC1.C1_CODED = '"  + cPar1 
cQuery += "' AND SC1.C1_NUMPR = '"  +  cPar2
cQuery += "' AND SC1.C1_PRODUTO = '" + cProd + "' "
cQuery += " AND SC1.C1_XTIPOSC <> '"+cTpCto+"' "

cQuery += " AND " + RetSQLCond("SC1")
cQuery += " ORDER BY SC1.C1_PRODUTO"                      

cQuery 	:= ChangeQuery(cQuery)     

dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),"TRB_SC1",.T.,.T.)
dbSelectArea("TRB_SC1") 
		                                  

while (TRB_SC1->(!Eof()))

	lProdUsouSolicitacoes := .T.
	Select("SC1")                     
	SC1->(dbSetOrder(1))

	If SC1->( MsSeek(TRB_SC1->(C1_FILIAL) + TRB_SC1->(C1_NUM) + TRB_SC1->(C1_ITEM)) ) 
	
   		if nQtInformada > 0
   		        

   		    if nQtInformada < SC1->(C1_QUANT)
				nQtInformada := 0                             
				
			else
				nQtInformada := nQtInformada - SC1->(C1_QUANT)
			EndIf
                                                                
		EndIf
		
	EndIf	
	
	dbSelectArea("TRB_SC1") 		                      
	TRB_SC1->(dbSKip())          
	            
End
		                   
if lProdUsouSolicitacoes .And. nQtInformada > 0 //Se a somat鏎ia das solicita蔞es n緌 s緌 suficientes para atender a qtde informada em tela ...ent緌 critica		                                                
	cRet :=  "Quantidade informada superior a somat鏎ia de Solicita踥es Apontadas!"  + ENTER 
EndIf

TRB_SC1->(dbCloseArea())

Return (cRet)                     

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � MontaListaQtdesOrginais� Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o � Monta vetor com lista de qtdes originalmente pedidas no Edital 陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  MontaListaQtdesOrginais(cPar1, cPar2, cPar3)  
Local aRet := {}
		
CO2->(dbSetOrder(1)) //CO2_FILIAL+CO2_CODEDT+CO2_NUMPRO+CO2_CODPRO
CO2->(dbSeek(cPar1 + cPar2 + cPar3) ) 
While CO2->(!EOF())  
			
	if CO2->(CO2_CODEDT) == cPar2 .and. CO2->(CO2_NUMPRO) == cPar3 
		Aadd(aRet, {CO2->(CO2_ORIG), CO2->(CO2_CODPRO), .F./*.F. <=> Item Existe no GRID da CO2*/   } )  
	Else
		Exit
	EndIf
			
CO2->(dbSkip())
EndDo
		
Return(aRet)

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 袖qlSolVinculadas � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o � Forca listar solciitacoes ja vinculadas a um item de edital 陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 � GCP01CNI          										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/                                

Static Function  SqlSolVinculadas(cPar1, cPar2, cPar3, cPar4)  
Local cRet := ""        

cRet := "  SELECT SC1.* "
cRet += " FROM " + RetSqlTab("SC1") 
cRet += " WHERE      SC1.C1_CODED = '" + cPar1 + "' "
cRet += " AND       SC1.C1_NUMPR = '"   + cPar2 + "' "       
cRet += " AND     SC1.C1_PRODUTO = '" + cPar3 + "' "
cRet += " AND     SC1.C1_XTIPOSC <> '"+ cPar4 + "' "
cRet += " AND " + RetSQLCond("SC1")
cRet += " UNION ALL "

Return(cRet)

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 � AjustStatus� Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o 蚶Uncao que habilita a rotina de acordo com o status do Edital陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function AjustStatus()
Local cParam :=  ''
public __lGCPCNI1 := .F.

Select("CO1")
	    	                  
cParam := SuperGetMV('MV_EDTPCO', .F., '  ', xFIlial("CO1"))  
                              
//PB -> PE ->ED ->PC ->PM ->HO ->TP ->AD ->AC

Do Case	    
		
    Case cParam == 'AC'    

    	if (CO1->CO1_ETAPA == 'AC' .or. CO1->CO1_ETAPA == 'AD' .or. CO1->CO1_ETAPA == 'TP' .or. CO1->CO1_ETAPA == 'HO' .or. ;
	    	CO1->CO1_ETAPA == 'PM' .or. CO1->CO1_ETAPA == 'PC' .or. CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or. ;
		    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 := .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf
	    		
	Case cParam == 'AD'  

	    if (CO1->CO1_ETAPA == 'AD' .or. CO1->CO1_ETAPA == 'TP' .or. CO1->CO1_ETAPA == 'HO' .or. ;
    	    CO1->CO1_ETAPA == 'PM' .or. CO1->CO1_ETAPA == 'PC' .or. CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or.  ;
    	    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf

  	Case cParam == 'TP'
  			  		
	    if (CO1->CO1_ETAPA == 'TP' .or. CO1->CO1_ETAPA == 'HO' .or. ;
    	    CO1->CO1_ETAPA == 'PM' .or. CO1->CO1_ETAPA == 'PC' .or. CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or.   ;
    	    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf
	    		
  	Case cParam == 'HO'
	
	    if (CO1->CO1_ETAPA == 'HO' .or. ;
    	    CO1->CO1_ETAPA == 'PM' .or. CO1->CO1_ETAPA == 'PC' .or. CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or.    ;
    	    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf
	    		
  	Case cParam == 'PM'
	
	    if (CO1->CO1_ETAPA == 'PM' .or. CO1->CO1_ETAPA == 'PC' .or. CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or.     ;
    	    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf
	    		
  	Case cParam == 'PC'
	
	    if (CO1->CO1_ETAPA == 'PC' .or. CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or.        ;
    	    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf
	    		
  	Case cParam == 'ED'
	                                                                    
	    if (CO1->CO1_ETAPA == 'ED' .or. CO1->CO1_ETAPA == 'PE' .or.    ;
    	    CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf
	    		
  	Case cParam == 'PE'
	
	    if (CO1->CO1_ETAPA == 'PE' .or.  CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf

  	Case cParam == 'PB'
	
	    if (CO1->CO1_ETAPA == 'PB' )
		    __lGCPCNI1 :=  .T.               
		Else
		    __lGCPCNI1 :=  .F.
		EndIf	    		
				
	EndCase

Return ()   


                           

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控奼迋迋迋迋迕迋迋迋迋迋迋迋冞迋迋迋敊迋迋迋迋迋迋迋迋迋迋冞迋迋迕迋迋迋迋迋迋芼控
控� MarcaExclInc   態utor  � Totvs               � Data �  24/01/12滷�
控昅迋迋迋迋阹迋迋迋迋迋迋迋庋迋迋迋玵迋迋迋迋迋迋迋迋迋迋庋迋迋迍迋迋迋迋迋迋芧控
控慣escricao �   Marca o Item do Edital como Excluido do Grid   pelo usu嫫io   滷�
控�          �                          ou Re-incluido no Grid                 滷�
控￢迋迋迋迋迍迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋芞控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function MarcaExclInc(cPar1, aPar7, lExcluindo)      
Local nIndexProd := 0, nCont := 0                          
Local cStr     := " "
nIndexProd := aScan(aPar7 , { | X | x[2] == cPar1 } )      
	          
if nIndexProd > 0                                      
	if lExcluindo
		aPar7[nIndexProd][3] := .T. //usuario excluiu item do grid    
	Else
		aPar7[nIndexProd][3] := .F. //usuario excluiu item do grid
	EndIf         
else  
	if !lExcluindo            
		 Select("CO2")      
   		 CO2->CO2_ORIG:= CO2->(CO2_QUANT) 
   		 
   	     Aadd(aPar7, {CO2->(CO2_QUANT), ; //ao incluir item pelo grid este nasce com qtd.original = qtde editada pelo usuario no grid de CO2!!!
   	          cPar1, .F./*.F. <=> Item Existe no GRID da CO2*/   } )  
 
	EndIf
EndIf
           
   
Return aPar7

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控奼迋迋迋迋迕迋迋迋迋迋迋迋冞迋迋迋敊迋迋迋迋迋迋迋迋迋迋冞迋迋迕迋迋迋迋迋迋芼控
控�     SetLstSolicitacoes  態utor  � Totvs               � Data �  24/01/12   滷�
控昅迋迋迋迋阹迋迋迋迋迋迋迋庋迋迋迋玵迋迋迋迋迋迋迋迋迋迋庋迋迋迍迋迋迋迋迋迋芧控
控慣escricao � Cria lista de solicitacoes de COmpra Editadas durante a Manut   滷�
控�          � a fim de destinguir quais devem ser consideradas ou nao         滷�
控￢迋迋迋迋迍迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋芞控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function SetLstSolicitacoes(aPar6, aPar7)      
Local nIndexProd := 0, nCont := 0                          
                          
for nCont := 1 to len(aPar7)//aDados
	nIndexProd := aScan(aPar6 , { | X | x[2] == aPar7[nCont][2] } )      
	          
	if nIndexProd > 0 
		aPar6[nIndexProd][1] := aPar7[nCont][1]//indica se SC est� marcada
		aPar6[nIndexProd][2] := aPar7[nCont][2]//nro da SC
		aPar6[nIndexProd][3] := aPar7[nCont][3]//Index item da SC
	else                         
		aadd (aPar6, {aPar7[nCont][1],aPar7[nCont][2],aPar7[nCont][3]}) 
	EndIf
Next                

Return aPar6       



/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控奼迋迋迋迋迕迋迋迋迋迋迋迋冞迋迋迋敊迋迋迋迋迋迋迋迋迋迋冞迋迋迕迋迋迋迋迋迋芼控
控�     AtQtde  態utor  � Totvs               � Data �  24/01/12   滷�
控昅迋迋迋迋阹迋迋迋迋迋迋迋庋迋迋迋玵迋迋迋迋迋迋迋迋迋迋庋迋迋迍迋迋迋迋迋迋芧控
控慣escricao � Cria lista de solicitacoes de COmpra Editadas durante a Manut   滷�
控�          � a fim de destinguir quais devem ser consideradas ou nao         滷�
控￢迋迋迋迋迍迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋迋芞控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function AtQtde(aPar7, nPar8)      
Local nIndexProd := 0, nCont := 0                          
                          
Select("CO2")
CO2->CO2_ORIG := nPar8
		
nIndexProd := aScan(aPar7 , { | X | x[2] == CO2->CO2_CODPRO } )      
	          
if nIndexProd > 0 
	aPar7[nIndexProd][1] := nPar8
EndIf

Return aPar7            



/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控                          
控蚶un��o	 � SetQtOrig� Autor � Oswaldo Leite         � Data �  25/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Ajusta a coluna referente a qtde orginal no grid CO2	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �          										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function	SetQtOrig()		//Sem uso provisoriamente
Local nCont, nCont2

//1 = array
//2 = grid
  
for nCont := 1 to Len(PARAMIXB[2])
                            
	for nCont2 := 1 to Len(PARAMIXB[1])    
	                       
	    IF PARAMIXB[1][nCont2][3] == .F.                        
	                
	    	if PARAMIXB[1][nCont2][2] == PARAMIXB[2][nCont][2] //Os itens Nao necessariamente estao ordenados da mesma forma nestas duas arrays 
				 PARAMIXB[2][nCont][7] = PARAMIXB[1][nCont2][1] 
			EndIf
		EndIf
		
	Next
	        
Next           

return(PARAMIXB[2])


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  TemRegsNaoMarkNoEstorno � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o � Define detalhes de edital que sofrer緌 estorno         	   陰�
控�            1 - edital passou p/estorno mas este Item nao fora estornado陰�
控�            2 - edital passou por estorno E este Item foi estornado     陰�
控�            0 - edital nao passou por estorno                           陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										           陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  TemRegsNaoMarkNoEstorno (cPar1, cPar2, nIgnoraItem)
Local lRet := .F.
Local cQuery
Local aArea		:= GetArea()        

cQuery := " SELECT CO2.* FROM " + RetSqlName('CO2')  + " CO2 "
cQuery += " WHERE CO2.CO2_CODEDT = '"  + cPar1  
cQuery += "'  AND CO2.CO2_NUMPRO = '"  + cPar2 

if nIgnoraItem == 0
	cQuery += "' AND (CO2.CO2_ESTORN = '1' )  "
else
	cQuery += "' AND (CO2.CO2_ESTORN = '1' or CO2.CO2_ESTORN = '2' )  "
EndIf                     

cQuery += " AND " + RetSQLCond("CO2")
cQuery 	:= ChangeQuery(cQuery)     


dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),"TRB_CO2",.T.,.T.)
dbSelectArea("TRB_CO2") 
		                           

if (TRB_CO2->(!Eof()))

    lRet := .T.             
    if nIgnoraItem == 0
	    MsgInfo("Edital foi submetido ao processo de Estorno. Para 'Cancelar' ser� necess嫫io apontar todos os Participantes envolvidos na pr闛ima opera誽o de Estorno.","Estorno")
    EndIf
End


TRB_CO2->(dbCloseArea())   
                                 

RestArea(aArea)
Return (lRet)             


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  NaoMarkNoEstorno � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �                                                      	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										           陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  NaoMarkNoEstorno (cPar1, cPar2, cPar3)
Local lRet := .F.
Local cQuery
Local aArea		:= GetArea() 
                
cQuery := " SELECT CO2.* FROM " + RetSqlName('CO2')  + " CO2 "
cQuery += " WHERE CO2.CO2_CODEDT = '"  + cPar1  
cQuery += "'  AND CO2.CO2_NUMPRO = '"  + cPar2 
cQuery += "'  AND CO2.CO2_ITEM = '"  + cPar3 
cQuery += "' AND CO2.CO2_ESTORN = '1'   "
cQuery += " AND " + RetSQLCond("CO2")
cQuery 	:= ChangeQuery(cQuery)     

dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),"TRB_CO2",.T.,.T.)
dbSelectArea("TRB_CO2") 
		                                  
if (TRB_CO2->(!Eof()))
    lRet := .T.
End
		                                                
TRB_CO2->(dbCloseArea())   

RestArea(aArea)
Return (lRet)             


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  MostraProd � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �                                                      	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										           陰�
控�      	 �    0 edital que nao passou por estorno  				       陰�
控�      	 �    1 fornecedor do respectivo item nao  apontado p/estorno  陰�
控�      	 �    2 fornecedor do respectivo item      apontado p/estorno  陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  MostraProd ()
Local lRet := .F.

Select("CO2")

if CO2->CO2_ESTORN != "1"
	lRet := .T.
EndIf

Return (lRet)            

/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  MostraFornec � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �                                                      	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �           										           陰�
控�      	 � Fornec estornado deixa de ser exibidos em um novo Andamento 陰�
控�          � (obs:mas se usuario criou novo item,apos o estorno, este pode 陰�
控�          � sim ter o fornec cancelado vinculado a este novo item!	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  MostraFornec ()
Local lRet := .F.

Select("CO3")

if CO3->CO3_XSTATU != "1"//fornec cancelado no momento do estorno
	lRet := .T.
EndIf

Return (lRet)                               


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  FiltroSql � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o �  Nao lista fornecedores cancelados                    	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �                  										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  FiltroSql ()   
Local aRet := {}                                     
Aadd(aRet," ,CO2.CO2_SLDEST SLDEST ")
Aadd(aRet," AND CO3.CO3_XSTATU <> '1' AND CO2.CO2_ESTORN <> '1' ")


//Evita Itens de Edital que n緌 foram estornados
//Evita fornecedors que foram cancelados
Return (aRet)                               



/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  PegaSaldo � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o � Apos o estorno, re-abre o Edital ocm o saldo restante   	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �                  										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  PgSaldo (cPar1, cPar2, cPar3 )
Local nRet := 0                     		 
Local cQuery
Local aArea		:= GetArea() 
                   
                   
cQuery := " SELECT CO2.CO2_SLDEST FROM " + RetSqlName('CO2')  + " CO2 "
cQuery += " WHERE CO2.CO2_CODEDT = '"  + cPar1  
cQuery += "'  AND CO2.CO2_NUMPRO = '"  + cPar2 
cQuery += "'  AND CO2.CO2_CODPRO = '"  + cPar3 + "' "
cQuery += " AND " + RetSQLCond("CO2")
cQuery 	:= ChangeQuery(cQuery)     
                
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),"TRBCO2",.T.,.T.)
dbSelectArea("TRBCO2") 
		                                  
if (TRBCO2->(!Eof())) 
    nRet := TRBCO2->(CO2_SLDEST)
End
		                                                
TRBCO2->(dbCloseArea())   

RestArea(aArea)
Return (nRet)      


/*/
嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈嗈
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
控矬闡闡闡闡鐃闡闡闡闡闡鐃闡闡闡鐃闡闡闡闡闡闡闡闡闡闡闡鐃闡闡闡薩闡闡闡闡醴控
控蚶un��o	 �  SaldoCO2 � Autor � Oswaldo Leite         � Data �  15/01/12陰�
控藥闡闡闡闡霰闡闡闡闡闡鐘闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡鐘闡闡闡謐闡闡闡闡譬控
控蛇escri��o � Apos o estorno, re-abre o Edital ocm o saldo restante   	   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袖intaxe	 �                  										   陰�
控藥闡闡闡闡霰闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡譬控
控袈arametros� 															   陰�
控斂闡闡闡闡鐘闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡闡囁控
控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控控
葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔葔
/*/
Static Function  SaldoCO2 ()
       
Select("CO2")

return (CO2->CO2_SLDEST)            

