#INCLUDE "PROTHEUS.CH" 

/*/{Protheus.doc} SF0516X
@description Gatilho para retornar o preço de venda na rotina de manutenção de contratos.
@author j2a.luizjunior
@since 02/08/2017
@version 1.0
@history 16/01/2019, Alan Teles de Oliveira, compatibilizando com Protheus 12 e documentando o fonte.
/*/
User Function SF0516X

	Local cEstat 	:= U_SFGN001A(ProcName(0), "SF0516X")	
	Local cCCC     	:= GetNewPar("MV_XCCCPRQ", "1301090103")
	Local nRet     	:= 0
	Local cTabela	:= '' 
	Local oModel	:= FwModelActive()
	Local oMdlCNA	:= oModel:GetModel('CNADETAIL')
	Local oMdlCNB	:= oModel:GetModel('CNBDETAIL')
	Local cProduto	:= oMdlCNB:GetValue('CNB_PRODUT')

	If !Empty(cTabela)
	
		DbSelectArea("DA1")
		DbSetOrder(1)
		If DbSeek(xFilial("DA1") + cTabela)

			While !DA1->(Eof()) .and. xFilial("DA1") == DA1->DA1_FILIAL .and.  cTabela == DA1->DA1_CODTAB

				IF cProduto == DA1->DA1_CODPRO

					nRet := DA1->DA1_PRCVEN

				EndIF	

				DA1->(DbSkip())

			EndDo

		Else	

			Aviso("Aviso", "Produto nao cadastrado na tabela de Preço: " + cTabela, {"Ok"}, 1)

			nRet := 0 

		EndIf
		
		oMdlCNB:LoadValue('CNB_CC', cCCC)
		
	EndIf
	 
Return nRet