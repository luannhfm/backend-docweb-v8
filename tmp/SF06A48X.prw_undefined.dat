#INCLUDE 'PROTHEUS.CH'
#INCLUDE 'RWMAKE.CH'
#INCLUDE 'FONT.CH'
#INCLUDE 'COLORS.CH'
#INCLUDE 'TOPCONN.CH'

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³          ³ Autor ³                       ³ Data ³          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Locacao   ³                  ³Contato ³                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descricao ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Aplicacao ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Analista Resp.³  Data  ³                                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³              ³  /  /  ³                                               ³±±
±±³              ³  /  /  ³                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/

User Function SF06A48X

	Local _lRet   := .T.
	Private _lFecha := .F.
	Private _lContinua := .T.
	Private cCadastro := "TeleCobrança - Inclusão de Atendimentos"
	Private INCLUI := .F.
	/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±± Declaração de cVariable dos componentes                                 ±±
	Ù±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
	Private _oVerde	   := LoadBitmap( GetResources(), "BR_VERDE"   )
	Private _oAzul     := LoadBitmap( GetResources(), "BR_AZUL   " )
	Private _oVermelho := LoadBitmap( GetResources(), "BR_VERMELHO")
	Private _oOk       := LoadBitmap( GetResources(), "LBOK" )
	Private _oNo       := LoadBitmap( GetResources(), "LBNO" )
	Private _aParams   := {}
	Private _cGet1     := GetSX8Num("ZAK","ZAK_COD")
	ConfirmSX8()
	Private _dGet2     := dDataBase
	Private _cGet3     := Subs(Time(),1,5)
	Private _cGet4     := ZAJ->ZAJ_CLIENTE
	Private _cGet5     := ZAJ->ZAJ_LOJA
	Private _cGet6     := ZAJ->ZAJ_NOME
	Private _dGet8     := CtoD(" ")
	Private _cGet9     := "00:00"
	Private _cGet10    := GetSX8Num("ZAL","ZAL_COD")
	ConfirmSX8()
	Private _dGet11    := dDataBase
	Private _cGet12    := _aOper[4]
	Private _dGet13    := CtoD(" ")
	Private _nGet14    := 0
	Private _nGet15    := 0
	Private _nGet16    := 0
	Private _nGet17    := 0
	Private _nGet18    := 0
	Private _nGet19    := 0
	Private _nGet20    := 0
	Private _nGet21    := 0
	Private _nGet22    := 0
	Private _nGet23    := 0
	Private _nGet24    := 0
	Private _nGet25    := 0
	Private _nGet26    := 0
	Private _nGet27    := 0
	Private _nGet28    := 0
	Private _nGet29    := 0
	Private _nGet30    := 0
	Private _dGet31    := CtoD(" ")
	Private _dGet32    := CtoD(" ")
	Private _nGet33    := 0
	Private _dGet34    := dDataBase
	Private _cMGet1
	Private _nCBox1
	Private _nCBox2
	Private _aCBox1    := U_TcMotivo(Subs(_aCBox[_oCBox:nAt],1,3))
	Private _lCBox3    := .F.
	Private _aHead1    := {}
	Private _aColS1    := {}
	Private _aBrw1     := {}
	Private _aHead2    := {}
	Private _aColS2    := {}
	Private _aBrw2     := {}
	Private _aHead3    := {}
	Private _aColS3    := {}
	Private _aBrw3     := {}
	Private _aHead4    := {}
	Private _aColS4    := {}
	Private _aBrw4     := {}
	Private _aHead5    := {}
	Private _aColS5    := {}
	Private _aBrw5     := {}
	Private aRotina	 := {	{"Pesquisar" , "AxPesqui" , 0 , 1},;  //Variavel privada para utilizar o programa Crd010Man
		{"Visualizar", "AxVisual" , 0 , 2},;
		{"Consultar" , "FC010CON" , 0 , 2},;
		{"Impressao" , "FC010IMP" , 0 , 4}}

	/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±± Declaração de Variaveis Private dos Objetos                             ±±
	Ù±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
	SetPrvt("_oFA08","_oFA08N","_oDlg2","_oGrp1","_oTxt8","_oTxt9","_oTxt10","_oTxt11","_oTxt12","_oTxt13","_oTxt14")
	SetPrvt("_oTxt15","_oTxt16","_oTxt17","_oTxt18","_oTxt19","_oTxt20","_oTxt21","_oTxt22","_oTxt23","_oTxt24","_oTxt25","_oTxt26","_oTxt27","_oTxt28")
	SetPrvt("_oGet1","_oGet2","_oGet3","_oGet4","_oGet5","_oGet6","_oMGet1","_oGet9","_oGet8","_oGet10","_oGet11","_oGet12","_oGet13","_oGet14","_oGet15")
	SetPrvt("_oGet16","_oGet17","_oGet18")
	SetPrvt("_oGet13","_oGet14","_oGet15","_oGet16","_oGet17","_oGet18","_oGet19","_oGet20","_oGet21","_oGet22","_oGet23","_oGet24","_oGet25","_oGet26")
	SetPrvt("_oGet27","_oGet28","_oGet29","_oGet30","_oGet31","_oGet32","_oGet33","_oGet34")
	SetPrvt("_oGrp2","_oGrp3","_oGrp4","_oGrp5","_oGrp6","_oGrp7","_oGrp8","_oGrp9","_oGrp10","_oGrp11","_oGrp12","_oGrp13")
	SetPrvt("_oBmp5","_oBtn6","_oBtn7","_oBtn8","_oBtn9","_oBtn10","_oBtn11","_oBtn12","_oBtn13","_oBtn14","_oBrw1","_oBrw2","_oBrw3")
	SetPrvt("_oCBox1","_oCBox2","_oCBox3","_oBtn15")

	//Obtenho os parametros da ZAO
	_aParams := U_TcParam()
	_dGet8  := dDataBase
	_dGet13 := dDataBase

	//Habilito os atalhos
	//A008XKey(.T.)
	SetKey(12,{||fCliente(1)}) 	          //CTRL+L
	SetKey(18,{||fCliente(2)})            //CTRL+R
	SetKey(07,{||_lRet := fGraIni(@_lFecha), _oDlg2:End()}) //CTRL+G
	SetKey(05,{||fAviso()}) //CTRL+E
	SetKey(06,{||fSair(@_lFecha,@_lRet)}) //CTRL+F
	SetKey(13,{||fMarcAll(.T.)})          //CTRL+M
	SetKey(21,{||fMarcAll(.F.)})          //CTRL+U

	aSize := MsAdvSize()
	aObjects := {} 
	AAdd( aObjects, { 100, 100, .T., .T. } )
	aInfo   := { aSize[ 1 ], aSize[ 2 ], aSize[ 3 ], aSize[ 4 ], 3, 3 }
	aPosObj := MsObjSize( aInfo, aObjects )
	/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±± Definicao do Dialog e todos os seus componentes.                        ±±
	Ù±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
	_oFA06     := TFont():New( "Arial",0,-11,,.F.,0,,400,.F.,.F.,,,,,, )
	_oFA08     := TFont():New( "Arial",0,-11,,.F.,0,,400,.F.,.F.,,,,,, )
	_oFA08N    := TFont():New( "Arial",0,-11,,.T.,0,,700,.F.,.F.,,,,,, )
	_oFC08     := TFont():New( "Courier New",0,-11,,.F.,0,,400,.F.,.F.,,,,,, )
	_oDlg2     := MSDialog():New( aSize[7], aSize[8], aSize[6], aSize[5],"TeleCobrança - Inclusão de Atendimentos",,,.F.,,,,,,.T.,,_oFA08N,.T.)
	_oGrp1     := TGroup():New( 000,004,126,181," Dados do Atendimento... "                ,_oDlg2,CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGrp2     := TGroup():New( 000,186,063,aPosObj[1,4]-20," Atendimentos realizados... "             ,_oDlg2,CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGrp3     := TGroup():New( 063,186,126,aPosObj[1,4]-20," Negociações/Renegociações realizadas... ",_oDlg2,CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGrp4     := TGroup():New( 125,004,297,aPosObj[1,4]-20," Dados da Renegociação... "               ,_oDlg2,CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oTxt8     := TSay():New( 012,006,{||"Código"                                                    },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt9     := TSay():New( 024,006,{||"Data"                                                      },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt10    := TSay():New( 024,097,{||"Hora"                                                      },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt11    := TSay():New( 037,006,{||"Cliente"                                                   },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt12    := TSay():New( 037,097,{||"Loja"                                                      },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt13    := TSay():New( 049,006,{||"Nome"                                                      },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt14    := TSay():New( 062,006,{||"Observação"                                                },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLUE ,CLR_WHITE,034,008)
	_oTxt17    := TSay():New( 099,006,{||"Motivo"                                                    },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLUE ,CLR_WHITE,042,008)
	_oTxt15    := TSay():New( 112,006,{||"Data Próx. Aten."                                          },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLUE ,CLR_WHITE,042,008)
	_oTxt16    := TSay():New( 112,097,{||"Hora Próx. Aten."                                          },_oGrp1,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLUE ,CLR_WHITE,042,008)
	_oTxt18    := TSay():New( 054,323,{||"* Duplo click para visualizar a observação do atendimento."},_oGrp2,,_oFA08,.F.,.F.,.F.,.T.,CLR_RED  ,CLR_WHITE,142,008)
	_oTxt19    := TSay():New( 117,344,{||"* Duplo click para visualizar os títulos negociados."      },_oGrp3,,_oFA08,.F.,.F.,.F.,.T.,CLR_RED  ,CLR_WHITE,121,008)
	_oTxt20    := TSay():New( 135,009,{||"Código"                                                    },_oGrp4,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt21    := TSay():New( 135,085,{||"Data"                                                      },_oGrp4,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt22    := TSay():New( 135,161,{||"Situação"                                                  },_oGrp4,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,025,008)
	_oTxt23    := TSay():New( 135,267,{||"Autorização"                                               },_oGrp4,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,042,008)
	_oTxt24    := TSay():New( 135,412,{||"Validade"                                                  },_oGrp4,,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,042,008)

	_oGet1     := TGet():New( 010,048,{|u| If(PCount()>0,_cGet1:=u,_cGet1)}  ,_oGrp1,037,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet1" ,,)
	_oGet1:Disable()
	_oGet2     := TGet():New( 022,048,{|u| If(PCount()>0,_dGet2:=u,_dGet2)}  ,_oGrp1,039,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet2" ,,)
	_oGet2:Disable()
	_oGet3     := TGet():New( 022,139,{|u| If(PCount()>0,_cGet3:=u,_cGet3)}  ,_oGrp1,037,009,'@! 99:99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet3" ,,)
	_oGet3:Disable()
	_oGet4     := TGet():New( 035,048,{|u| If(PCount()>0,_cGet4:=u,_cGet4)}  ,_oGrp1,026,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet4" ,,)
	_oGet4:Disable()
	_oGet5     := TGet():New( 035,139,{|u| If(PCount()>0,_cGet5:=u,_cGet5)}  ,_oGrp1,012,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet5" ,,)
	_oGet5:Disable()
	_oGet6     := TGet():New( 048,048,{|u| If(PCount()>0,_cGet6:=u,_cGet6)}  ,_oGrp1,128,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet6" ,,)
	_oGet6:Disable()
	_oMGet1    := TMultiGet():New( 061,048,{|u| If(PCount()>0,_cMGet1:=u,_cMGet1)},_oGrp1,127,034,_oFA08,,CLR_BLACK,CLR_WHITE,,.T.,"",,,.F.,.F.,.F.,,,.F.,,  )
	_oCBox1    := TComboBox():New( 097,048,{|u| If(PCount()>0,_nCBox1:=u,_nCBox1)},_aCBox1,128,011,_oGrp1,,,,CLR_BLACK,CLR_WHITE,.T.,_oFA08,"",,,,,,,_nCBox1 )
	_oGet8     := TGet():New( 110,048,{|u| If(PCount()>0,_dGet8:=u,_dGet8)}  ,_oGrp1,039,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet8" ,,)
	_oGet8:bValid := {||fDatAte()}
	_oGet9     := TGet():New( 110,139,{|u| If(PCount()>0,_cGet9:=u,_cGet9)}  ,_oGrp1,037,009,'@! 99:99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet9" ,,)
	_oGet9:bValid := {||fHorAte()}

	_oGet10    := TGet():New( 133,038,{|u| If(PCount()>0,_cGet10:=u,_cGet10)},_oGrp4,037,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet10",,)
	_oGet10:Disable()
	_oGet11    := TGet():New( 133,114,{|u| If(PCount()>0,_dGet11:=u,_dGet11)},_oGrp4,039,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet11",,)
	_oGet11:Disable()
	_oCBox2    := TComboBox():New( 133,193,{|u| If(PCount()>0,_nCBox2:=u,_nCBox2)},{"Em Andamento"},070,011,_oGrp4,,,,CLR_BLACK,CLR_WHITE,.T.,_oFA08,"",,,,,,,_nCBox2 )
	_oCBox2:Disable()
	_oGet12    := TGet():New( 133,309,{|u| If(PCount()>0,_cGet12:=u,_cGet12)},_oGrp4,062,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_cGet12",,)
	_oGet12:Disable()
	_oCBox3    := TCheckBox():New( 135,371,"Superior",{|u| If(PCount()>0,_lCBox3:=u,_lCBox3)},_oDlg2,050,008,,,_oFA08N,,CLR_BLACK,CLR_WHITE,,.T.,"",, )
	_oCBox3:Disable()
	_oGet13    := TGet():New( 133,439,{|u| If(PCount()>0,_dGet13:=u,_dGet13)},_oGrp4,039,009,''        ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet13",,)
	_oGet13:bValid := {||fDatVal()}

//	_oBmp5     := TBitmap():New( 000,aSize[5]-100,018,307,,"PROJETOAP",.T.,_oDlg2,,,.T.,.T.,,"",.T.,,.T.,,.F.)
	_oBtn8     := TBtnBmp2():New( 002,aSize[5]-40,035,25,"CLIENTE" ,,,,{||fCliente(1)},_oDlg2,"Cadastro Cliente - <Ctrl+L>"  ,,.F.,.F. )
	_oBtn7     := TBtnBmp2():New( 032,aSize[5]-40,035,25,"RESPONSA",,,,{||fCliente(2)},_oDlg2,"Referencias - <Ctrl+R>",,.F.,.F. )
	_oBtn9     := TBtnBmp2():New( 062,aSize[5]-40,035,25,"TK_FONE" ,,,,{||fAviso()},_oDlg2,"Exibe Contatos - <Ctrl+E>"       ,,.F.,.F. )
	_oBtn10    := TBtnBmp2():New( 092,aSize[5]-40,035,25,"SALVAR"  ,,,,{||_lRet := fGraIni(@_lFecha), _oDlg2:End()},_oDlg2,"Gravar - <Ctrl+G>"            ,,.F.,.F. )
	_oBtn11    := TBtnBmp2():New( 122,aSize[5]-40,035,25,"FINAL"   ,,,,{||fSair(@_lFecha,@_lRet)},_oDlg2,"Fechar - <Ctrl+F>",,.F.,.F. )
	_oBtn11    := TBtnBmp2():New( 152,aSize[5]-40,035,25,"CLIPS"   ,,,,{||RunReport()},_oDlg2,"Projeção de renegociação",,.F.,.F. )
	_oBtn80    := TBtnBmp2():New( 182,aSize[5]-40,035,25,"SUMARIO" ,,,,{||U_His06A01()  	},_oDlg2,"Hist. Antigo",,.F.,.F. )
	_oFld1     := TFolder():New( 145,006,{"Títulos","Negociação/Renegociação"},{},_oDlg2,,,,.T.,.F.,aPosObj[1,4]-30,150,)
//	_oFld1     := TFolder():New( 145,006,{"Títulos","Negociação/Renegociação"},{},_oDlg2,,,,.T.,.F.,aSize[4]-710,aSize[3]/2-150,)
	_oFld1:bSetOption := {||fVldFld()}
	_oBtn12    := TBtnBmp2():New( 156,0005,030,30,"SELECTALL"  ,,,,{||fMarcAll(.T.)},_oFld1:aDialogs[1],"Marcar Todos - <Ctrl+M>",,.F.,.F. )
	_oBtn13    := TBtnBmp2():New( 156,0035,030,30,"UNSELECTALL",,,,{||fMarcAll(.F.)},_oFld1:aDialogs[1],"Desmarcar Todos - <Ctrl+U>",,.F.,.F. )
	_oBtn14    := TBtnBmp2():New( 190,005 ,025,025,"BUDGET" ,,,,{|| DescCapital() },_oFld1:aDialogs[1],"Desconto sobre o valor capital",,.F.,.F. )

	_oBtn15    := TBtnBmp2():New( 190,0035,025,025,"BUDGETY" ,,,,{||u_MMTC8XRK()},_oFld1:aDialogs[1],"Desconto sobre o titulo selecionado",,.F.,.F. )

	_oGrp25    := TGroup():New( 079,036,099,078,"Data Base",_oFld1:aDialogs[1],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet34    := TGet():New( 086,038,{|u| If(PCount()>0,_dGet34:=u,_dGet34)},_oFld1:aDialogs[1],040,009,'',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet34",,)
	_oGet34:bValid :=  {||fDatBas()}
	_oGrp5     := TGroup():New( 079,80,117,132,"Tot. Financ.",_oFld1:aDialogs[1],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet14    := TGet():New( 086,82,{|u| If(PCount()>0,_nGet14:=u,_nGet14)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet14",,)
	_oGet14:Disable()
	_oGrp9     := TGroup():New( 097,80,117,132,"Selecionado",_oFld1:aDialogs[1],CLR_GREEN,CLR_WHITE,.T.,.F. )
	_oGet18    := TGet():New( 104,82,{|u| If(PCount()>0,_nGet18:=u,_nGet18)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet18",,)
	_oGet18:Disable()
	
	_oGrp6     := TGroup():New( 079,137,117,189,"Tot. Juros"  ,_oFld1:aDialogs[1],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet15    := TGet():New( 086,139,{|u| If(PCount()>0,_nGet15:=u,_nGet15)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet15",,)
	_oGet15:Disable()
	_oGrp10    := TGroup():New( 097,137,117,189,"Selecionado",_oFld1:aDialogs[1],CLR_GREEN,CLR_WHITE,.T.,.F. )
	_oGet19    := TGet():New( 104,139,{|u| If(PCount()>0,_nGet19:=u,_nGet19)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet19",,)
	_oGet19:Disable()

	_oGrp7     := TGroup():New( 079,194,117,246,"Tot. Multa"  ,_oFld1:aDialogs[1],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet16    := TGet():New( 086,196,{|u| If(PCount()>0,_nGet16:=u,_nGet16)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet16",,)
	_oGet16:Disable()
	_oGrp11    := TGroup():New( 097,194,117,246,"Selecionado",_oFld1:aDialogs[1],CLR_GREEN,CLR_WHITE,.T.,.F. )
	_oGet20    := TGet():New( 104,196,{|u| If(PCount()>0,_nGet20:=u,_nGet20)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet20",,)
	_oGet20:Disable()


	_oGrp8     := TGroup():New( 079,251,117,303,"Tot. a pagar",_oFld1:aDialogs[1],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet17    := TGet():New( 086,253,{|u| If(PCount()>0,_nGet17:=u,_nGet17)},_oFld1:aDialogs[1],050,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet17",,)
	_oGet17:Disable()
	_oGrp12    := TGroup():New( 097,251,117,303,"Selecionado",_oFld1:aDialogs[1],CLR_GREEN,CLR_WHITE,.T.,.F. )
	_oGet21    := TGet():New( 104,253,{|u| If(PCount()>0,_nGet21:=u,_nGet21)},_oFld1:aDialogs[1],050,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet21",,)
	_oGet21:Disable()

	ndesloc :=38
	_oGrp13    := TGroup():New( 079,270+ndesloc,098,368+ndesloc,"Desconto sobre juros...",_oFld1:aDialogs[1],CLR_BLUE ,CLR_WHITE,.T.,.F. )
	_oGet22    := TGet():New( 086,272+ndesloc,{|u| If(PCount()>0,_nGet22:=u,_nGet22)},_oFld1:aDialogs[1],023,009,'@E 999.99'   ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet22",,)
	_oGet22:bValid := {||fPrcJur()}
	_oGet22:Disable()
	_oTxt25    := TSay():New( 088,304+ndesloc,{||"%" },_oFld1:aDialogs[1],,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,008,008)
	_oTxt26    := TSay():New( 088,311+ndesloc,{||"R$"},_oFld1:aDialogs[1],,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,008,008)
	_oGet23    := TGet():New( 086,319+ndesloc,{|u| If(PCount()>0,_nGet23:=u,_nGet23)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet23",,)
	_oGet23:bValid := {||fValJur()}
	_oGet23:Disable()
	_oGrp15    := TGroup():New( 097,270+ndesloc,117,316+ndesloc,"Financ. Reg.",_oFld1:aDialogs[1],CLR_RED,CLR_WHITE,.T.,.F. )
	_oGet26    := TGet():New( 104,272+ndesloc,{|u| If(PCount()>0,_nGet26:=u,_nGet26)},_oFld1:aDialogs[1],023,009,'@E 99,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet26",,)
	_oGet26:Disable()
	_oGrp16    := TGroup():New( 097,317+ndesloc,117,368+ndesloc,"Juros Reg."  ,_oFld1:aDialogs[1],CLR_RED,CLR_WHITE,.T.,.F. )
	_oGet27    := TGet():New( 104,319+ndesloc,{|u| If(PCount()>0,_nGet27:=u,_nGet27)},_oFld1:aDialogs[1],049,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet27",,)
	_oGet27:Disable()

ndesloc :=48
	_oGrp14    := TGroup():New( 079,364+ndesloc,098,462+ndesloc,"Desconto sobre multa...",_oFld1:aDialogs[1],CLR_BLUE ,CLR_WHITE,.T.,.F. )
	_oGet24    := TGet():New( 086,366+ndesloc,{|u| If(PCount()>0,_nGet24:=u,_nGet24)},_oFld1:aDialogs[1],023,009,'@E 999.99'   ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet24",,)
	_oGet24:bValid := {||fPrcMul()}
	_oGet24:Disable()
	_oTxt27    := TSay():New( 088,398+ndesloc,{||"%" },_oFld1:aDialogs[1],,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,008,008)
	_oTxt28    := TSay():New( 088,405+ndesloc,{||"R$"},_oFld1:aDialogs[1],,_oFA08,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,008,008)
	_oGet25    := TGet():New( 086,413+ndesloc,{|u| If(PCount()>0,_nGet25:=u,_nGet25)},_oFld1:aDialogs[1],049,009,'@E 999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet25",,)
	_oGet25:bValid := {||fValMul()}
	_oGet25:Disable()

	_oGrp17    := TGroup():New( 097,364+ndesloc,117,410+ndesloc,"Multa Reg."  ,_oFld1:aDialogs[1],CLR_RED,CLR_WHITE,.T.,.F. )
	_oGet28    := TGet():New( 104,366+ndesloc,{|u| If(PCount()>0,_nGet28:=u,_nGet28)},_oFld1:aDialogs[1],023,009,'@E 99,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet28",,)
	_oGet28:Disable()
	_oGrp18    := TGroup():New( 097,411+ndesloc,117,462+ndesloc,"A pagar Reg.",_oFld1:aDialogs[1],CLR_RED,CLR_WHITE,.T.,.F. )
	_oGet29    := TGet():New( 104,413+ndesloc,{|u| If(PCount()>0,_nGet29:=u,_nGet29)},_oFld1:aDialogs[1],050,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA06,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet29",,)
	_oGet29:Disable()

	_oGrp19    := TGroup():New( 004,004,096,233," Condições de Pagamento ",_oFld1:aDialogs[2],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGrp20    := TGroup():New( 004,238,096,396," Parcelamento Proposto " ,_oFld1:aDialogs[2],CLR_BLACK,CLR_WHITE,.T.,.F. )

	_oGrp21    := TGroup():New( 004,400,026,465," Valor 1ª Parcela ",_oFld1:aDialogs[2],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet30    := TGet():New( 012,402,{|u| If(PCount()>0,_nGet30:=u,_nGet30)},_oFld1:aDialogs[2],050,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet30",,)
	_oGet30:bValid := {||fValEnt()}
	_oGrp22    := TGroup():New( 025,400,047,465," Data 1ª Parcela " ,_oFld1:aDialogs[2],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet31    := TGet():New( 033,402,{|u| If(PCount()>0,_dGet31:=u,_dGet31)},_oFld1:aDialogs[2],050,009,'@E 99,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet31",,)
	_oGet31:bValid := {||fDatEnt()}
	_oGrp23    := TGroup():New( 047,400,069,465," Data 2ª Parcela " ,_oFld1:aDialogs[2],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet32    := TGet():New( 055,402,{|u| If(PCount()>0,_dGet32:=u,_dGet32)},_oFld1:aDialogs[2],050,009,'@E 99.99'   ,,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_dGet32",,)
	_oGet32:bValid := {||fDatSeg()}
	_oGrp24    := TGroup():New( 069,400,091,465," Total Negociação ",_oFld1:aDialogs[2],CLR_BLACK,CLR_WHITE,.T.,.F. )
	_oGet33    := TGet():New( 077,402,{|u| If(PCount()>0,_nGet33:=u,_nGet33)},_oFld1:aDialogs[2],050,009,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,_oFA08,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","_nGet33",,)
	_oGet33:Disable()

	//Array com os campos da grade de dados
	_aHead1 := {"Código","Data Atend.","Hora Atend.","Operador","Motivo", "Dt.Prox.Atend", "Hr.Prox.Atend"}
	//Criacao do objeto ListBox
	_oBrw1  := TCBrowse():New(007,190,aPosObj[1,4]-217,045,,_aHead1,_aColS1,_oGrp1,,,,,{||},,_oFC08,,,,,.F.,,.T.,,.F.,,,)
	//regra para carregar o array da list box
	fBrw1()
	//Seta o array da listbox
	_oBrw1:SetArray(_aBrw1)
	//atualiza a grade de dados
	_oBrw1:bLine :={|| {_aBrw1[_oBrw1:nAt,01],;
		StoD(_aBrw1[_oBrw1:nAt,02]),;
		_aBrw1[_oBrw1:nAt,03],;
		_aBrw1[_oBrw1:nAt,04],;
		_aBrw1[_oBrw1:nAt,05],;
		StoD(_aBrw1[_oBrw1:nAt,06]),;
		_aBrw1[_oBrw1:nAt,07]}}
	_oBrw1:bLDblClick := {|| fObserv()}

	//Array com os campos da grade de dados
	_aHead2 := {" ","Codigo","Data Atend.","Hora Atend.","Operador","Validade","Cond. Pgto","% Juros","Vlr.Jur","% Multa","Vlr.Mul","Vlr.Finan.","Vlr.Dev","Vlr.Neg","Fil.Neg"}
	//Criacao do objeto ListBox
	_oBrw2  := TCBrowse():New(070,190,aPosObj[1,4]-217,045,,_aHead2,_aColS2,_oGrp2,,,,,{||},,_oFC08,,,,,.F.,,.T.,,.F.,,,)
	//regra para carregar o array da list box
	fBrw2()
	//Seta o array da listbox
	_oBrw2:SetArray(_aBrw2)
	//atualiza a grade de dados
	_oBrw2:bLine :={|| {fCor(_aBrw2[_oBrw2:nAt,01]),;
		_aBrw2[_oBrw2:nAt,02],;
		StoD(_aBrw2[_oBrw2:nAt,03]),;
		_aBrw2[_oBrw2:nAt,04],;
		_aBrw2[_oBrw2:nAt,05],;
		StoD(_aBrw2[_oBrw2:nAt,06]),;
		_aBrw2[_oBrw2:nAt,07],;
		Transform(_aBrw2[_oBrw2:nAt,08],"@E 999.99"),;
		Transform(_aBrw2[_oBrw2:nAt,09],"@E 999,999.99"),;
		Transform(_aBrw2[_oBrw2:nAt,10],"@E 999.99"),;
		Transform(_aBrw2[_oBrw2:nAt,11],"@E 999,999.99"),;
		Transform(_aBrw2[_oBrw2:nAt,12],"@E 999,999.99"),;
		Transform(_aBrw2[_oBrw2:nAt,13],"@E 999,999.99"),;
		Transform(_aBrw2[_oBrw2:nAt,14],"@E 999,999.99"),;
		_aBrw2[_oBrw2:nAt,15]}}
	_oBrw2:bLDblClick := {|| fTitulo()}

	//Array com os campos da grade de dados
	//          01   02     03      04         05    06   07        08      09       10      11                 12      13      14       	  15            16
	_aHead3 := {" ","Loja","Pref","No.Titulo","Par","TP","Emissão","Venc.","Atraso","Saldo","Com Desc Capital","Juros","Multa","Desc Juros", "Desc Multa","A Pagar"}
	//Array com o tamanho dos campos da grade
	//	_aColS3 := {1,20,20,30,15,15,20,20,30,50,35,35,50}
	//_aColS3 := {1,15,20,30,15,15,20,20,25,40,40,40,35,40}
	_aColS3 := Array(Len(_aHead3))
	_aColS3[Len(_aHead3)] := 65
	//Criacao do objeto ListBox
	_oBrw3  := TCBrowse():New(000,004,aPosObj[1,4]-40,078,,_aHead3,_aColS3,_oFld1:aDialogs[1],,,,,{||},,_oFC08,,,,,.F.,,.T.,,.F.,,,)
//	_oBrw3  := TCBrowse():New(000,004,452,078,,_aHead3,_aColS3,_oFld1:aDialogs[1],,,,,{||},,_oFC08,,,,,.F.,,.T.,,.F.,,,)
	//regra para carregar o array da list box
	fBrw3()
	//Duplo clique no objeto
	_oBrw3:bLDblClick := {|| fMarca( _oBrw3:nAt )}

	//Array com os campos da grade de dados
	_aHead4 := {" ","Codigo","Condição Pagamento","Simulação"}
	//Array com o tamanho dos campos da grade
	//_aColS4 := {1,30,50,50}
	//Criacao do objeto ListBox
	_oBrw4  := TCBrowse():New(014,008,220,078,,_aHead4,_aColS4,_oFld1:aDialogs[2],,,,,{||},,_oFC08,,,,,.F.,,.T.,,.F.,,,)
	//regra para carregar o array da list box
	aAdd(_aBrw4,{.F.,"","",""})
	//Seta o array da listbox
	_oBrw4:SetArray(_aBrw4)
	//atualiza a grade de dados
	_oBrw4:bLine :={|| {If(_aBrw4[_oBrw4:nAT,01],_oOk,_oNo),;
		_aBrw4[_oBrw4:nAt,02],;
		_aBrw4[_oBrw4:nAt,03],;
		_aBrw4[_oBrw4:nAt,04]}}
	//Duplo clique no objeto
	_oBrw4:bLDblClick := {|| fMarc4( _oBrw4:nAt)}

	//Array com os campos da grade de dados
	_aHead5 := {"Parcela","Vencimento","Valor"}
	//Criacao do objeto ListBox
	_oBrw5  := TCBrowse():New(014,242,150,078,,_aHead5,_aColS5,_oFld1:aDialogs[2],,,,,{||},,_oFC08,,,,,.F.,,.T.,,.F.,,,)
	//regra para carregar o array da list box
	aAdd(_aBrw5,{"","",""})
	//Seta o array da listbox
	_oBrw5:SetArray(_aBrw5)
	//atualiza a grade de dados
	_oBrw5:bLine :={|| {_aBrw5[_oBrw5:nAt,01],;
		_aBrw5[_oBrw5:nAt,02],;
		Transform(_aBrw5[_oBrw5:nAt,03],"@E 99,999.99")}}

	//Se os titulos foram pagos depois da geracao da lista, sai da cobranca,
	If !_lContinua
		Alert("O cliente realizou o pagamento de todos os titulos após a geração da lista, possui cobrança judicial ou não possui pendências para sua unidade. Por favor, verifique.")
		_lFecha := .F.
		_lRet := .T.
		//_oDlg2:End()
	EndIF

	_oDlg2:Activate(,,,.T.,{||_lFecha},,{||fAviso()})

Return(_lRet)


/*/{Protheus.doc} RunReport
	@description
	@type Static Function
	@author Rafael Karczevski
	@since 03/03/2020
	@version 1.0
/*/
Static Function RunReport()

	Local nX
	Local aDadosX := {}
	Local nCount := 0
	Local cFilTIt

	For nX := 1 to Len(_aBrw3)
		If _aBrw3[nX][1]
			cFilTit := _aBrw3[nX][2]	
			nCount++
			aAdd(aDadosX, {;
					.T.,;						 	                                                           //[01] Selecao
					_aBrw3[nX][4],;				                                                           //[02] Titulo
					_aBrw3[nX][6],;				                                                           //[03] Tipo
					_aBrw3[nX][3],;			                                                           //[04] Prefixo
					_aBrw3[nX][5],;			                                                           //[05] Parcela
					STOD(_aBrw3[nX][8]),;		                                                           //[06] Vencimento
					_aBrw3[nX][10],;					                                             //[07] Saldo
					_aBrw3[nX][12],;					                                             //[08] Juros
					_aBrw3[nX][13],;					                                             //[09] Multa
					_aBrw3[nX][12] + _aBrw3[nX][13],;                                                //[10] Juros + Multa
					_aBrw3[nX][09],; 																 //[11] Dias Atraso
					(_aBrw3[nX][14] + _aBrw3[nX][15]) / (_aBrw3[nX][12] + _aBrw3[nX][13]) *100,;     //[12] % de Desconto
					_aBrw3[nX][16] - _aBrw3[nX][10],;	                                             //[13] Valor de Desconto
					_aBrw3[nX][16],;				                                                 //[14] A Receber
					(_aBrw3[nX][10] - _aBrw3[nX][11]) / _aBrw3[nX][10] * 100,;                       //[15] % de desconto titulo
					_aBrw3[nX][10] - _aBrw3[nX][11],;                                                //[16] Valor de desconto titulo
					"",;							                                                 //[17] Chave de busca financeiro
					"",;							                                                 //[18] Chave de busca cliente
					0,;			                                                           			 //[19] Percentual de juros
					0 ,;			                                                           		 //[20] R_E_C_N_O_
					.F.,;                                                                            //[21] 
					0,;       		                                                           		 //[22] Decrescimo
					POSICIONE("SE1",1, _aBrw3[nX][2]+_aBrw3[nX][3]+_aBrw3[nX][4]+_aBrw3[nX][5]+_aBrw3[nX][6],"E1_VALOR"),;				                                                 //[23] Valor
					StoD("        "),;      	                                                     //[24] Data Baixa Parcial
					StoD(_aBrw3[nX][8]),;		                                                     //[25] Data Vencimeto 
					0,;																				 //[26] Valor de desconto
					POSICIONE("SE1",1, _aBrw3[nX][2]+_aBrw3[nX][3]+_aBrw3[nX][4]+_aBrw3[nX][5]+_aBrw3[nX][6],"E1_SDDECRE");																				 //[27] Saldo Decrescimo
				} )
		EndIf
	Next nX

	If nCount > 0
		cFilAtu := cFilAnt
		u_SF0205X(cEmpAnt, cFilTit)
		u_DTFINR02(aDadosX)
		u_SF0205X(cEmpAnt, cFilAtu)
	Else
		MsgAlert("Não há titulos selecionados para a geração do relatório!", "[Fonte: SF06A48X]")
	EndIf

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍ»±±
±±³Fun‡„o    ³ A008XKey  ³ Autor ³Leonardo P de Castro  ³ Data ³ 14/11/09 ³±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Habilita atakhos do teclado                                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ P10                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function A008XKey( _lHab )

	//Define atalhos do teclado
	If _lHab
		//SetKey(19,{||fSelec(.F.)}) 	      //CTRL+S
		//SetKey(16,{||fSelec(.T.)}) 	      //CTRL+P
		//SetKey(18,{||Alert("CTRL+R")})        //CTRL+R
		SetKey(12,{||fCliente(1)}) 	          //CTRL+L
		SetKey(18,{||fCliente(2)})            //CTRL+R
		SetKey(07,{||_lRet := fGraIni(@_lFecha), _oDlg2:End()}) //CTRL+G
		SetKey(05,{||fAviso()}) //CTRL+E
		SetKey(06,{||fSair(@_lFecha,@_lRet)}) //CTRL+F
		SetKey(13,{||fMarcAll(.T.)})          //CTRL+M
		SetKey(21,{||fMarcAll(.F.)})          //CTRL+U
	Else
		//	SetKey(19,Nil) //CTRL+S
		//	SetKey(16,Nil) //CTRL+P
		//	SetKey(18,Nil) //CTRL+R
		SetKey(12,Nil) //CTRL+L
		SetKey(18,Nil) //CTRL+R
		SetKey(08,Nil) //CTRL+G
		SetKey(05,Nil) //CTRL+E
		SetKey(06,Nil) //CTRL+F
		SetKey(13,Nil) //CTRL+M
		SetKey(21,Nil) //CTRL+U
	EndIF

Return()

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fBrw1()   ºAutor  ³Leonardo P de Castroº Data ³  12/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para carregar o array do _oBrw1                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fBrw1()

	Local _cSql := ""

	_cSql := ""
	_cSql += " SELECT "
	_cSql += " 		ZAK_COD,ZAK_DATA, ZAK_HORA,ZAF_NREDUZ,ZAH_DESCRI,ZAK_DTPATE,ZAK_HRPATE "
	_cSql += " FROM "
	_cSql +=  		RetSqlName("ZAK") + " ZAK "
	//_cSql += " INNER JOIN " + RetSqlName("ZAF") + " ZAF ON (ZAK.ZAK_FILIAL+ZAK.ZAK_CODOPE = ZAF.ZAF_FILIAL+ZAF.ZAF_COD) "
	//_cSql += " INNER JOIN " + RetSqlName("ZAH") + " ZAH ON (ZAK.ZAK_FILIAL+ZAK.ZAK_CODMOT  = ZAH.ZAH_FILIAL+ZAH.ZAH_COD) "
	_cSql += " INNER JOIN " + RetSqlName("ZAF") + " ZAF "
	_cSql += " ON ZAK.ZAK_FILIAL = ZAF.ZAF_FILIAL AND ZAK_CODOPE = ZAF.ZAF_COD "

	_cSql += " INNER JOIN " + RetSqlName("ZAH") + " ZAH "
	_cSql += " ON ZAK.ZAK_FILIAL = ZAH.ZAH_FILIAL AND ZAK.ZAK_CODMOT = ZAH.ZAH_COD "

	_cSql += " WHERE "
	_cSql += "		ZAK.ZAK_CLIENT = '" + ZAJ->ZAJ_CLIENT + "' AND ZAK.ZAK_LOJA = '" + ZAJ->ZAJ_LOJA + "' AND"
	_cSql += " 		ZAK.D_E_L_E_T_ != '*' AND "
	_cSql += " 		ZAF.D_E_L_E_T_ != '*' AND "
	_cSql += " 		ZAH.D_E_L_E_T_ != '*' "
	_cSql += " ORDER BY "
	_cSql += " 		ZAK_DATA, ZAK_HORA "
	_cSql := ChangeQuery(_cSql)

	If Select("tATE") > 0
		DbSelectArea("tATE")
		tATE->(DbCloseArea())
	EndIF

	TcQuery _cSql New Alias tATE

	If tATE->(!Eof())

		While tATE->(!Eof())
			Aadd(_aBrw1,{	tATE->ZAK_COD    ,;
				tATE->ZAK_DATA   ,;
				tATE->ZAK_HORA   ,;
				tATE->ZAF_NREDUZ ,;
				tATE->ZAH_DESCRI ,;
				tATE->ZAK_DTPATE,;
				tATE->ZAK_HRPATE})
			tATE->(DbSkip())
		EndDo
	Else
		Aadd(_aBrw1,{"","","","","","",""})
	EndIF

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fBrw2()   ºAutor  ³Leonardo P de Castroº Data ³  12/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para carregar o array do _oBrw2                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fBrw2()

	Local _cSql := ""

	_cSql := ""
	_cSql += " SELECT "
	_cSql += " 		ZAL_STATUS, ZAK_DATA, ZAK_HORA, ZAL_COD, ZAF_NREDUZ, ZAL_VALIDA, ZAL_COND, "
	_cSql += "		ZAL_PRCJUR, ZAL_VLRJUR, ZAL_PRCMUL, ZAL_VLRMUL, ZAL_VLRFIN, ZAL_VLRDEV, "
	_cSql += "		ZAL_VLRNEG, ZAL_FILNEG "
	_cSql += " FROM "
	_cSql +=   		RetSqlName("ZAL") + " ZAL "
	//_cSql += " INNER JOIN " + RetSqlName("ZAK") + " ZAK ON (ZAL.ZAL_FILIAL+ZAL.ZAL_CODATE = ZAK.ZAK_FILIAL+ZAK.ZAK_COD) "
	//_cSql += " INNER JOIN " + RetSqlName("ZAF") + " ZAF ON (ZAL.ZAL_FILIAL+ZAL.ZAL_CODOPE = ZAF.ZAF_FILIAL+ZAF.ZAF_COD) "
	_cSql += " INNER JOIN " + RetSqlName("ZAK") + " ZAK ON (ZAL.ZAL_FILIAL = ZAK.ZAK_FILIAL AND ZAL.ZAL_CODATE = ZAK.ZAK_COD) "
	_cSql += " INNER JOIN " + RetSqlName("ZAF") + " ZAF ON (ZAL.ZAL_FILIAL = ZAF.ZAF_FILIAL AND ZAL.ZAL_CODOPE = ZAF.ZAF_COD) "

	_cSql += " WHERE "
	_cSql += "		ZAK.ZAK_CLIENT||ZAK.ZAK_LOJA = '" + ZAJ->ZAJ_CLIENTE + ZAJ->ZAJ_LOJA + "' AND "
	_cSql += " 		ZAL.D_E_L_E_T_ != '*' AND "
	_cSql += " 		ZAF.D_E_L_E_T_ != '*' "
	_cSql += " ORDER BY "
	_cSql += " 		ZAL_COD "
	_cSql := ChangeQuery(_cSql)

	If Select("tREN") > 0
		DbSelectArea("tREN")
		tREN->(DbCloseArea())
	EndIF

	TcQuery _cSql New Alias tREN

	If tREN->(!Eof())

		While tREN->(!Eof())
			Aadd(_aBrw2,{	tREN->ZAL_STATUS,;
				tREN->ZAL_COD,;
				tREN->ZAK_DATA  ,;
				tREN->ZAK_HORA  ,; //tREN->ZAL_COD   ,;
				tREN->ZAF_NREDUZ,;
				tREN->ZAL_VALIDA,;
				tREN->ZAL_COND  ,;
				tREN->ZAL_PRCJUR,;
				tREN->ZAL_VLRJUR,;
				tREN->ZAL_PRCMUL,;
				tREN->ZAL_VLRMUL,;
				tREN->ZAL_VLRFIN,;
				tREN->ZAL_VLRDEV,;
				tREN->ZAL_VLRNEG,;
				tREN->ZAL_FILNEG})
			tREN->(DbSkip())
		EndDo
	Else
		Aadd(_aBrw2,{"","","","","","","",0,0,0,0,0,0,0,""})
	EndIF

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fBrw3()   ºAutor  ³Leonardo P de Castroº Data ³  12/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para carregar o array do _oBrw3                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fBrw3()

	Local _cSql := ""
	Local _nJuros := 0
	Local _nMulta := 0
	Local _nVlrJur  := 0
	Local _nVlrCor  := 0
	Local _nDif     := _dGet34 - date()
	Local _cFilOper	:= ""

	dbSelectArea("ZAF")
	ZAF->(dbSetOrder(1))
	ZAF->(dbSeek(xFilial("ZAF") + _AOPER[1]))
	_cFilOper := ZAF->ZAF_UNIDAD
	
	//	"ROUND((SYSDATE + " + Str(_nDif) + ") - to_date(E1_VENCTO,'yyyymmdd'),-1)"
	_cSql := "" + CRLF
	_cSql += " SELECT " + CRLF
	_cSql += "		E1_FILIAL,E1_PREFIXO, E1_NUM, E1_PARCELA, E1_TIPO, E1_NATUREZ, " + CRLF
	_cSql += "		E1_EMISSAO, E1_VENCTO, ZEF_RECORR, " + CRLF
	_cSql += "		ROUND((SYSDATE + " + Str(_nDif) + ") - to_date(E1_VENCTO,'yyyymmdd')) AS E1_ATRASO, " + CRLF

	If GetNewPar("MV_XDSCFAS", .F.)
		_cSql += "		E1_SALDO, E1_VALOR, ZAE_PRCJUR, ZAE_PRCMUL " + CRLF
	Else
		_cSql += "		E1_SALDO, E1_VALOR, ZAQ_DSCJUR AS ZAE_PRCJUR, ZAQ_DSCMUL as ZAE_PRCMUL " + CRLF
	EndIf

	_cSql += " FROM " + CRLF
	_cSql += 		RetSqlName("SE1") + " SE1 " + CRLF

	If GetNewPar("MV_XDSCFAS", .F.)
		_cSql += "LEFT JOIN " + RetSqlName("ZAE") + " ZAE "  + CRLF
		_cSql += "	ON ZAE_FILIAL = '" + xFilial("ZAE") + "' " + CRLF
		_cSql += "	AND ROUND((SYSDATE + " + Str(_nDif) + ") - to_date(E1_VENCTO,'yyyymmdd')) >= ZAE_PRZDE " + CRLF
		_cSql += "	AND ROUND((SYSDATE + " + Str(_nDif) + ") - to_date(E1_VENCTO,'yyyymmdd')) <= ZAE_PRZATE " + CRLF
		_cSql += "	AND ZAE.D_E_L_E_T_ <> '*' " + CRLF
	Else
		_cSql += "LEFT JOIN " + RetSqlName("ZAQ") + " ZAQ "  + CRLF
		_cSql += "	ON ZAQ_FILIAL = '" + xFilial("ZAQ") + "' " + CRLF
		_cSql += "	AND ZAQ_ATIVO = '1' " + CRLF
		_cSql += "	AND E1_VENCTO BETWEEN ZAQ_DATADE AND ZAQ_DATAAT " + CRLF
		_cSql += "	AND ZAQ.D_E_L_E_T_ <> '*' " + CRLF
	EndIf

	_cSql += "LEFT JOIN " + RetSqlName("ZEF") + " ZEF "
	_cSql += "  ON E1_FILIAL =  ZEF_FILIAL " + CRLF
	_cSql += "	AND E1_NUM = ZEF_NUM " + CRLF
	_cSql += "	AND E1_CLIENTE = ZEF_CLIENT " + CRLF
	_cSql += "	AND E1_LOJA = ZEF_LOJA " + CRLF
	_cSql += "	AND E1_PREFIXO = ZEF_PREFIX " + CRLF
	_cSql += "	AND E1_PARCELA = ZEF_PARCEL " + CRLF
	_cSql += "	AND E1_TIPO = ZEF_TIPO " + CRLF
	_cSql += "	AND ZEF.D_E_L_E_T_ <> '*' " + CRLF
	_cSql += " WHERE " + CRLF

	If !Empty(_cFilOper)
		_cSql += "		E1_FILIAL  = '" + _cFilOper + "' AND "  + CRLF //Trata Filial do Operador - Data 12/01/22 - Daniel Castro
	else
		_cSql += "		E1_FILIAL  BETWEEN '" + _aParams[9] + "' AND '" + _aParams[10] + "' AND "  + CRLF
	EndIf

	_cSql += "		E1_FILIAL  BETWEEN '" + _aParams[9] + "' AND '" + _aParams[10] + "' AND "  + CRLF
	_cSql += "		E1_CLIENTE||E1_LOJA = '" + ZAJ->ZAJ_CLIENTE+ZAJ->ZAJ_LOJA + "'  AND " + CRLF
	_cSql += "		E1_TIPO    IN (" + _aParams[8] + ")	AND " + CRLF
	_cSql += "		E1_SALDO   >  0             AND " + CRLF
	_cSql += "		E1_XCOBJ  !=  'S'           AND " + CRLF
	_cSql += "		SE1.D_E_L_E_T_ <> '*' "  + CRLF
	_cSql += " ORDER BY " + CRLF
	_cSql += " 		E1_ATRASO DESC" + CRLF
	_cSql := ChangeQuery(_cSql)

	If Select("tTIT") > 0
		DbSelectArea("tTIT")
		tTIT->(DbCloseArea())
	EndIF

	TcQuery _cSql New Alias tTIT

	// Só muda para .T. se achar algum título vencido
	_lContinua := .F.

	If tTIT->(!Eof())

		//Zero Variaveis
		_aBrw3 := {}
		_nGet14 := _nGet15 := _nGet16 := _nGet17 := 0

		While tTIT->(!Eof())

			If tTIT->ZEF_RECORR == "S"
				tTIT->(dbSkip())
				Loop
			EndIf

			If Time() > "12:00"
				_nDiaAtra := tTIT->E1_ATRASO-1
			Else
				_nDiaAtra := tTIT->E1_ATRASO
			EndIf
			//Zera variaveis
			_nJuros := _nMulta := _nVlrJur := _nVlrCor := 0
			//Calculo de juros e multa
			If _nDiaAtra > 0 //GetNewPar('MV_CAREREC',3)

				if _nDiaAtra > GetNewPar('MV_CAREJUR',3) // calcula juros
					_nJuros := GetNewPar('MV_LJBOJUR',9.9)
					_nJuros := Round((_nJuros/30),4)
					//_nJuros := Round((tTIT->E1_SALDO * ((1+(_nJuros/100)) ^ _nDiaAtra)),2)- tTIT->E1_SALDO
					_nJuros := Round(tTIT->E1_SALDO * (_nJuros/100) * _nDiaAtra,2)
				Else
					_nJuros := 0
				Endif

				If tTIT->E1_SALDO == tTIT->E1_VALOR
					If _nDiaAtra > GetNewPar('MV_CAREMUL',3) // calcula Multa
						_nMulta := Round((tTIT->E1_SALDO * (GetNewPar('MV_LJBOMUL',2.0)/100)),2)
					Else
						_nMulta := 0
					EndIf
				EndIf

				_nVlrJur	:= _nJuros //Round((tTIT->E1_SALDO * ((1+(_nJuros/100)) ^ _nDiaAtra)),2)- tTIT->E1_SALDO

				_nVlrCor	:= tTIT->E1_SALDO + _nMulta + _nVlrJur
			Else
				_nVlrCor	:= tTIT->E1_SALDO
			EndIf

			//Se pelo menos em dos títulos do cliente estiver vencido, abre a tela de atendimento da cobrança
			If _nDiaAtra > 0
				_lContinua := .T.
			EndIf

			Aadd(_aBrw3,{	.F.,;
				tTIT->E1_FILIAL,;
				tTIT->E1_PREFIXO,;
				tTIT->E1_NUM    ,;
				tTIT->E1_PARCELA,;
				tTIT->E1_TIPO   ,;
				tTIT->E1_EMISSAO,;
				tTIT->E1_VENCTO,;
				_nDiaAtra ,;
				tTIT->E1_SALDO  ,;
				tTIT->E1_SALDO  ,;
				_nVlrJur		,;
				_nMulta			,;
				_nVlrJur * (tTIT->ZAE_PRCJUR/100)	,;
				_nMulta * (tTIT->ZAE_PRCMUL/100)	,;
				_nVlrCor - (_nMulta * (tTIT->ZAE_PRCMUL/100)) - (_nVlrJur * (tTIT->ZAE_PRCJUR/100))})
			_nGet14 += tTIT->E1_SALDO
			_nGet15 += _nVlrJur //- _nVlrJur * (tTIT->ZAE_PRCJUR/100)
			_nGet16 += _nMulta //- _nMulta * (tTIT->ZAE_PRCMUL/100)
			_nGet17 += _nVlrCor //- (_nMulta * (tTIT->ZAE_PRCMUL/100)) - (_nVlrJur * (tTIT->ZAE_PRCJUR/100))
			tTIT->(DbSkip())
		EndDo
	Else
		Aadd(_aBrw3,{.F.,"","","","","","","",0,0,0,0,0,0,0,0})
	EndIF

	//Seta o array da listbox
	_oBrw3:SetArray(_aBrw3)
	//atualiza a grade de dados
	_oBrw3:bLine :={|| {If(_aBrw3[_oBrw3:nAT,01],_oOk,_oNo),;
		_aBrw3[_oBrw3:nAt,02],;
		_aBrw3[_oBrw3:nAt,03],;
		_aBrw3[_oBrw3:nAt,04],;
		_aBrw3[_oBrw3:nAt,05],;
		_aBrw3[_oBrw3:nAt,06],;
		StoD(_aBrw3[_oBrw3:nAt,07]),;
		StoD(_aBrw3[_oBrw3:nAt,08]),;
		_aBrw3[_oBrw3:nAt,09],;
		Transform(_aBrw3[_oBrw3:nAt,10],"@E 999,999,999,999.99"),;
		Transform(_aBrw3[_oBrw3:nAt,11],"@E 999,999,999,999.99"),;
		Transform(_aBrw3[_oBrw3:nAt,12],"@E 999,999,999,999.99"),;
		Transform(_aBrw3[_oBrw3:nAt,13],"@E 999,999,999,999.99"),;
		Transform(_aBrw3[_oBrw3:nAt,14],"@E 999,999,999,999.99"),;
		Transform(_aBrw3[_oBrw3:nAt,15],"@E 999,999,999,999.99"),;
		Transform(_aBrw3[_oBrw3:nAt,16],"@E 999,999,999,999.99")}}

	_oBrw3:Refresh()
	_oDlg2:Refresh()

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fBrw4()   ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para carregar o array do _oBrw5                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fBrw4()

	Local _cSql   := ""
	Local _aCond  := {}
	Local _cDesc  := ""
	Local _lDescCap := .F.
	Local _nz

	If _nGet29 = _nGet33
		Return()
	EndIF

	For _nz := 1 to Len(_aBrw3)
		If _aBrw3[_nz,01] .AND. _aBrw3[_nz,11] <> _aBrw3[_nz,10] // Se estiver marcado e se o saldo for diferente do valor com desconto capital
			_lDescCap := .T.
			EXIT
		Endif
	Next

	_cSql := ""
	_cSql += " SELECT "
	_cSql += " 		E4_CODIGO, E4_COND, E4_DESCRI "
	_cSql += " FROM "
	_cSql +=  		RetSqlName("SE4")
	_cSql += " WHERE "
	_cSql += " 		D_E_L_E_T_ <> '*' AND "
	If _lDescCap
		_cSql += " 		E4_XRENATR = 'S' "
	Else
		_cSql += " 		E4_XTELECO = 'S' "
	Endif
	_cSql += " ORDER BY "
	_cSql += "		E4_COND "
	_cSql := ChangeQuery(_cSql)

	If Select("tCON") > 0
		DbSelectArea("tCON")
		tCON->(DbCloseArea())
	EndIF

	TcQuery _cSql New Alias tCON

	//Preparo as variaveis
	_aBrw4  := {}
	_nGet30 := 0
	_dGet31 := CtoD("")
	_dGet32 := CtoD("")
	_nGet33 :=  _nGet29
	_aBrw5  := {}
	aAdd(_aBrw5,{"","",""})

	If tCON->(!Eof())
		While tCON->(!Eof())

			_cDesc := ""
			_aCond := Condicao(_nGet29,tCON->E4_CODIGO)

			If Len(_aCond) = 1
				_cDesc := "1 Parcela  de R$" + Transform(_aCond[1,2],"@E 9,999.99")
			ElseIf Len(_aCond) > 1
				_cDesc := AllTrim(Str(Len(_aCond))) + " Parcelas de R$" + Transform(_aCond[1,2],"@E 9,999.99")
			EndIF

			Aadd(_aBrw4,{	.F.,;
				tCON->E4_CODIGO,;
				tCON->E4_DESCRI,;
				_cDesc})
			tCON->(DbSkip())
		EndDo
	Else
		Aadd(_aBrw4,{.F.,"","",""})
	EndIF

	_oBrw4:SetArray(_aBrw4)

	_oBrw4:bLine :={|| {If(_aBrw4[_oBrw4:nAT,01],_oOk,_oNo),;
		_aBrw4[_oBrw4:nAt,02],;
		_aBrw4[_oBrw4:nAt,03],;
		_aBrw4[_oBrw4:nAt,04]}}

	_oBrw5:SetArray(_aBrw5)

	_oBrw5:bLine :={|| {_aBrw5[_oBrw5:nAt,01],;
		_aBrw5[_oBrw5:nAt,02],;
		Transform(_aBrw5[_oBrw5:nAt,03],"@E 99,999,999.99")}}

	_oGet30:Refresh()
	_oGet31:Refresh()
	_oGet32:Refresh()
	_oGet33:Refresh()
	//Desabilito os campos de manipulacao...
	_oGet30:Disable()
	_oGet31:Disable()
	_oGet32:Disable()
	_oBrw4:Refresh()
	_oBrw5:Refresh()
	_oDlg2:Refresh()

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fBrw5()   ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para carregar o array do _oBrw5                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fBrw5()

	Local _cCond := ""
	Local _aCond := {}
	Local _nX

	//Verifico a condicao escolhida
	For _nX := 1 To Len(_aBrw4)
		If _aBrw4[_nX,01]
			_cCond := AllTrim(_aBrw4[_nX,02])
		EndIf
	Next _nX

	//Zero as parcelas
	_aBrw5 := {}

	If !Empty(_cCond)

		//Obtenho a forma de pagamento
		_aCond := Condicao(_nGet33,_cCond,0,_dGet34)
		_dGet31 := _dGet34

		//Carrego os titulos gerados
		For _nX := 1 To Len(_aCond)
			aAdd(_aBrw5,{	StrZero(_nX,2),;
				_aCond[_nX,1],;
				_aCond[_nX,2]})
		Next _nX
	Else
		aAdd(_aBrw5,{"","",""})
	EndIF

	_oBrw5:SetArray(_aBrw5)

	_oBrw5:bLine :={|| {	_aBrw5[_oBrw5:nAt,01],;
		_aBrw5[_oBrw5:nAt,02],;
		Transform(_aBrw5[_oBrw5:nAt,03],"@E 99,999,999.99")}}

	_oGet31:Refresh()
	_oBrw5:Refresh()
	_oDlg2:Refresh()

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fCor()    ºAutor  ³Leonardo P de Castroº Data ³  15/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Define a cor da legenda para a grade de negociacoes..       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fCor(_cStatus)

	Local _oRet := _oVerde

	If _cStatus = "F"
		_oRet := _oAzul
	ElseIf _cStatus = "C"
		_oRet := _oVermelho
	EndIF

Return( _oRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fMarca()  ºAutor  ³Leonardo P de Castroº Data ³  15/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Funcao para marcar e desmarcar uma unica linha do _oBrw3    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fMarca( _nLin )

	Local cFilRen := ""
	Local _nz

	//E1_FILIAL, E1_CLIENTE, E1_LOJA, E1_PREFIXO, E1_NUM, E1_PARCELA, E1_TIPO
	If Posicione("SE1", 2, _aBrw3[_nLin,02] + ZAJ->ZAJ_CLIENT + ZAJ->ZAJ_LOJA + _aBrw3[_nLin,03] + _aBrw3[_nLin,04] + _aBrw3[_nLin,05] + _aBrw3[_nLin,06], "E1_XSPC") == "S"
		MsgAlert("Não é permitido renegociar titulos em cobrança em SPC Serasa. Por Favor, verifique.", "Atenção!")
		//Return
	EndIf

	For _nz := 1 to Len(_aBrw3)
		If _aBrw3[_nz,1]
			cFilRen := _aBrw3[_nz,2]
		EndIf
	Next

	If cFilRen == _aBrw3[_nLin,02] .or. Empty(cFilRen)

		_aBrw3[_nLin,01] := !(_aBrw3[_nLin,01])
		_nValJur := 0
		_nValMul := 0
		_nGet14 := 0
		_nGet15 := 0
		_nGet16 := 0
		_nGet17 := 0

		For _nz := 1 to Len(_aBrw3)
			If _aBrw3[_nz,1]
				_nValJur += _aBrw3[_nz,12]
				_nValMul += _aBrw3[_nz,13]
			EndIf
			_nGet14 += _aBrw3[_nz,11]
			_nGet15 += _aBrw3[_nz,12]
			_nGet16 += _aBrw3[_nz,13]
			_nGet17 += _aBrw3[_nz,11] + _aBrw3[_nz,12] + _aBrw3[_nz,13]
		Next

		If (_aBrw3[_nLin,01])
			_nGet18 += _aBrw3[_nLin,11]
			_nGet19 += _aBrw3[_nLin,12]
			_nGet20 += _aBrw3[_nLin,13]
			_nGet21 += _aBrw3[_nLin,10] + _aBrw3[_nLin,12] + _aBrw3[_nLin,13]
			_nGet26 := _nGet18

			_nGet23 += _aBrw3[_nLin,14]
			_nGet22 := _nGet23 / _nValJur *100
			_nGet25 += _aBrw3[_nLin,15]
			_nGet24 := _nGet25 / _nValMul *100

			_nGet27 := _nGet19 - _nGet23
			_nGet28 := _nGet20 - _nGet25
			_nGet29 := _nGet26 + _nGet27 + _nGet28
		Else
			_nGet18 -= _aBrw3[_nLin,11]
			_nGet19 -= _aBrw3[_nLin,12]
			_nGet20 -= _aBrw3[_nLin,13]
			_nGet21 -= _aBrw3[_nLin,10] + _aBrw3[_nLin,12] + _aBrw3[_nLin,13]
			_nGet26 := _nGet18

			_nGet23 -= _aBrw3[_nLin,14]
			_nGet22 := _nGet23 / _nValJur *100
			_nGet25 -= _aBrw3[_nLin,15]
			_nGet24 := _nGet25 / _nValMul *100

			_nGet27 := _nGet19 - _nGet23
			_nGet28 := _nGet20 - _nGet25
			_nGet29 := _nGet26 + _nGet27 + _nGet28

			/*_nGet26 := _nGet18
			_nGet27 := _nGet19
			_nGet28 := _nGet20
			_nGet29 := _nGet26 + _nGet27 + _nGet28

			_nGet23 -= _aBrw3[_nLin,14]
			_nGet22 := _nGet23 / _nValJur *100
			_nGet25 -= _aBrw3[_nLin,15]
			_nGet24 := _nGet25 / _nValMul *100*/
		EndIf
		_cGet12 := _aOper[4]
		_lCBox3 := .F.
		//_nGet22 := _nGet23 := _nGet24 := _nGet25 := 0
	Else
		MsgAlert("Não é permitido selecionar titulos de filiais diferentes!", "Atenção!")
	EndIf

	_oGet12:Refresh()
	_oCBox3:Refresh()
	_oGet18:Refresh()
	_oGet19:Refresh()
	_oGet20:Refresh()
	_oGet21:Refresh()
	_oGet22:Refresh()
	_oGet23:Refresh()
	_oGet24:Refresh()
	_oGet25:Refresh()
	_oGet26:Refresh()
	_oGet27:Refresh()
	_oGet28:Refresh()
	_oGet29:Refresh()
	_oBrw3:Refresh()
	_oDlg2:Refresh()

Return(Nil)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fMarcAll()ºAutor  ³Leonardo P de Castroº Data ³  15/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Funcao para marcar e desmarcar todas as linhas do _oBrw3    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fMarcAll(_lMarca)

	Local _nX := 0
	Local nY := 0
	Local nZ := 0
	Local cFilRen := _aBrw3[01,02]

	_nValJur := 0
	_nValMul := 0
	_nGet23 := 0
	_nGet25 := 0

	_nGet17 := _nGet14 + _nGet15 + _nGet16

	For nZ := 1 to Len(_aBrw3)
		If cFilRen <> _aBrw3[nZ,02]
			MsgAlert("Quando existe titulos de diferentes filiais não é permitido selecionar todos!")
			Return
		EndIf
		If Posicione("SE1", 2, _aBrw3[nZ,02] + ZAJ->ZAJ_CLIENT + ZAJ->ZAJ_LOJA + _aBrw3[nZ,03] + _aBrw3[nZ,04] + _aBrw3[nZ,05] + _aBrw3[nZ,06], "E1_XSPC") == "S"
			MsgAlert("Existem titulos em SPC/SERASA, verifique.", "Atenção!")
			EXIT
		EndIf
	Next

	For nY := 1 to Len(_aBrw3)
		_nValJur += _aBrw3[nY,12]
		_nValMul += _aBrw3[nY,13]
		_nGet23 += _aBrw3[nY,14]
		_nGet25 += _aBrw3[nY,15]
	Next

	If _lMarca
		_nGet22 := _nGet23 / _nValJur *100
		_nGet24 := _nGet25 / _nValMul *100
	Else
		_nGet22 := 0
		_nGet24 := 0
		_nGet23	:= 0
		_nGet25	:= 0
	EndIf

	//Zera variaveis de selecao
	If _lMarca
		_nGet18 := _nGet14
		_nGet19 := _nGet15
		_nGet20 := _nGet16
		_nGet21 := _nGet17
		_nGet26 := _nGet18
		_nGet27 := _nGet19 - _nGet23
		_nGet28 := _nGet20 - _nGet25
		_nGet29 := _nGet26 + _nGet27 + _nGet28
	Else
		_nGet18 := _nGet19 := _nGet20 := _nGet21 := 0
		_nGet26 := _nGet27 := _nGet28 := _nGet29 := 0
	EndIF

	_cGet12 := _aOper[4]
	_lCBox3 := .F.

	For _nX := 1 To Len(_aBrw3)
		_aBrw3[_nX,01] := _lMarca
	Next _nX

	_oGet12:Refresh()
	_oCBox3:Refresh()
	_oGet18:Refresh()
	_oGet19:Refresh()
	_oGet20:Refresh()
	_oGet21:Refresh()
	_oGet22:Refresh()
	_oGet23:Refresh()
	_oGet24:Refresh()
	_oGet25:Refresh()
	_oGet26:Refresh()
	_oGet27:Refresh()
	_oGet28:Refresh()
	_oGet29:Refresh()
	_oBrw3:Refresh()
	_oDlg2:Refresh()

Return()

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fMarc4()  ºAutor  ³Leonardo P de Castroº Data ³  15/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Funcao para marcar e desmarcar uma unica linha do _oBrw4    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fMarc4( _nLin )
Local _nX

	_aBrw4[_nLin,01] := !(_aBrw4[_nLin,01])

	If (_aBrw4[_nLin,01])

		For _nX := 1 To Len(_aBrw4)
			If _nX != _nLin
				_aBrw4[_nX,01] := .F.
			EndIF
		Next _nX

		//Habilito campos de manipulacao
		_nGet30 := 0
		_dGet31 := CtoD("")
		_dGet32 := CtoD("")
		_oGet30:Enable()
		_oGet31:Enable()
		_oGet32:Enable()
	Else

		For _nX := 1 To Len(_aBrw4)
			_aBrw4[_nX,01] := .F.
		Next _nX

		//Desabilito campos de manipulacao
		_nGet30 := 0
		_dGet31 := CtoD("")
		_dGet32 := CtoD("")
		_oGet30:Disable()
		_oGet31:Disable()
		_oGet32:Disable()
	EndIf

	//Gero as novas parcelas
	fBrw5()

	_oBrw4:Refresh()
	_oDlg2:Refresh()

Return(Nil)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fVldFld() ºAutor  ³Leonardo P de Castroº Data ³  15/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Valida a troca de aba no objeto Folder (_oFld1)            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fVldFld()

	Local _lRet := .T.

	If _oFld1:nOption = 1
		If _nGet29 = 0
			Alert("Nenhum título foi selecionado para negociação.")
			_lRet := .F.
		Else
			fBrw4()
		EndIf
	EndIf

Return(_lRet)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fInfSenha(ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Valida a senha informada pelo superior.                    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fInfSenha( _nPrc, _cTip )

	Local _oDlg3
	Local _oGrp
	Local _oGet1
	Local _oBtn1
	Local _lRet  := .F.
	Local _cGet1 := Space(10)
	Local _nOpc  := 0
	Local _aUser := {}
	Local _aRet := {}
	Local _cSql := ""
	Local _cALias := GetNextAlias()
	Local _aUsers := {}
	/*
_oDlg3 := MSDialog():New( 128,490,225,720,"Autorização Superior",,,.F.,,,,,,.T.,,,.T. )
_oGrp  := TGroup():New( 002,002,028,114," Informe sua senha ",_oDlg3,CLR_BLACK,CLR_WHITE,.T.,.F. )
_oGet1 := TGet():New( 012,027,{|u| If(PCount()>0,_cGet1:=u,_cGet1)},_oGrp,060,009,'',,CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,.T.,"","_cGet1",,)
_oBtn1 := TButton():New( 035,039,"Ok",_oDlg3,,037,012,,,,.T.,,"",,,,.F. )
_oBtn1:bAction := {|| _nOpc := 1, _oDlg3:End()}

_oDlg3:Activate(,,,.T.)
	*/
	_cSql += " SELECT ZAF_CODUSU FROM "+RetSQLName("ZAF")+" ZAF WHERE ZAF_NIVEL = 'S' AND D_E_L_E_T_ <> '*' AND ZAF_CODUSU <> '"+__cUserId+"' AND ZAF_ATIVO='S' "+CRLF
	If Select(_cALias) > 0
		(_cALias)->(dbClosearea())
	Endif
	DbUseArea(.T., "TOPCONN", TCGenQry(,,ChangeQuery(_cSql)), _cALias, .F., .F.)
	While !(_cAlias)->(Eof())
		Aadd(_aUsers, (_cAlias)->ZAF_CODUSU)
		(_cAlias)->(dbSkip())
	Enddo
	(_cAlias)->( dbCloseArea() )
	If !Empty(_aUsers)
		_aRet := U_TUsuarios(_aUsers) // tela para o usuario definir o usuario que ira aprovar
		If _aRet[1] // se a primeira posicao for TRUE a pessoa clicou no ok
			dbSelectarea("SA1")
			_aRet := U_MMLJ099E({_aRet[2],"Informe a senha! "+CRLF+UsrRetName(_aRet[2])}) // tela pro usuario colocar a senha do usuario aprovador
			SA1->(dbClosearea())
			If !_aRet[1] // senha incorreta.
				//Alert("Senha digitada incorreta!")
				_nOpc := 2
			Else
				_nOpc := 1
			Endif
		Else
			_nOpc := 2
		Endif
	Else
		Alert("Não tem usuarios superiores.")
		_nOpc := 2
	Endif

	If _nOpc = 1
		//PswOrder(3) //Pesquisa por senha
		//If PswSeek(AllTrim(_cGet1)) //Localizo o usuario
		_aUser := _aRet

		DbSelectArea("ZAF")
		ZAF->(DbSetOrder(4))

		If ZAF->(DbSeek(xFilial("ZAF") + _aUser[2]))
			If ZAF->ZAF_NIVEL = "S"
				If ZAF->ZAF_ATIVO = "N"
					Alert("A senha informada se refere a um superior não ativo. (Usuario informado: " + _aUser[3] + ")")
					_lRet := .F.
				Else
					If _cTip = 'J'
						If _nPrc <= ZAF->ZAF_PRCJUR
							_cGet12 := ZAF->ZAF_NREDUZ
							_lCBox3 := .T.
							_lRet := .T.
						Else
							Alert("Superior sem permissão para liberar o desconto informado. (Usuario informado: " + _aUser[3] + ")")
							_lRet := .F.
						EndIF
					ElseIF _cTip = 'M'
						If _nPrc <= ZAF->ZAF_PRCMUL
							_cGet12 := ZAF->ZAF_NREDUZ
							_lCBox3 := .T.
							_lRet := .T.
						Else
							Alert("Superior sem permissão para liberar o desconto informado. (Usuario informado: " + _aUser[3] + ")")
							_lRet := .F.
						EndIF
					Else
						Alert("Não foi possível a verificação do superior. (Usuario informado: " + _aUser[3] + ")")
						_lRet := .F.
					EndIF
				EndIF
			Else
				Alert("A senha informada não se refere a um usuario superior. (Usuario informado: " + _aUser[3] + ")")
				_lRet := .F.
			EndIF
		Else
			Alert("Nenhum operador foi encontrado com a senha informa. (Usuario informado: " + _aUser[3] + ")")
			_lRet := .F.
		EndIF

		//EndIf
	Else
		Alert("A senha informada não se refere a um usuario superior.")
		_lRet := .F.
	EndIF

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fPrcJur   ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valida o percentual de desconto nos juros.                  º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fPrcJur()

	Local _lRet := .T.
	Local _cFase := Subs(_aCBox[_oCBox:nAt],1,3) //Variavel privada da SF06A43X
	Local _nValor := 0
	Local _nPerc  := 0

	If _nGet22 > 100
		_cMsgHelp := "Valor não pode ser maior que 100%"
		Help("ESPECIFICO",1,"HELP",ProcName(),_cMsgHelp,1,0)
		_lRet := .F.
		Return _lRet
	EndIf

	//Posiciono na fase atual
	DbSelectArea("ZAE")
	ZAE->(DbSetOrder(1))
	ZAE->(DbSeek(xFilial("ZAE") + _cFase))

	_nPerc := (_nGet19 * _nGet22) / 100

	If _nPerc = _nGet23
		Return( .T. )
	EndIF

	//Obtenho o maior percentual
	If ZAE->ZAE_PRCJUR >= _aOper[7]
		_nValor := ZAE->ZAE_PRCJUR
	Else
		_nValor := _aOper[7]
	EndIF

	//Comparo o permitido com o informado
	If _nValor >= _nGet22
		If !_lCBox3
			_cGet12 := _aOper[4]
			_lCBox3 := .F.
		EndIF
		_lRet := .T.
	Else
		_lRet := fInfSenha( _nGet22, 'J' )
	EndIF

	//Atualizo a tela em caso positivo
	If _lRet
		_nGet23 := (_nGet19 * _nGet22) / 100
		_nGet27 := _nGet19 - _nGet23
		_nGet29 := _nGet26 + _nGet27 + _nGet28
		//Atualizo os GETs
		_oGet23:Refresh()
		_oGet27:Refresh()
		_oGet29:Refresh()
	Else

	EndIf

	//Atualizo a tela em caso positivo
	If _lRet
		_nGet23 := (_nGet19 * _nGet22) / 100
	Else
		_nGet22 := 0
		_nGet23 := 0
	EndIf

	_nGet27 := _nGet19 - _nGet23
	_nGet29 := _nGet26 + _nGet27 + _nGet28
	//Atualizo os GETs
	_oGet22:Refresh()
	_oGet23:Refresh()
	_oGet27:Refresh()
	_oGet29:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fValJur   ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valida o valor de desconto nos juros.                       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fValJur()

	Local _lRet := .T.
	Local _cFase := Subs(_aCBox[_oCBox:nAt],1,3) //Variavel privada da SF06A43X
	Local _nValor := 0
	Local _nPerc  := 0

	//Posiciono na fase atual
	DbSelectArea("ZAE")
	ZAE->(DbSetOrder(1))
	ZAE->(DbSeek(xFilial("ZAE") + _cFase))

	_nPerc := (_nGet23 * 100) / _nGet19

	//Ajusto percentual maximo
	If _nPerc = 100
		_nPerc := 99.99
	EndIF

	If _nPerc = _nGet22
		Return( .T. )
	Else
		_nGet22 := _nPerc
	EndIF

	//Obtenho o maior percentual
	If ZAE->ZAE_PRCJUR >= _aOper[7]
		_nValor := ZAE->ZAE_PRCJUR
	Else
		_nValor := _aOper[7]
	EndIF

	//Comparo o permitido com o informado
	If _nValor >= _nGet22
		If !_lCBox3
			_cGet12 := _aOper[4]
			_lCBox3 := .F.
		EndIF
		_lRet := .T.
	Else
		_lRet := fInfSenha( _nGet22, 'J' )
	EndIF

	//Atualizo a tela em caso positivo
	If !_lRet
		_nGet22 := 0
		_nGet23 := 0
	EndIf

	_nGet27 := _nGet19 - _nGet23
	_nGet29 := _nGet26 + _nGet27 + _nGet28
	//Atualizo os GETs
	_oGet22:Refresh()
	_oGet23:Refresh()
	_oGet27:Refresh()
	_oGet29:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fPrcMul   ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valida o percentual de desconto na multa.                   º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fPrcMul()

	Local _lRet := .T.
	Local _cFase := Subs(_aCBox[_oCBox:nAt],1,3) //Variavel privada da SF06A43X
	Local _nValor := 0
	Local _nPerc  := 0

	If _nGet24 > 100
		_cMsgHelp := "Valor não pode ser maior que 100%"
		Help("ESPECIFICO",1,"HELP",ProcName(),_cMsgHelp,1,0)
		_lRet := .F.
		Return _lRet
	EndIf

	//Posiciono na fase atual
	DbSelectArea("ZAE")
	ZAE->(DbSetOrder(1))
	ZAE->(DbSeek(xFilial("ZAE") + _cFase))

	_nPerc := (_nGet20 * _nGet24) / 100

	If _nPerc = _nGet25
		Return( .T. )
	EndIF

	//Obtenho o maior percentual
	If ZAE->ZAE_PRCJUR >= _aOper[8]
		_nValor := ZAE->ZAE_PRCMUL
	Else
		_nValor := _aOper[8]
	EndIF

	//Comparo o permitido com o informado
	If _nValor >= _nGet24
		If !_lCBox3
			_cGet12 := _aOper[4]
			_lCBox3 := .F.
		EndIF
		_lRet := .T.
	Else
		_lRet := fInfSenha( _nGet24, 'M' )
	EndIF

	//Atualizo a tela em caso positivo
	If _lRet
		_nGet25 := (_nGet20 * _nGet24) / 100
	Else
		_nGet24 := 0
		_nGet25 := 0
	EndIF

	_nGet28 := _nGet20 - _nGet25
	_nGet29 := _nGet26 + _nGet27 + _nGet28
	//Atualizo os GETs
	_oGet24:Refresh()
	_oGet25:Refresh()
	_oGet28:Refresh()
	_oGet29:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fPrcMUL   ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valida o percentual de desconto na multa.                   º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fValMul()

	Local _lRet := .T.
	Local _cFase := Subs(_aCBox[_oCBox:nAt],1,3) //Variavel privada da SF06A43X
	Local _nValor := 0
	Local _nPerc  := 0

	//Posiciono na fase atual
	DbSelectArea("ZAE")
	ZAE->(DbSetOrder(1))
	ZAE->(DbSeek(xFilial("ZAE") + _cFase))

	_nPerc := (_nGet25 * 100) / _nGet20

	If _nPerc = 100
		_nPerc := 99.99
	EndIF

	If _nPerc = _nGet24
		Return( .T. )
	Else
		_nGet24 := _nPerc
	EndIF

	//Obtenho o maior percentual
	If ZAE->ZAE_PRCJUR >= _aOper[8]
		_nValor := ZAE->ZAE_PRCMUL
	Else
		_nValor := _aOper[8]
	EndIF

	//Comparo o permitido com o informado
	If _nValor >= _nGet24
		If !_lCBox3
			_cGet12 := _aOper[4]
			_lCBox3 := .F.
		EndIF
		_lRet := .T.
	Else
		_lRet := fInfSenha( _nGet24, 'M' )
	EndIF

	If !_lRet
		_nGet24 := 0
		_nGet25 := 0
	EndIF

	_nGet28 := _nGet20 - _nGet25
	_nGet29 := _nGet26 + _nGet27 + _nGet28
	//Atualizo os GETs
	_oGet24:Refresh()
	_oGet25:Refresh()
	_oGet28:Refresh()
	_oGet29:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fValEnt() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido valor informado para a entrada.                      º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fValEnt()

	Local _lRet := .T.
	Local _nLin := aScan(_aBrw5, {|xx| AllTrim(xx[1]) == "01" })
	Local _nResto := _nGet33 - _nGet30
	Local _nParc := Len(_aBrw5) - 1
	Local _nValPar := NoRound((_nResto / _nParc),2)
	Local _nX

	If _nLin < 1
		Alert("Primeira parcela não encontrada. Verifique.")
		Return( .F. )
	EndIf

	If _nGet30 > _nGet33
		Alert("Valor de entrada inválido! Por favor, digite um valor de entrada Menor que o valor da venda.")
		Return( .F. )
	EndIF

	If Len(_aBrw5) > 1
		_aBrw5[_nLin,3] := _nGet30

		For _nX := 2 To Len(_aBrw5)
			_aBrw5[_nX,3] := _nValPar
		Next _nX

		//Ajuste de valor para arredondamento...
		_aBrw5[Len(_aBrw5),3] := _nValPar + (_nResto - (_nValPar * _nParc))
	Else
		Alert("Nao será permitido alterar a entrada quando a negociação conter apenas uma parcela.")
		_nGet30 := 0
	EndIF

	_oBrw5:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fDatBas() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido a data base da negociacao                            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fDatBas

	Local _lRet := .T.

	If !NaoVazio(_dGet34)
		Return( .F. )
	EndIf

	If _dGet34 < dDataBase
		Alert("A data base informada é menor que a data base do sistema!")
		Return(.F.)
	EndIF

	_dGet8  := _dGet34
	_dGet13 := _dGet34

	//Atualizo dados...
	fBrw3()
	//Desmarco todos os registros.
	fMarcAll(.F.)

	_oGet8:Refresh()
	_oGet13:Refresh()
	_oGet34:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fDatVal() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido a data de validade da negociacao                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fDatVal

	Local _lRet := .T.

	If !NaoVazio(_dGet13)
		Return( .F. )
	EndIf

	If _dGet13 > dDataBase+_aParams[7]
		Alert("A data de validade da negociacao inválida. Data máxima permitida é " + DtoC(dDataBase+_aParams[7]) + ".")
		Return(.F.)
	EndIF

	_oGet13:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fDatAte() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido a data do proximo atendimento.                       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fDatAte()

	Local _lRet := .T.

	If !NaoVazio(_dGet8)
		Return( .F. )
	EndIf

	If _dGet8 > dDataBase+_aParams[7]
		Alert("A data informada para o Proximo atendimento é inválida. Data máxima permitida é " + DtoC(dDataBase+_aParams[7]) + ".")
		Return(.F.)
	EndIF

	If _dGet8 < dDataBase
		Alert("A data informada para o Proximo atendimento é inválida.")
		Return(.F.)
	EndIF

	_oGet8:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fHorAte() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido a hora do proximo atendimento.                       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fHorAte()

	Local _lRet := .T.

	If _cGet9 = "00:00"
		Return( .T. )
	EndIf

	If !NaoVazio(_cGet9)
		Return( .T. )
	EndIf

	If !U_TcHoraOk(_cGet9, '00:00', '23:59', .T.)
		Return( .F. )
	EndIF

	DbSelectArea("ZAI")
	ZAI->(DbSetOrder(1))
	ZAI->(DbSeek(xFilial("ZAI") + Subs(_aCBox[_oCBox:nAt],1,3) + Subs(_aCBox1[_oCBox1:nAt],1,6)))

	If ZAI->ZAI_HORADE != "00:00" .Or. ZAI->ZAI_HORATE != "00:00"
		If _cGet9 < ZAI->ZAI_HORADE .Or. _cGet9 > ZAI->ZAI_HORATE
			Alert("Não será permido agendar a cobranca para este horario.")
			Return( .F. )
		EndIF
	EndIF

	DbSelectArea("ZAH")
	ZAH->(DbSetOrder(1))
	ZAH->(DbSeek(xFilial("ZAH") + Subs(_aCBox1[_oCBox1:nAt],1,6)))

	If ZAH->ZAH_HORADE != "00:00" .Or. ZAH->ZAH_HORATE != "00:00"
		If _cGet9 < ZAH->ZAH_HORADE .Or. _cGet9 > ZAH->ZAH_HORATE
			Alert("Não será permido agendar a cobranca para este horario.")
			Return( .F. )
		EndIF
	EndIF

	_oGet9:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fDatEnt() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido a data informado para a entrada.                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fDatEnt

	Local _lRet := .T.
	Local _nX

	If Empty(_dGet31)
		Return( .T. )
	EndIf

	If _dGet31 > dDataBase+_aParams[7]
		Alert("A data informada excedeu o limite permitido. Data máxima permitida é " + DtoC(dDataBase+_aParams[7]) + ".")
		Return(.F.)
	EndIF

	If _dGet31 < dDataBase
		Alert("A data informada é menor que a data base.")
		Return(.F.)
	EndIF

	If Len(_aBrw5) >= 1

		_aBrw5[1,2] := _dGet31
		For _nX := 2 To Len(_aBrw5)
			_aBrw5[_nX,2] :=  DataValida( _dGet31 + (30 * (_nX - 1)) )
		Next _nX
	EndIF

	_dGat8  := _dGet31
	_dGet13 := _dGet31

	_oGet31:Refresh()
	_oBrw5:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fDatSeg() ºAutor  ³Leonardo P de Castroº Data ³  16/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valido a data informado para a segunda parcela.             º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fDatSeg

	Local _lRet := .T.
	Local _nX

	If Empty(_dGet32)
		Return( .T. )
	EndIf

	If Empty(_dGet31)
		Alert("Informe a data da primeira parcela.")
		Return( .T. )
	EndIf

	If _dGet32 > _dGet31 + _aParams[11]
		Alert("A data informada excedeu o limite permitido. Data máxima permitida é " + DtoC(_dGet31 + _aParams[11]) + ".")
		Return(.F.)
	EndIF

	If _dGet32 < _dGet31
		Alert("A data informada é menor que a data da primeira parcela.")
		Return(.F.)
	EndIF

	If Len(_aBrw5) > 1

		_aBrw5[2,2] := _dGet32
		For _nX := 3 To Len(_aBrw5)
			_aBrw5[_nX,2] :=  DataValida( _dGet32 + (30 * (_nX - 2)) )
		Next _nX
	EndIF

	_oBrw5:Refresh()
	_oDlg2:Refresh()

Return( _lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fAviso    ºAutor  ³Leonardo P de Castroº Data ³  11/22/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Rotina para criacao da janela de contatos do cliente.       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fAviso()

	Local _aAreSA1 := SA1->(GetArea())
	Local _aAreMA7 := MA7->(GetArea())
	Local _cEol := CHR(13)+CHR(10)
	Local _cMGet1 := ""
	Local _cMGet1
	Local _cSay1  := ZAJ->ZAJ_CLIENTE + "/" + ZAJ->ZAJ_LOJA + " - " + ZAJ->ZAJ_NOME
	Local _oDlg4
	Local _oSay1
	Local _oMGet1
	Local _oBtn1

	If !_lContinua
		_oDlg2:End()
		Return()
	EndIf

	DbSelectArea("SA1")
	SA1->(DbSetOrder(1))
	SA1->(DbSeek(xFilial("SA1") + ZAJ->ZAJ_CLIENTE + ZAJ->ZAJ_LOJA))

	If !Empty(SA1->A1_MUN)
		_cMGet1 += "CIDADE: " + SA1->A1_MUN + _cEol
	EndIF

	If !Empty(SA1->A1_EST)
		_cMGet1 += "ESTADO: " + SA1->A1_EST + _cEol
	EndIF

	If !Empty(SA1->A1_DDD)
		_cMGet1 += Padr("DDD: " + SA1->A1_DDD,23," ") + _cEol
	EndIF

	If !Empty(SA1->A1_TEL)
		_cMGet1 += Padr("TEL: " + SA1->A1_TEL,23," ") + _cEol
	EndIF

	If !Empty(SA1->A1_FAX)
		_cMGet1 += "FAX: " + SA1->A1_FAX + _cEol
	EndIF

	If !Empty(SA1->A1_EMAIL)
		_cMGet1 += "EMAIL: " + SA1->A1_EMAIL + _cEol
	EndIF

	DbSelectArea("MA7")
	MA7->(DbSetOrder(1))
	MA7->(DbSeek(xFilial("SA1") + ZAJ->ZAJ_CLIENTE + ZAJ->ZAJ_LOJA))

	If !Empty(MA7->MA7_CELULA)
		_cMGet1 += "Celula: " + MA7->MA7_CELULA + _cEol
	EndIF

	_oDlg4     := MSDialog():New( 122,322,375,751,"Contatos do Cliente",,,.F.,,,,,,.T.,,,.T. )
	_oSay1     := TSay():New( 006,004,{||_cSay1},_oDlg4,,_oFA08N,.F.,.F.,.F.,.T.,CLR_BLUE,CLR_WHITE,205,011)
	_oMGet1    := TMultiGet():New( 022,002,{|u| If(PCount()>0,_cMGet1:=u,_cMGet1)},_oDlg4,212,084,,,CLR_BLACK,CLR_WHITE,,.T.,"",,,.F.,.F.,.T.,,,.F.,,  )
	_oBtn1     := TButton():New( 111,086,"Ok",_oDlg4,,037,012,,,,.T.,,"",,,,.F. )
	_oBtn1:bAction := {||_oDlg4:End()}

	_oDlg4:Activate(,,,.T.)

	RestArea(_aAreSA1)
	RestArea(_aAreMA7)

Return()

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fSair     ºAutor  ³Leonardo P de Castroº Data ³  11/22/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Rotina para validacao da saida da janela de atendimento     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fSair( _lFecha, _lRet )

	If _aParams[3] = "2"
		Alert("Não será permitido abandonar o atendimento. Por favor realize o atendimento.")
	Else
		_lFecha := .T.
		_lRet := .F.
		_oDlg2:End()
	EndIF

Return()

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fGraIni   ºAutor  ³Leonardo P de Castroº Data ³  11/22/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Rotina para validacao da gravacao dos dados do atendimento  º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fGraIni(_lFecha)

	Local nZ, _nz
	Local _lRet
	Local _lDescCap := .F.

	If Empty(_cMGet1)
		Alert("O campo Observação não foi informado. Por favor, informe este campo.")
		_lFecha := .F.
		Return(.F.)
	EndIF

	For nZ := 1 to Len(_aBrw3)
		If _aBrw3[nZ,01] .and. Posicione("SE1", 2, _aBrw3[nZ,02] + ZAJ->ZAJ_CLIENT + ZAJ->ZAJ_LOJA + _aBrw3[nZ,03] + _aBrw3[nZ,04] + _aBrw3[nZ,05] + _aBrw3[nZ,06], "E1_XSPC") == "S"
			MsgAlert("Quando existe titulos em cobrança SPC/SERASA não é permitido realizar negociação.", "Atenção!")
			_lFecha := .F.
			Return(.F.)
		EndIf
	Next

	For _nz := 1 to Len(_aBrw3)
		If _aBrw3[_nz,01] .AND. _aBrw3[_nz,11] <> _aBrw3[_nz,10] // Se estiver marcado e se o saldo for diferente do valor com desconto capital
			_lDescCap := .T. // CONTROLA que ta marcado um titulo com desconto capital
			EXIT
		Endif
	Next

	// validacoes referente ao desconto sobre o valor capital do titulo.
	If _lDescCap .AND. Type("_aBrw5[1,3]") == "N" // se tem algum titulo com desconto capital.
		// Validacao 1 - Entrada precisa ter o percentual minimo.
		If (_aBrw5[1,3] / _nGet29) * 100 < _aParams[14]
			Alert("Para renegociação com titulo que sofreu desconto no valor capital,"+CRLF;
				+"a entrada minima deve ser pelo menos "+Transform(_aParams[14],"99.99")+"% do total,"+CRLF;
				+"nesse caso no minimo: "+Transform(_nGet29 * (_aParams[14] / 100) ,"@E 999,999,999.99") )
			Return(.F.)
		Endif

		For _nz := 2 to Len(_aBrw5)
			If _aBrw5[_nz,3] < _aParams[15]
				Alert("Para renegociação com titulo que sofreu desconto no valor capital,"+CRLF;
					+"as parcelas devem ser no minimo: "+Transform(_aParams[15],"@E 999,999,999.99"))
				Return(.F.)
			Endif
		Next
	ElseIf _lDescCap .AND. Type("_aBrw5[1,3]") == "C"
		Alert("Favor definir o pagamento!")
		Return(.F.)
	Endif

	If MsgYesNo("Confirma a gravação do atendimento ?")
		If _dGet8 = ZAJ->ZAJ_DATA
			If _cGet9 != "00:00"
				If _cGet9 > Subs(Time(),1,5)
					Processa({|| CursorWait(), _lRet := fGraExe(.T.), CursorArrow() }, "Gravando...","",.T.)
				Else
					Alert("O agendamento só será permitido para após às " + Subs(Time(),1,5) + ".")
					_lRet := .F.
				EndIf
			Else
				Alert("Para agendamentos no mesmo dia, será necessario informar uma hora diferente de 00:00.")
				_lRet := .F.
			EndIF
		Else
			Processa({|| CursorWait(), _lRet := fGraExe(.F.), CursorArrow() }, "Gravando...","",.T.)
		EndIF
	Else
		_lRet := .F.
	EndIF

	If _lRet
		_lFecha := .T.
	EndIF

Return(_lRet)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fGraExe   ºAutor  ³Leonardo P de Castroº Data ³  11/22/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Rotina que executa a gravacao dos dados do atendimento.     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fGraExe( _lMDia )

	Local _lRet := .T.
	Local _cQuery := ""
	Local _cCond := ""
	Local _nX

	ProcRegua(3)

	IncProc("Gravando atendimento...")

	If RecLock("ZAK",.T.)
		Replace ZAK->ZAK_FILIAL  With xFilial("ZAK")
		Replace ZAK->ZAK_COD     With _cGet1
		Replace ZAK->ZAK_DATA    With _dGet2
		Replace ZAK->ZAK_HORA    With _cGet3
		Replace ZAK->ZAK_CLIENT With _cGet4
		Replace ZAK->ZAK_LOJA    With _cGet5
		Replace ZAK->ZAK_OBSERV  With _cMGet1
		Replace ZAK->ZAK_DTPATE With _dGet8
		Replace ZAK->ZAK_HRPATE With _cGet9
		Replace ZAK->ZAK_CODMOT  With Subs(_aCBox1[_oCBox1:nAt],1,6)
		Replace ZAK->ZAK_CODOPE With _aOper[1]
		ZAK->(MsUnLock())
	Else
		_lRet := .F.
	EndIF

	If _lRet
		If _nGet33 > 0

			For _nX := 1 To Len(_aBrw4)
				If _aBrw4[_nX,1]
					_cCond := _aBrw4[_nX,2]
				EndIF
			Next _nX

			If !Empty(_cCond)

				//Atualizando negociacoes anteriores...
				_cQuery := " UPDATE "
				_cQuery +=  		RetSqlName("ZAL")
				_cQuery += " SET "
				_cQuery += " 		ZAL_STATUS = 'F' "
				_cQuery += " FROM "
				_cQuery +=  		RetSqlName("ZAL") + " ZAL "
				_cQuery += " INNER JOIN "+ RetSqlName("ZAK") + " ZAK ON (ZAL.ZAL_FILIAL = ZAK.ZAK_FILIAL AND ZAL.ZAL_CODATE = ZAK.ZAK_COD) "
				_cQuery += " WHERE "
				_cQuery += " 		ZAK.ZAK_CLIENT+ZAK.ZAK_LOJA = '" + ZAJ->ZAJ_CLIENTE+ZAJ->ZAJ_LOJA + "' AND "
				_cQuery += "  		ZAL.ZAL_STATUS = 'A' AND "
				_cQuery += "  		ZAK.D_E_L_E_T_ <> '*' AND "
				_cQuery += "  		ZAL.D_E_L_E_T_ <> '*' "
				TcSqlExec(_cQuery)

				IncProc("Gravando Negociação...")

				If RecLock("ZAL",.T.)
					Replace ZAL->ZAL_FILIAL  With xFilial("ZAL")
					Replace ZAL->ZAL_COD     With _cGet10
					Replace ZAL->ZAL_CODATE With _cGet1
					Replace ZAL->ZAL_CODOPE With _aOper[1]
					Replace ZAL->ZAL_USASUP  With Iif(_lCBox3,"S","N")
					Replace ZAL->ZAL_VALIDA  With _dGet13
					Replace ZAL->ZAL_STATUS  With "A"
					Replace ZAL->ZAL_COND    With _cCond
					Replace ZAL->ZAL_PRCJUR  With _nGet22
					Replace ZAL->ZAL_PRCMUL  With _nGet24
					Replace ZAL->ZAL_VLRFIN  With _nGet26
					Replace ZAL->ZAL_VLRJUR  With _nGet27
					Replace ZAL->ZAL_VLRMUL  With _nGet28
					Replace ZAL->ZAL_VLRDEV  With _nGet21
					Replace ZAL->ZAL_VLRNEG  With _nGet29
					Replace ZAL->ZAL_FILNEG  With ZAJ->ZAJ_FILDONO
					ZAL->(MsUnLock())
				Else
					_lRet := .F.
				EndIF

				If _lRet

					IncProc("Gravando Títulos...")

					For _nX := 1 To Len(_aBrw3)

						If _aBrw3[_nX,1]
							cFilTit := _aBrw3[_nX,02]
							If RecLock("ZAM",.T.)
								Replace ZAM->ZAM_FILIAL  With xFilial("ZAM")
								Replace ZAM->ZAM_CODNEG  With _cGet10
								Replace ZAM->ZAM_OPER    With "B"
								Replace ZAM->ZAM_PREFIX With _aBrw3[_nX,03]
								Replace ZAM->ZAM_NUM     With _aBrw3[_nX,04]
								Replace ZAM->ZAM_PARCEL With _aBrw3[_nX,05]
								Replace ZAM->ZAM_TIPO    With _aBrw3[_nX,06]
								Replace ZAM->ZAM_NATURE With ""
								Replace ZAM->ZAM_VALOR   With _aBrw3[_nX,10]
								Replace ZAM->ZAM_VALCOR  With _aBrw3[_nX,16]
								Replace ZAM->ZAM_VENCTO  With StoD(_aBrw3[_nX,08])
								Replace ZAM->ZAM_FILTIT  With _aBrw3[_nX,02]
								Replace ZAM->ZAM_DSCJUR  With _aBrw3[_nX,14]
								Replace ZAM->ZAM_DSCMLT  With _aBrw3[_nX,15]
								ZAM->(MsUnLock())
							Else
								_lRet := .F.
							EndIF
						EndIF
					Next _nX

					For _nX := 1 To Len(_aBrw5)

						If RecLock("ZAM",.T.)
							Replace ZAM->ZAM_FILIAL  With xFilial("ZAM")
							Replace ZAM->ZAM_CODNEG  With _cGet10
							Replace ZAM->ZAM_OPER    With "G"
							Replace ZAM->ZAM_PREFIX With _aParams[4]
							Replace ZAM->ZAM_NUM     With _cGet10
							Replace ZAM->ZAM_PARCEL With _aBrw5[_nX,1]
							Replace ZAM->ZAM_TIPO    With _aParams[6]
							Replace ZAM->ZAM_NATURE With _aParams[5]
							Replace ZAM->ZAM_VALOR   With _aBrw5[_nX,3]
							Replace ZAM->ZAM_VALCOR  With _aBrw5[_nX,3]
							Replace ZAM->ZAM_VENCTO  With _aBrw5[_nX,2]
							Replace ZAM->ZAM_FILTIT  With cFilTit
							ZAM->(MsUnLock())
						Else
							_lRet := .F.
						EndIF
					Next _nX

				EndIF
			Else
				//Alert("O parcelamento da negociação não foi informado.")
			EndIF
		Else
			//Alert("O parcelamento da negociação não foi informado.")
		EndIF
	EndIF

	If _lMDia
		//Altero a hora de atendimento
		If RecLock("ZAJ",.F.)
			Replace ZAJ->ZAJ_HORA With _cGet9
			ZAJ->(MsUnLock())
		EndIF

		//Não finaliza o atendimento
		_lRet := .F.
		_lFecha := .T.
	EndIF

Return(_lRet)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fCliente  ºAutor  ³Leonardo P de Castroº Data ³  22/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Chama rotinas dos atalhos do menu lateral.                 º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fCliente(_nOpc)

	Local _aAreSA1 := SA1->(GetArea())
	Local _aAreMA7 := MA7->(GetArea())
	Local aParam := {}

	//Private Inclui := .T.
	//Private Altera := .F.
	Private cAlias := ""
	Private nRecNo := 0
	Private nOpcx  := 0
	Private aRotAuto := NIL

	DbSelectArea("SA1")
	SA1->(DbSetOrder(1))
	SA1->(DbSeek(xFilial("SA1") + ZAJ->ZAJ_CLIENTE + ZAJ->ZAJ_LOJA))

	//Alert(FUNNAME()+" Teste")

	DbSelectArea("MA7")
	MA7->(DbSetOrder(1))
	MA7->(DbSeek(xFilial("MA7") + ZAJ->ZAJ_CLIENTE + ZAJ->ZAJ_LOJA))

	If _nOpc = 1
		Crd010Man("SA1", SA1->(RecNo()), 4)
		//A030Altera("SA1", SA1->(RecNo()), 4)
		//If Pergunte("FIC010",.T.)
		//	Finc010()
		//EndIF
	ElseIf _nOpc = 2
		MATA030Ref()
	ElseIf _nOpc = 3

	EndIF

	RestArea(_aAreSA1)
	RestArea(_aAreMA7)

Return()


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fObserv   ºAutor  ³Leonardo P de Castroº Data ³  11/22/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Rotina para exibir a observacao do atendimento gravado      º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fObserv()

	Local _cMGet1 := ""
	Local _cMGet1
	Local _cSay1  := "Atendimento: " + _aBrw1[_oBrw1:nAt,1]
	Local _oDlg5
	Local _oSay1
	Local _oMGet1
	Local _oBtn1

	If Empty(_aBrw1[_oBrw1:nAt,1])
		Return()
	EndIF

	DbSelectArea("ZAK")
	ZAK->(DbSetOrder(1))

	If ZAK->(DbSeek(xFilial("ZAK") + _aBrw1[_oBrw1:nAt,1]))

		_cMGet1 := ZAK->ZAK_OBSERV

		_oDlg5     := MSDialog():New( 122,322,375,751,"Observação do Atendimento",,,.F.,,,,,,.T.,,,.T. )
		_oSay1     := TSay():New( 006,004,{||_cSay1},_oDlg5,,_oFA08N,.F.,.F.,.F.,.T.,CLR_BLUE,CLR_WHITE,205,011)
		_oMGet1    := TMultiGet():New( 022,002,{|u| If(PCount()>0,_cMGet1:=u,_cMGet1)},_oDlg5,212,084,,,CLR_BLACK,CLR_WHITE,,.T.,"",,,.F.,.F.,.T.,,,.F.,,  )
		_oBtn1     := TButton():New( 111,086,"Ok",_oDlg5,,037,012,,,,.T.,,"",,,,.F. )
		_oBtn1:bAction := {||_oDlg5:End()}

		_oDlg5:Activate(,,,.T.)
	EndIF

Return()

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³ fTitulo  ºAutor  ³Leonardo P de Castroº Data ³  22/11/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Rotina para exibir os titulos negociados.                  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ P10                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fTitulo()

	Local _oDlg
	Local _oTit
	Local _oVerm  := LoadBitmap( GetResources(), "BR_VERMELHO" )
	Local _oVerd  := LoadBitmap( GetResources(), "BR_VERDE"  )
	Local _aTit := {}

	If Empty(_aBrw2[_oBrw2:nAt,2])
		Return()
	EndIF

	DEFINE MSDIALOG _oDlg TITLE "Títulos Negociados" FROM 00,00 TO 250,717 PIXEL OF oMainWnd

	@02,02 TO 120,325 LABEL "" PIXEL OF _oDlg
	@05,04 LISTBOX _oTit FIELDS ;
		HEADER ;
		" ","Pref","Numero","Parc","TP","Naturez","Valor","Val. Corrigido","Venc.","Fil. Tit";
		SIZE 320,115 OF _oDlg PIXEL NOSCROLL

	DbSelectArea("ZAM")
	ZAM->(DbSetOrder(1))

	If ZAM->(DbSeek(xFilial("ZAM") + _aBrw2[_oBrw2:nAt,2]))
		While ZAM->(!Eof()) .And. ZAM->ZAM_CODNEG = _aBrw2[_oBrw2:nAt,2]
			aAdd(_aTit, { 	ZAM->ZAM_OPER,;
				ZAM->ZAM_PREFIX,;
				ZAM->ZAM_NUM,;
				ZAM->ZAM_PARCEL,;
				ZAM->ZAM_TIPO,;
				ZAM->ZAM_NATURE,;
				ZAM->ZAM_VALOR,;
				ZAM->ZAM_VALCOR,;
				ZAM->ZAM_VENCTO,;
				ZAM->ZAM_FILTIT})

			ZAM->(DbSkip())
		EndDo

		_oTit:SetArray(_aTit)
		_oTit:bLine := {|| {If(_aTit[_oTit:nAT,01]='B',_oVerm,_oVerd),;
			_aTit[_oTit:nAt,02],;
			_aTit[_oTit:nAt,03],_aTit[_oTit:nAt,04],;
			_aTit[_oTit:nAt,05],_aTit[_oTit:nAt,06],;
			Transform(_aTit[_oTit:nAt,07],"@E 99,999,999.99"),;
			Transform(_aTit[_oTit:nAt,08],"@E 99,999,999.99"),;
			_aTit[_oTit:nAt,09],_aTit[_oTit:nAt,10]}}
		_oTit:Refresh()
	Else
		Return()
	EndIF

	DEFINE SBUTTON FROM 05,328 TYPE 1 ENABLE OF _oDlg ACTION ( _oDlg:End() )

	ACTIVATE MSDIALOG _oDlg CENTERED

Return(.T.)

// Desconto sob o valor capital do titulo
Static Function DescCapital()
	Local oCancelar
	Local oConfirma
	Local oSay1
	Local oSay2
	Local oSay3
	Local PercDesc
	Local nPercDesc := 0
	Local VlrRen
	Local nVlrRen := 0
	Local VlrTit
	Local nVlrTit := 0
	Static tela

	If (_aBrw3[_oBrw3:nAt,01])
		Alert("Favor desmarcar para alterar o desconto")
		Return
	Endif


	nVlrTit := _aBrw3[_oBrw3:nAt,10]
	nVlrRen := _aBrw3[_oBrw3:nAt,10]

	//          01   02     03      04         05    06   07        08      09       10      11             12      13      14
	//	_aHead3 := {" ","Loja","Pref","No.Titulo","Par","TP","Emissão","Venc.","Atraso","Saldo","Desc Capital","Juros","Multa","A Pagar"}
	// _aBrw3  objeto _oBrw3
	//Alert(_aBrw3[_oBrw3:nAt,08])
	If SToD(_aBrw3[_oBrw3:nAt,08]) <= _aParams[12]
		//_aParams
		DEFINE MSDIALOG tela TITLE "Desconto sobre o valor capital" FROM 000, 000  TO 270, 230 COLORS 0, 16777215 PIXEL

		@ 014, 022 SAY oSay1 PROMPT "Valor Titulo" SIZE 040, 007 OF tela COLORS 0, 16777215 PIXEL
		@ 024, 022 MSGET VlrTit VAR nVlrTit SIZE 060, 010 OF tela PICTURE "@E 999,999,999.99" WHEN .F. COLORS 0, 16777215 HASBUTTON PIXEL

		@ 044, 022 SAY oSay2 PROMPT "Percentual de desconto" SIZE 060, 007 OF tela COLORS 0, 16777215 PIXEL
		@ 054, 022 MSGET PercDesc VAR nPercDesc SIZE 060, 010 OF tela PICTURE "@E 999.99" VALID(ValDesc(nPercDesc)) COLORS 0, 16777215 HASBUTTON PIXEL
		PercDesc:bChange := {|| nVlrRen := nVlrTit - (nVlrTit * (nPercDesc / 100)) }

		@ 074, 022 SAY oSay3 PROMPT "Valor Renegociado" SIZE 050, 007 OF tela COLORS 0, 16777215 PIXEL
		@ 084, 022 MSGET VlrRen VAR nVlrRen SIZE 060, 010 OF tela PICTURE "@E 999,999,999.99" WHEN .F. COLORS 0, 16777215 HASBUTTON PIXEL

		@ 113, 006 BUTTON oConfirma PROMPT "Confirma" ACTION(ConfDesc(nVlrRen,tela)) SIZE 037, 012 OF tela PIXEL
		@ 113, 068 BUTTON oCancelar PROMPT "Cancelar" SIZE 037, 012 OF tela ACTION tela:End() PIXEL

		ACTIVATE MSDIALOG tela CENTERED
	Else
		Alert("Favor selecionar um titulo com vencimento igual ou menor que "+DToC(_aParams[12]))
	EndIf

Return


Static function ValDesc(nPerc)
	Local _lRet := .T.

	If  nPerc > _aParams[13]
		Alert("O Valor Maximo de desconto permitido é: "+Transform(_aParams[13],"@E 999.99")+"%")
		_lRet := .F.
	Endif

Return(_lRet)

Static Function ConfDesc(nRen,tela)
Local _nz

	//          01   02     03      04         05    06   07        08      09       10      11             12      13      14
	//	_aHead3 := {" ","Loja","Pref","No.Titulo","Par","TP","Emissão","Venc.","Atraso","Saldo","Desc Capital","Juros","Multa","A Pagar"}
	Local aFase := GetFase(_aBrw3[_oBrw3:nAt,08] )

	_aBrw3[_oBrw3:nAt,11] := nRen

	If _aBrw3[_oBrw3:nAt,09] > 10
		_aBrw3[_oBrw3:nAt,13] := Round((_aBrw3[_oBrw3:nAt,10] * (GetNewPar('MV_LJBOMUL',2.0)/100)),2)
	EndIf

	_nJuros := GetNewPar('MV_LJBOJUR',9.9)
	//(GetNewPar('MV_LJBOMUL',2.0)/100)

	_nJuros := (_nJuros/30)

	/*_aBrw3[_oBrw3:nAt,12] := Round((_aBrw3[_oBrw3:nAt,10] * ((1+(_nJuros/100)) ^ _aBrw3[_oBrw3:nAt,09])),2)- _aBrw3[_oBrw3:nAt,10]
	_aBrw3[_oBrw3:nAt,13] := Round((_aBrw3[_oBrw3:nAt,10] * (GetNewPar('MV_LJBOMUL',2.0)/100)),2)

	_aBrw3[_oBrw3:nAt,14] := _aBrw3[_oBrw3:nAt,12] * (aFase[3]/100)
	_aBrw3[_oBrw3:nAt,15] := _aBrw3[_oBrw3:nAt,13] * (aFase[4]/100)
*/
	_aBrw3[_oBrw3:nAt,16]	:= _aBrw3[_oBrw3:nAt,11] + _aBrw3[_oBrw3:nAt,13] + _aBrw3[_oBrw3:nAt,12] - _aBrw3[_oBrw3:nAt,14] - _aBrw3[_oBrw3:nAt,15]

	// Recalcula totais
	_nGet14 := 0
	_nGet15 := 0
	_nGet16 := 0
	_nGet17 := 0

	For _nz := 1 to Len(_aBrw3)
		_nGet14 += _aBrw3[_nz,11]
		_nGet15 += _aBrw3[_nz,12]
		_nGet16 += _aBrw3[_nz,13]
		_nGet17 += _aBrw3[_nz,11] + _aBrw3[_nz,12] + _aBrw3[_nz,13]
	Next

	tela:End()

Return

/*/{Protheus.doc} MMTC8XRK
	@description description
	@type User Function
	@author Rafael Karczevski
	@since 28/02/2020
	@version 1.0
	@param param, param_type, param_descr
	@return return, return_type, return_description
	@see (links_or_references)
/*/
User Function MMTC8XRK()

	Private aDdFase := GetFase(_aBrw3[_oBrw3:nAt,8])
	Private nValJur := _aBrw3[_oBrw3:nAt,14]
	Private nValMul := _aBrw3[_oBrw3:nAt,15]
	Private nPorJur := _aBrw3[_oBrw3:nAt,14] / _aBrw3[_oBrw3:nAt,12] * 100
	Private nPorMul := _aBrw3[_oBrw3:nAt,15] / _aBrw3[_oBrw3:nAt,13] * 100
	Private lValid  := .T.

	If _aBrw3[_oBrw3:nAt,1]
		lValid := .F.
		MsgAlert("Não é possivel aplicar desconto em um titulo ja selecionado para renegociação!", "[Fonte: MMTC8XRK]")
	ElseIf !aDdFase[1]
		lValid := .F.
		MsgAlert("Não foi encontrado cadastro de desconto para este titulo, portanto não será permitido alterar o desconto!", "[Fonte: MMTC8XRK]")
	EndIf

	If lValid

		//Declaração de Variaveis Private dos Objetos
		SetPrvt("oDlg1","oPainel","oGrp1","oSay1","oSay2","oSay3","oGet1","oGet2","oGrp2","oSay4","oSay5","oSay6")
		SetPrvt("oGet4","oBtn1","oBtn2")

		//Definicao do Dialog e todos os   seus   componentes.
		oDlg1      := MSDialog():New( 256,563,463,886,"Desconto",,,.F.,,,,,,.T.,,,.T. )
		oPainel    := TPanel():New( 000,000,"",oDlg1,,.F.,.F.,,,156,096,.T.,.F. )

		oGrp1      := TGroup():New( 004,004,076,076," Sobre Juros ",oPainel,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay1      := TSay():New( 016,008,{||"Porcentagem"},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,032,008)
		oSay2      := TSay():New( 044,008,{||"Valor"},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,032,008)
		oSay3      := TSay():New( 066,005,{||"  Desconto maximo " + Transform(aDdFase[3], "@E 999.99") + "%"},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,067,008)
		oGet1      := TGet():New( 024,008,{|u| If(PCount()>0,nPorJur:=u,nPorJur)},oGrp1,060,008,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","",,)
		oGet2      := TGet():New( 052,008,{|u| If(PCount()>0,nValJur:=u,nValJur)},oGrp1,060,008,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","",,)
		//oGet2:bChange := {|| Iif(nValJur / _aBrw3[_oBrw3:nAt,12] * 100 <= aDdFase[3],nPorJur := nValJur / _aBrw3[_oBrw3:nAt,12] * 100, oGet4:Refresh()) }

		oGrp2      := TGroup():New( 004,080,076,152," Sobre Multa ",oPainel,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay4      := TSay():New( 066,081,{||"  Desconto maximo " + Transform(aDdFase[4], "@E 999.99") + "%"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,067,008)
		oSay5      := TSay():New( 043,083,{||"Valor"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,032,008)
		oSay6      := TSay():New( 015,083,{||"Porcentagem"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,032,008)
		oGet3      := TGet():New( 051,083,{|u| If(PCount()>0,nValMul:=u,nValMul)},oGrp2,060,008,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","",,)
		//oGet3:bChange := {|| Iif(nValMul / _aBrw3[_oBrw3:nAt,13] * 100 <= aDdFase[4],nPorMul := nValMul / _aBrw3[_oBrw3:nAt,13] * 100, oGet4:Refresh()) }
		oGet4      := TGet():New( 023,083,{|u| If(PCount()>0,nPorMul:=u,nPorMul)},oGrp2,060,008,'@E 99,999,999.99',,CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,.F.,"","",,)

		oBtn1      := TButton():New( 080,112,"Cancelar",oPainel,{|| oDlg1:End() },037,012,,,,.T.,,"",,,,.F. )
		oBtn2      := TButton():New( 080,072,"Confirmar",oPainel,{|| ValDscTit("Confirmar")},037,012,,,,.T.,,"",,,,.F. )

		oGet1:bValid := {|| ValDscTit("PorJur") }
		oGet2:bValid := {|| ValDscTit("ValJur") }
		oGet3:bValid := {|| ValDscTit("ValMul") }
		oGet4:bValid := {|| ValDscTit("PorMul") }

		oDlg1:Activate(,,,.T.)

	EndIf

Return

/*/{Protheus.doc} GetFase
	@description Obtem a fase
	@type Static Function
	@author Rafael Karczevski
	@since 28/02/2020
	@version 1.0
	@param param, param_type, param_descr
	@return return, return_type, return_description
	@see (links_or_references)
/*/
Static Function GetFase(p_nAtraso)

	Local cAlTMP := GetNextAlias()
	If Select(cAlTMP) > 0
		(cAlTMP)->(DbCloseArea())
	EndIf

	BeginSql Alias cAlTMP
		SELECT
			ZAQ_COD, ZAQ_DSCJUR, ZAQ_DSCMUL
		FROM %Table:ZAQ%
		WHERE
			ZAQ_FILIAL = %Exp:xFilial("ZAQ")%
			AND %Exp:p_nAtraso% BETWEEN ZAQ_DATADE AND ZAQ_DATAAT
			AND %NotDel%
	EndSql
	dbSelectArea(cAlTMP)
	(cAlTMP)->(DbGoTop())

	If (cAlTMP)->(!Eof())
		aRet := { .T., (cAlTMP)->(ZAQ_COD), (cAlTMP)->(ZAQ_DSCJUR), (cAlTMP)->(ZAQ_DSCMUL)}
	Else
		aRet := { .F., "000000", 0, 0}
	EndIf

	If Select(cAlTMP) > 0
		(cAlTMP)->(DbCloseArea())
	EndIf

Return aRet

/*/{Protheus.doc} ValDscTit
	@description Valida Desconto.
	@type Static Function
	@author Rafael Karczevski
	@since 28/02/2020
	@version 1.0
	@param param, param_type, param_descr
	@return return, return_type, return_description
	@see (links_or_references)
/*/
Static Function ValDscTit(p_cCampo)

	Local lRet := .T.

	If p_cCampo == "PorJur"
		If nPorJur <= aDdFase[3] .and. nPorJur >= 0
			nValJur := Round(_aBrw3[_oBrw3:nAt,12] * (nPorJur/100),2)
		Else
			lRet := .F.
		EndIf
	ElseIf p_cCampo == "ValJur"
		If nValJur / _aBrw3[_oBrw3:nAt,12] * 100 <= aDdFase[3] .and. nValJur >= 0
			nPorJur := nValJur / _aBrw3[_oBrw3:nAt,12] * 100
		Else
			lRet := .F.
		EndIf
	ElseIf p_cCampo == "ValMul"
		If nValMul / _aBrw3[_oBrw3:nAt,13] * 100 <= aDdFase[4] .and. nValMul >= 0
			nPorMul := nValMul / _aBrw3[_oBrw3:nAt,13] * 100
		Else
			lRet := .F.
		EndIf
	ElseIf p_cCampo == "PorMul"
		If nPorMul <= aDdFase[4] .and. nPorMul >= 0
			nValMul := _aBrw3[_oBrw3:nAt,13] * (nPorMul/100)
		Else
			lRet := .F.
		EndIf
	ElseIf p_cCampo == "Confirmar"
		_aBrw3[_oBrw3:nAt,14] := nValJur//juros
		_aBrw3[_oBrw3:nAt,15] := nValMul//multa
		_aBrw3[_oBrw3:nAt,16] := _aBrw3[_oBrw3:nAt,11] + _aBrw3[_oBrw3:nAt,12] + _aBrw3[_oBrw3:nAt,13] - nValJur - nValMul
		oDlg1:End()
	EndIf

Return lRet



/*/{Protheus.doc} His06A01
	@description Historico Antigo.
	@type Static Function
	@author Joao Tavares
	@since 11/12/2020
	@version 1.0
	@param param, param_type, param_descr
	@return return, return_type, return_description
	@see (links_or_references)
/*/
Static Function His06A01()

	Local oDlg
	Local oLbx1
	Local cCond     := ""
	Local aArea := GetArea()
	Local cAlTMP := GetNextAlias()
	Private cTitulo   := "Historico de Cobranca"
	Private aVetSF1   := {}
	Private oMemo
	Private cTexto := ""


//+-------------------------------------+
//| Carrega o vetor conforme a condicao |
//+-------------------------------------+

	If Select(cAlTMP) > 0
		(cAlTMP)->(DbCloseArea())
	EndIf
//Select * from ZF1010  Where ZF1_CLIENT = '574809584' order by ZF1_DATA DESC, ZF1_HORA desc
	BeginSql Alias cAlTMP
		SELECT ZF1.*
		FROM %Table:ZF1% ZF1
		WHERE
			ZF1_CLIENT = %Exp:ZAJ->ZAJ_CLIENT%
			AND ZF1_LOJA = %Exp:ZAJ->ZAJ_LOJA%
			AND %NotDel%
		order by  ZF1_DATA DESC, ZF1_HORA desc,ZF1_FILIAL
	EndSql

	While (cAlTMP)->(!Eof())
		aAdd(aVetSF1,{ZF1_FILIAL,StoD(ZF1_DATA), ZF1_HORA, ZF1_PREF, ZF1_NUM, ZF1_PARC,UsrRetName(ZF1_CODUSR),R_E_C_N_O_})
		dbSkip()
	End
	(cAlTMP)->(DbCloseArea())
//+------------------------------------+
//| Se o estiver vazio, nao mostra-los |
//+------------------------------------+
	If Len(aVetSF1)==0
		Aviso(cTitulo,"Nao existe dados a consultar", {"Ok"} )
		Return .t.

	Endif


//+-----------------------------------------------+
//| Monta a tela para usuario visualizar consulta |
//+-----------------------------------------------+
	DEFINE MSDIALOG oDlg TITLE cTitulo FROM 0,0 TO 510,810 PIXEL

	@ 33,3 TO  400,400 LABEL "Historico de cobranca" OF oDlg PIXEL
	@ 40,7 LISTBOX oLbx1 FIELDS HEADER "Filial","Data", "Hora", "Prefixo", "Numero", "Parcela","Usuario";
		SIZE 390,100 OF oDlg PIXEL ON CHANGE MudaLin(oLbx1:nAt)

	oLbx1:SetArray(aVetSF1)
	oLbx1:bLine:={||{aVetSF1[oLbx1:nAt,1],aVetSF1[oLbx1:nAt,2],aVetSF1[oLbx1:nAt,3],aVetSF1[oLbx1:nAt,4],aVetSF1[oLbx1:nAt,5],aVetSF1[oLbx1:nAt,6],aVetSF1[oLbx1:nAt,7]}}


	@ 150, 005 GET oMemo VAR cTexto MEMO SIZE 200, 100 OF oDlg PIXEL

	ACTIVATE MSDIALOG oDlg CENTER ON INIT EnchoiceBar(oDlg,{||oDlg:End()},{||oDlg:End()})

	RestArea(aArea)

Return

///////////////////////////////////////////////////////////////////////////////////
//+-----------------------------------------------------------------------------+//
//| PROGRAMA  | ListBoxItems.prw     | AUTOR | Robson Luiz  | DATA | 18/01/2004 |//
//+-----------------------------------------------------------------------------+//
//| DESCRICAO | Funcao - MudaLin()                                              |//
//|           | Fonte utilizado no curso oficina de programacao.                |//
//|           | Funcao que atualiza o segundo listbox relacionado ao primeiro   |//
//+-----------------------------------------------------------------------------+//
///////////////////////////////////////////////////////////////////////////////////
Static Function MudaLin(nPos)

	dbSelectArea("ZF1")
	dbgoto(aVetSF1[npos,8])


//cTexto += +CRLF 
	cTexto := ZF1->ZF1_HISTOR
	oMemo:refresh()

Return
