#Include 'Protheus.ch'
#INCLUDE "TOPCONN.CH"

/*/{Protheus.doc} SF69C02X
    Faz a busca do Docente na base do RM, para identificar se o Fornecedor ja é um professor cadastrado
    @type  User Function
    @author Daniel Castro - Totvs
    @since 16/09/2020
    @version 1
    /*/

User Function SF69C02X(oModel)

    Local cQuery    := ""
    Local nTot      := 0
    Local oModelSA2 := oModel:GetModel("SA2MASTER")

    cQuery := " SELECT pp.nome, pp.cpf, pp.dtnascimento, pp.bairro, pp.rua, pp.numero, pp.estado, pp.telefone1,sp.codprof,sp.codcoligada " + CRLF
    cQuery += " FROM rm.sprofessor@RMSGE sp " + CRLF
    cQuery += " INNER JOIN rm.ppessoa@RMSGE pp ON sp.codpessoa = pp.codigo " + CRLF
    cQuery += " WHERE pp.cpf = '" + Alltrim(M->A2_CGC) + "' " + CRLF

    IF Select("TMP") <> 0
       TMP->(dbCloseArea())
    EndIf 

    MPSysOpenQuery( cQuery, 'TMP' )

    TMP->(dbGotop())
    Count to nTot
    TMP->(dbGotop())

    If nTot <> 0

        oModelSA2:LoadValue("A2_XCODCOL",ALLTRIM(TMP->CODCOLIGADA))
        oModelSA2:LoadValue("A2_XCODPRO", ALLTRIM(TMP->CODPROF))
        oModelSA2:LoadValue("A2_XDOCNOM", ALLTRIM(TMP->NOME))

    else
        Aviso("[ATENÇÃO] " + FunName()+"/"+ProcName(),"Fornecedor não cadastrado como Docente.",{"OK"},2)
    EndIf

    TMP->(dbCloseArea())

Return(.T.)
