#INCLUDE "protheus.ch" 

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CN120EPM  ºAutor  ³Bruna Paola         º Data ³  19/03/2012 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Ponto de entrada para alterar a filial corrente antes do pro-º±±
±±º          ³cessamento da exclusão do pedido de compra                  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³                                                            º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/        
User Function CN120EPM()  
 
Local cProc := ""  
Local cFunc := "U_CNIEstMe" // Se for estorno da liberação da SC 
Local lRet  := .F. 
Local nX := 0 


While !Empty(cProc := ProcName( nX++ )) .And. !lRet
	lRet := (Alltrim(Upper(cProc)) == cFunc)
End  

// Só para estorno na rotina de medição
If (SubStr(CND->CND_OBS,1,78) == "Medição gerada automaticamente a partir da liberação da Solicitação de Compras") .OR.;
	(SubStr(CND->CND_OBS,1,71) =="Medição gerada automaticamente a partir da inclusão do pedido de compra")
	cXFil := CFILANT 
	
ElseIf(lRet)
// Posiciona na CND
	DbSelectArea("SC7")
	DbSetOrder(1)
	DbGoTop()
	
	If(DbSeek(xFilial("SC7")+SC1->C1_PEDIDO+SC1->C1_ITEMPED))
		DbSelectArea("CND")
		DbSetOrder(4)
		DbGoTop() 
		
		If(DbSeek(cFilCn9/*PA9->PA9_FILCN9*/+SC7->C7_MEDICAO))  
			cXFil := CFILANT 
		EndIf
	EndIf
	
   //	cXFil := CFILANT 
  //	CFILANT := cFilOri       
EndIf
	
Return .T.