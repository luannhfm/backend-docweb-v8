#Include "TOTVS.ch"
#Include "FWMVCDef.ch"

/*/{Protheus.doc} CNTA021
Ponto de entrada no padrão MVC da rotina CNTA021.
@author Franklin de Brito De Oliveira
@since 29/09/2020
@return xRet, o retorno varia de acordo com o ponto em que foi chamado.
@see https://tdn.totvs.com/pages/releaseview.action?pageId=208345968
@type function
/*/
User Function CNTA021()

	Local aParam    := PARAMIXB
	Local xRet      := .T.
	Local oObj      := ""
	Local cIdPonto	:= ""
	Local cIdModel	:= ""
	Local cClasse	:= ""
	Local cTpPessoa	:= ""
	Local nOper		:= 0
	Local cEspCtr	:= "" //1=Compra;2=Venda
	 	 
	If( aParam <> NIL )
	              
	    oObj       := aParam[ 1 ]
	    cIdPonto   := aParam[ 2 ]
	    cIdModel   := aParam[ 3 ]
	    cClasse    := IIf( oObj <> Nil , oObj:ClassName() , "" )
	    nOper := oObj:GetOperation()
	  
	    If( cIdPonto == "MODELPOS" ) 
	    //Chamada na validação total do modelo (MODELPOS)
		    If nOper == MODEL_OPERATION_INSERT .Or. nOper == MODEL_OPERATION_UPDATE
		    	cEspCtr := oObj:GetValue('CN1MASTER', 'CN1_ESPCTR')
		    	cCodMin := oObj:GetValue('CN1MASTER', 'CN1_XMINUT')
		    	//Verifica se a minuta Existe e se está Ativa.
		    	xRet := U_fVldZG3(cCodMin,cEspCtr)
		    Else
		    	xRet := .T.
		    EndIf
	    ElseIf( cIdPonto == "FORMPOS" )       
	        //Chamada na validação total do formulário (FORMPOS)	            
	        If( cClasse == "FWFORMGRID" )
	            xRet := .T.
	        ElseIf cClasse == "FWFORMFIELD"
	            xRet := .T.
	        EndIf
	    ElseIf( cIdPonto == "FORMLINEPRE" )
	        //Chamada na pre validação da linha do formulário (FORMLINEPRE). Onde esta se tentando deletar uma linha.	           
	        If( aParam[ 5 ] == "DELETE" )
	            xRet := .T.
	        EndIf
	    ElseIf( cIdPonto == "FORMLINEPOS" )
	        //Chamada na validação da linha do formulário (FORMLINEPOS).
	        xRet := .T.
	    ElseIf( cIdPonto == "MODELCOMMITTTS" )
	        //Chamada apos a gravação total do modelo e dentro da transação (MODELCOMMITTTS).
	        xRet := .T.
		ElseIf( cIdPonto == "MODELCOMMITNTTS" )
	        //Chamada apos a gravação total do modelo e fora da transação (MODELCOMMITNTTS).           
	        xRet := .T.	
	    ElseIf( cIdPonto == "FORMPRE" )
	    	//Chamada antes da alteração de qualquer campo do formulário (FORMPRE).
			xRet := .T.
	    ElseIf( cIdPonto == "FORMCOMMITTTSPRE" )
			xRet := .T.
	        //Antes da gravação da tabela do formulário. (FORMCOMMITTTSPRE).
	    ElseIf cIdPonto == "FORMCOMMITTTSPOS"
	        //Chamada apos a gravação da tabela do formulário (FORMCOMMITTTSPOS).
	        xRet := .T.	       
	    ElseIf cIdPonto == "MODELCANCEL"
	        //Chamada no Botão Cancelar (MODELCANCEL).
	        xRet := .T.
	    ElseIf cIdPonto == "BUTTONBAR"
	    	//Para a inclusão de botões na ControlBar.
	    EndIf     
	EndIf
Return( xRet )