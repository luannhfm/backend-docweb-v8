#Include 'Protheus.ch'
#Include 'TopConn.ch'

/*/{Protheus.doc} SF07E03J
Fonte utilizado no Inicializador padrao do campo RA_MAT.
@type function
@author Jose Leite de Barros Neto
@since 	27/07/2015
@return character, Matricula do Funcionario
/*/
User Function SF07E03J()
	
	Local _aArea 	:= GetArea()
	Local _cQuery	:= ''
	Local _cRaMat 	:= ''
	Local _cFilRe	:= SubStr(cFilAnt,1,4)

	If INCLUI
		
		If Select('TMP') > 0
			DbSelectArea('TMP')
			TMP->(DbCloseArea())
		EndIf
		
		_cQuery := " SELECT MAX(RA_MAT) RA_MAT "
		_cQuery += " FROM " + RetSQLName("SRA")
		_cQuery += " WHERE RA_FILIAL <> '04MT0002' "
		_cQuery += " AND SubStr(RA_FILIAL,1,4) = '"+_cFilRe+"'
		
		if SubStr(_cFilRe, 1, 4)=="03MT"
			_cQuery += " AND RA_MAT <> '13' AND RA_MAT < '004000'	"
		else
			_cQuery += " AND RA_MAT <> '13' AND RA_MAT < '900000'	"
		endif
		
		_cQuery := ChangeQuery(_cQuery)
						
		TcQUERY _cQuery NEW ALIAS 'TMP'
						
		DbSelectArea('TMP')
		TMP->(DbGoTop())
		
		_cRaMat := Iif(Empty(TMP->(RA_MAT)), '000001', StrZero(Val(TMP->(RA_MAT)) + 1, TamSx3("RA_MAT")[1]))
		
		TMP->(DbCloseArea())
		
	EndIf
	
	RestArea(_aArea)
	
Return( _cRaMat )
