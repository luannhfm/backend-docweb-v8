#Include 	"Protheus.ch"
#Include	"Rwmake.ch"
#Include	"Totvs.ch"
#Include	"TopConn.CH"
/*
+--------------------------------------------------------------------------+
|{Protheus.doc}<SN069RX>                                                   |
|Relatorio financeiro por sessao     				                   	   |
|                                                                          |
|@Author<Caio Renan>                                                       |
|@since<30/06/2014>                                                        |
|@version<Nil>                                                             |
|                                                                          |
|@parameters<Nil>                                                          |
|@return<Nil>                                                              |
+--------------------------------------------------------------------------+
|Uso        |SENAI										     			   |
+-----------+--------------------------------------------------------------+
*/
User Function SN069RX()
Local oReport

Private _cPerg := "SN069RX"
Private _cALias := GetNextAlias()
Private oSessao // variaveis dos objetos de secao
Private _cPicture := TM(999999999.99,14,2) // "@E 999,999,999.99"

If FindFunction("TRepInUse") // .And. TRepInUse()
	//-- Interface de impressao
	oReport := ReportDef()
	oReport:PrintDialog()
EndIf

Return


//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao Definicoes dos objetos treport
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function ReportDef()
Local oReport
Local _cDescri := "Relatório Financeiro por Sessão"

AjustaSX1(_cPerg)

Pergunte(_cPerg, .F.)

oReport := TReport():New(_cPerg,_cDescri,_cPerg,{|oReport| PrintReport(oReport)},_cDescri)
//oReport:nLeftMargin := 2
oReport:SetLeftMargin(2)
//oReport:nFontBody := 8
//oReport:nLineHeight := 45
oReport:SetLandScape() // paisagem
oReport:SetPortrait() // Retrato
oReport:oPage:SetPaperSize(9) // papel A4
oReport:SetEnvironment(2) // local
//oReport:HideParamPage()
//oReport:ShowParamPage()
//oReport:SetCustomText( {|| GerTitulo(dDataFim,titulo,oReport) } ) // Cabecalho 
oReport:SetTotalInLine(.F.)

oSessao := TRSection():New(oReport,"Sessão" ,{_cALias} )
//oSection:SetLeftMargin(2)

TRCell():New(oSessao,"ZP7_XPERIO"     ,_cALias)
TRCell():New(oSessao,"ZP7_XSEG"       ,_cALias)
TRCell():New(oSessao,"ZP7_XSESSA"     ,_cALias)
TRCell():New(oSessao,"ZP7_XCONVE"     ,_cALias)
TRCell():New(oSessao,"ZP7_XCHTPG"     ,_cALias)
TRCell():New(oSessao,"ZP7_XVALOR"     ,_cALias,,_cPicture,14)
//TRCell():New(oSection,"VALOR"       ,_cALias,"Valor",_cPicture,14,.F.,{|| Transform((_cALias)->VALOR,_cPicture) })

//oTotal:lHeaderSection := .F.
//oTotal:nLinesBefore := 0

Return(oReport)
//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
//³funcao que realiza o filtro e imprimi os dados na tela³
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function PrintReport(oReport)

MsgRun( "Selecionando registros...", "Aguarde" ,  {|| GeraQuery() } )

oSessao:Print()
/*
//oReport:SetMeter(10)
	oReport:IncMeter() // incrementa regua
	if oReport:Cancel() // trata possivel cancelamento do relatorio.
		oReport:PrintText("CANCELADO PELO USUÁRIO")
		exit
	Endif
*/

(_cALias)->(dbClosearea())
Return
//ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
// funcao que realiza o sql do relatorio
//ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
Static Function GeraQuery()
Local _cSql := ""
//Local _nOrdem := oGCT:GetOrder()
//oSection:aOrder := {} // redefinicao do array de ordem do relatorio, pois se deixar o array com informacao a classe treport tenta setar a ordem no alias selecionado.

MakeSQLExpr(_cPerg)

MV_PAR01 := StrTran(MV_PAR01,"IN","ZP7_XSESSA IN")
MV_PAR01 := StrTran(MV_PAR01,"BETWEEN","ZP7_XSESSA BETWEEN")

_cSql += " SELECT * FROM "+RetSQLName("ZP7")+" ZP7 "+CRLF
_cSql += " WHERE ZP7.D_E_L_E_T_<>'*'  "+CRLF

If !Empty(MV_PAR01)
	_cSql += " AND "+MV_PAR01+" "+CRLF
EndIf

MemoWrite("D:\LOGSQL\"+_cPerg+".txt" , _cSql) // escreve em arquivo de texto e se nao encontrar cria o arquivo
If Select(_cALias) > 0
	(_cALias)->(dbClosearea())
Endif

DbUseArea(.T., "TOPCONN", TCGenQry(,,ChangeQuery(_cSql)), _cALias, .F., .F.)

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³sx1inv    ºAutor  ³caio renan          º Data ³  05/23/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³AJUSTA AS PERGUNTAS                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function AjustaSX1(cPerg)

Local aHelp01 := {}
Local aHelp03 := {}
Local aHelp04 := {}
Local aHelp05 := {}
Local aHelp06 := {}

//--------------------------------------------------------------------

u_SFPUTSX1(cPerg, "01", "Sessao?"     		,"","","mv_ch1","C",10,00,00,"R","",""	 ,"","","mv_par01","","","","","","","","","","","","","","","","",,"","","") 

Return
