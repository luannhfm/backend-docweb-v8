#Include "protheus.ch" 

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³GCPA02PBUTºAutor  ³Eric do Nascimento  º Data ³  12/22/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Utilizando o Ponto de entrada GCPA02PBut para adicionar   º±±
±±º          ³ Botão                                                      º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ Adicionar Botão no fonte GCPA002                           º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function GCPA02PBut()

Local aButtons := {}
Local nLinha := oGetEdt:nAt 
Local nPosProd := aScan(oGetEdt:aHeader,{|x| ALLTrim(x[2])=="CO2_CODPRO"})
Local cProd := oGetEdt:acols[nLinha,nPosProd]

aAdd( aButtons ,{ ,{|| U_CONSPRFO(cProd)},,"Prod X Forn"})
aAdd( aButtons ,{ ,{|| U_CONSGPRFO(cProd)},,"GrProd X Forn"})

Return (aButtons) 

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CONSPRFO  ºAutor  ³Eric do Nascimento  º Data ³  12/22/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Filtro simulando F3 para          Produto X Fornecedor     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ F3 - Produto X Fornecedor                         		  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function CONSPRFO(cProd)

Local xRet    := .F.
Local nI      := oGetPart:oBrowse:nAt
Local cTipo   := oGetPart:aCOLS[nI,aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_TIPO"})]
LOCAL aArea   := GetArea()

dbSelectArea("SB1")
SB1->(DbSetOrder(1))
SB1->(DbSeek(xFilial("SB1")+cProd))

If cTipo=="2" .AND. M->CO1_MODALI <> "LL"
	xRet := ConPad1(,,,"SB1GC2")  // Produto X Fornecedor 
Else
	MSGINFO("O tipo deve ser fornecedor", "Aviso")
EndIf
                      
If xRet
	oGetPart:aCOLS[nI,aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_CODIGO"})]:= SA5->A5_FORNECE
Endif

cForn:=oGetPart:aCOLS[nI,aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_CODIGO"})]

U_VCONSGPRFO(cTipo, cForn) // Validar e Simular Gatilho

RestArea(aArea)
Return(xRet)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CONSGPRFO ºAutor  ³Eric do Nascimento  º Data ³  12/22/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Filtro simulando F3 para Grupo de Produto X Fornecedor     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ F3 - Grupo de Produto X Fornecedor                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function CONSGPRFO(cProd)

Local xRet    := .F.
Local nI      := oGetPart:oBrowse:nAt
Local cTipo   := oGetPart:aCOLS[nI,aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_TIPO"})] 
LOCAL aArea   := GetArea()  

dbSelectArea("SB1")
SB1->(DbSetOrder(1))
SB1->(DbSeek(xFilial("SB1")+cProd))

If cTipo=="2" .AND. M->CO1_MODALI <> "LL"
	xRet := ConPad1(,,,"SADGC2")  // Grupo de Produto X Fornecedor 
Else
	MSGINFO("O tipo deve ser fornecedor", "Aviso")
EndIf
                      
If xRet
	oGetPart:aCOLS[nI,aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_CODIGO"})]:= SAD->AD_FORNECE
Endif

cForn:=oGetPart:aCOLS[nI,aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_CODIGO"})]

U_VCONSGPRFO(cTipo, cForn)// Validar e Simular Gatilho
RestArea(aArea)

Return(xRet)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CONSGPRFO ºAutor  ³Eric do Nascimento  º Data ³  12/22/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valida e simula gatilho para preencher o loja e nome do     º±±
±±º          ³fornecedor selecionado                                      º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³Validar e simular gatilho para fornecedor                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function VCONSGPRFO(cTipo, cForn)

Local lRet     := .T.
Local i        := 0
Local nT_aCOLS := Len(oGetPart:aCOLS)
Local nItem    := oGetPart:oBrowse:nAt
Local nP_Tip   := aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_TIPO"})
Local nP_For   := aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_CODIGO"})
Local nP_Loj   := aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_LOJA"})
Local nP_Nom   := aScan(oGetPart:aHeader,{|x| Trim(x[2])=="CO3_NOME"})
Local cLoj	   := ""

cLoj	 := SA2->A2_LOJA

If !Empty(cForn) .And. !Empty(cLoj)
	oGetPart:aCOLS[nItem,nP_Loj] := Posicione("SA2",1,xFilial("SA2")+cForn+cLoj,"A2_LOJA")
	oGetPart:aCOLS[nItem,nP_Nom] := Posicione("SA2",1,xFilial("SA2")+cForn+cLoj,"A2_NOME")
	If SA2->(Eof())
		Help("",1,"GCP02FORC") //"Fornecedor não cadastrado"
		lRet := .F.
	Endif
	If SA2->A2_MSBLQL == '1' // Bloqueado SIM
		Help("",1,"GCP02FORB") //"Fornecedor bloqueado"
		lRet := .F.
	EndIf
EndIf

For i:=1 To nT_aCOLS
	If i <> nItem
		If oGetPart:aCOLS[i,nP_Tip] == cTipo .And.  oGetPart:aCOLS[i,nP_For] == cForn .And. oGetPart:aCOLS[i,nP_Loj] == cLoj
			Help("",1,"GCP02FDUP") //"Já existe este código de fornecedor/cliente para o produto"
			lRet := .F.
		Endif
	Endif
Next i

Return(lRet)