#Include 'Protheus.ch'

/*/{Protheus.doc} SF69S01A
@description Dispara a função que alerta o término ou proximidade do término do contrato e atualiza o parâmetro MV_ATUGCT.
@type User Function
@author Alan Teles de Oliveira
@since 28/03/2019
@version 12.1.17
@param p_aParam[1], characters, código da empresa.
@param p_aParam[2], characters, código da filial.
@param p_aParam[3], characters, código do usuário.
@param p_aParam[4], characters, código do agendamento.
/*/
User Function SF69S01A(p_aParam)

    Local nX		:= 0
    Local aFilial	:= {}
    Local aArea     := GetArea()

    //Abre módulo nas filiais indicada
    RpcSetType(3)
    RpcSetEnv(p_aParam[01], p_aParam[02],,, "GCT")

    dbSelectArea("SM0")
    SM0->(dbGoTop())

    While .not. SM0->(Eof())
        
        aAdd(aFilial, {SM0->M0_CODIGO, SM0->M0_CODFIL})

        SM0->(dbSkip())

    EndDo

    RpcClearEnv()
    RestArea(aArea)

    For nX := 1 To Len(aFilial)

        //Abre módulo nas filiais indicada
        RpcSetType(3)
        RpcSetEnv(aFilial[nX, 01], aFilial[nX, 02],,, "GCT")

        GCTInitFun()

        RpcClearEnv()

    Next 

Return
