#Include "Protheus.ch"

/*/{Protheus.doc} RetCCD
Retorna o centro de custo associado à filial
@author franklin.oliveira
@since 17/01/2020
@version 1.0
@return  character, Código do centro de custo (CTT)
@type function
@history 17/01/2020, Franklin de Brito de Oliveira, Simplificação  na lógica condicional 
/*/
User Function RetCCD()

Local cRet      := ""    
Local cChave    := ""
Local cChaveAnt := SE2->E2_FILIAL+SE2->E2_FORNECE+SE2->E2_LOJA+SE2->E2_PREFIXO+SE2->E2_NUM

//Se Origem for Transferência pega da Filial Origem a Baixa
If "SIFINA14" $ SE2->E2_HIST
   //Posiciona no Tit anterior
	DbSelectarea("SE2")
	DbSetOrder(6) //E2_FILIAL+E2_FORNECE+E2_LOJA+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO
	cChave := SE2->E2_XFILDES+SE2->E2_FORNECE+SE2->E2_LOJA+SE2->E2_PREFIXO+SE2->E2_NUM
	If !DbSeek(cChave)
			ConOut("["+DtoC(Date())+" "+Time()+"] Não foi possível localizar o título de Origem: " + cChave)
	Endif
Endif

If (SE2->E2_FILIAL $ "02MT/03MT") 
	If Empty(SE2->E2_XNUMTRF)
		If (SE2->E2_FILIAL == "02MT0005")
			cRet := "13040115"
		Elseif (SE2->E2_FILIAL == "02MT0006")
			cRet := "13040113"
		Elseif (SE2->E2_FILIAL == "02MT0008")
			cRet := "13040106"
		Elseif (SE2->E2_FILIAL == "02MT0009")
			cRet := "1301090106"
		Elseif (SE2->E2_FILIAL == "02MT0010")
			cRet := "13040107"
		Elseif (SE2->E2_FILIAL == "02MT0011")
			cRet := "13040117"
		Elseif (SE2->E2_FILIAL == "02MT0012")
			cRet := "13040116"
		Elseif (SE2->E2_FILIAL == "02MT0013")
			cRet := "1301090108"
		Elseif (SE2->E2_FILIAL == "02MT0014")
			cRet := "13040109"
		Elseif (SE2->E2_FILIAL == "02MT0015")
			cRet := "13040112"
		Elseif (SE2->E2_FILIAL == "03MT0002")
			cRet := "13040107"
		Elseif (SE2->E2_FILIAL == "03MT0003")
			cRet := "13040112"
		Elseif (SE2->E2_FILIAL == "03MT0004")
			cRet := "13040115"
		Elseif (SE2->E2_FILIAL == "03MT0005")
			cRet := "13040105"
		Elseif (SE2->E2_FILIAL == "03MT0007")
			cRet := "13040107"
		Elseif (SE2->E2_FILIAL == "03MT0008")
			cRet := "13040106"
		Elseif (SE2->E2_FILIAL == "03MT0010")
			cRet := "13040109"
		Elseif (SE2->E2_FILIAL == "03MT0011")
			cRet := "1303010803"
		Elseif (SE2->E2_FILIAL == "03MT0012")
			cRet := "13030109"
		Elseif (SE2->E2_FILIAL == "03MT0015")
			cRet := "13040104"
		Elseif (SE2->E2_FILIAL == "03MT0016")
			cRet := "13040110"
		Elseif (SE2->E2_FILIAL == "03MT0017")
			cRet := "13040101"
		Elseif (SE2->E2_FILIAL == "03MT0018")
			cRet := "13040102"
		Elseif (SE2->E2_FILIAL == "03MT0019")
			cRet := "13040114"
		Elseif (SE2->E2_FILIAL == "03MT0020")
			cRet := "13040103"
		Elseif (SE2->E2_FILIAL == "03MT0021")
			cRet := "13040111"
		Elseif (SE2->E2_FILIAL == "03MT0022")
			cRet := "13040118"
		EndIf
	Elseif !Empty(SE2->E2_XNUMTRF)
		cRet := SE2->E2_CCD
	EndIf
Elseif (Empty(SE2->E2_XNUMTRF))
	If U_LPCTD530001() == "21010201001"
		cRet := "9999999999" 
	Else
		cRet := " "
	Endif
Elseif (!Empty(SE2->E2_XNUMTRF))
	cRet := SE2->E2_CCD
Endif

//Retorna Posicionamento Original
	DbSelectarea("SE2")
	DbSetOrder(6) ////E2_FILIAL+E2_FORNECE+E2_LOJA+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO
	If !DbSeek(cChaveAnt)
		ConOut("["+DtoC(Date())+" "+Time()+"] Não foi possível localizar o título Original: " + cChaveAnt)
	Endif

Return(cRet)
