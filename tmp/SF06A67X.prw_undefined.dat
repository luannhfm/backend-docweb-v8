#Include 'Protheus.ch'

/*/{Protheus.doc} SF06A67X
	Baixa de Contas a Receber para os programas relacionados a Integração Sócio Industria
	@author Daniel Castro - TOTVS
	@since 06/12/2021
	@param Prefixo,Numero,Tipo,Parcela,Saldo, Executado em Tela ( .T.,.F.)
	@see https://tdn.totvs.com/pages/releaseview.action?pageId=6070728
/*/

User Function SF06A67X(cPref,cNum,cTipo,cParcel,nSaldo,lTela,cDtLiq,nVlLiq)

	Local aBaixa := {}
	Local x			:= ""
	Private lMsErroAuto := .F.

	aBaixa := {{"E1_PREFIXO"    , cPref		    ,Nil    },;
		{"E1_NUM"               , cNum		    ,Nil    },;
		{"E1_TIPO"              , cTipo		    ,Nil    },;
		{"E1_PARCELA"           , cParcel	    ,Nil    },;
		{"AUTMOTBX"             ,"NOR"			,Nil    },;
		{"AUTBANCO"             ,"001"			,Nil    },;
		{"AUTAGENCIA"           ,"4205 "		,Nil    },;
		{"AUTCONTA"             ,"21685     "	,Nil    },;
		{"AUTDTBAIXA"           ,Iif(!Empty(cDtLiq),cDtLiq,dDataBase)		,Nil    },;
		{"AUTDTCREDITO"         ,Iif(!Empty(cDtLiq),cDtLiq,dDataBase)		,Nil    },;
		{"AUTHIST"              ,"Baixa API Sócio Industria"	,Nil    },;
		{"AUTJUROS"             ,0				,Nil,.T.},;
		{"AUTMULTA"             ,0         		,Nil	},;
		{"AUTDESCONT"           ,0	         	,Nil	},;
		{"AUTCM1"	            ,0         		,Nil	},;
		{"AUTVALREC"            ,Iif(!Empty(nVlLiq),nVlLiq,nSaldo)     	,Nil    }}

	msExecAuto({|x,y,z,a| fina070(x,y,z,a)},aBaixa,3)

	if !lMsErroAuto
		aAdd(aLog ,"Título - " +cPref+"/"+cNum+"/"+cTipo+"/"+cParcel+ " baixado com sucesso.")

		//Cria Contas a Pagar
		If lTela
			Processa({|| U_SF06A68X(cPref,cNum,cTipo,cParcel,lTela)}, "Gerando Contas a Pagar ...")
		else
			U_SF06A68X(cPref,cNum,cTipo,cParcel,lTela)
		EndIf
	else
		aAdd(aLog ,MostraErro("/dirdoc", "error.log"))
	ENDIF

Return
