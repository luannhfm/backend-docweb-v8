#Include 'Protheus.ch'
#INCLUDE "RPTDEF.CH"
#INCLUDE "FWPrintSetup.ch"
#INCLUDE "TOTVS.ch"
#INCLUDE "Topconn.ch"
#INCLUDE "TBICONN.CH"

User Function SS33R3S()

	Local cPerg            := 'SS33R3S'
	Local lAdjustToLegacy  := .F.
	Local lDisableSetup    := .T.
	Local cLocal           := "C:\PDF\"
	Local cTotal           := 0
	Local nLin1            := 552
	Local cTpAtend         := " "
	Local cProfis          := " "
	Local cDProfis		  := " "
	//Alterado 16/07/2014 AS 10:20
	Local cCodUser         := ZZM->ZZM_CODUS + SUBSTR(ZZM->ZZM_ATEND,8,1) + "6.REL"
	 
	Local oNew14N			  := TFont():New("Courier New"	,14,14,,.T.,,,,.F.,.F.)		// Negrito
	
	//PRIVATE cNomRel        := "Relatorio Caixa por Operador Analitico"
	//PRIVATE cNomRel1       := "Relatorio Caixa por Operador Sintetico"
	Local cCompanyName     := AllTrim(FWFilialName())
	
	/*	Jose Leite - 23-07-14
		Logo da Empresa
		Nome do Relatorio
	*/
	//Inicio
	Local cLogo 			  := ""
	Local cNomRel			  := ZZM->ZZM_FILIAL+"_"+ZZM->ZZM_ATEND+"_"+DTOS(dDataBase)  
	//Fim
	
	PRIVATE nLin           := 150
	
	//PRIVATE nPag           := 1
	
	//Jose Leite - Logo da empresa - 23-07-14
	//Inicio
	If File('\system\sesi.bmp')
		cLogo := 'sesi.bmp'
	Else
		cLogo := 'msmdilogo.bmp'
	EndIf
	//Fim
	
	//oPrinter := FWMSPrinter():New("SS33R3S.rel", IMP_PDF, lAdjustToLegacy,cLocal, lDisableSetup, , , , , , .F., )
	//oPrinter := FWMSPrinter():New(cCodUser, IMP_SPOOL, lAdjustToLegacy, , lDisableSetup, , , , , , .F., )
	oPrinter := FWMSPrinter():New(cNomRel, IMP_SPOOL, lAdjustToLegacy, , lDisableSetup, , , , , , .F., )
	oPrinter:SetResolution(72)
	oPrinter:SetLandscape( )
	oPrinter:SetPaperSize(DMPAPER_A4)
	oPrinter:SetMargin(60,60,60,60) // nEsquerda, nSuperior, nDireita, nInferior
	//oPrinter:cPathPDF := "C:\PDF\"
	
	//Tipo de Atendimento
	If (ZZM_TPATEN == '1')
		cTpAtend := 'ADMISSAO'
	ElseIf(ZZM_TPATEN == '2')
		cTpAtend := 'DEMISSAO'
	ElseIf(ZZM_TPATEN == '3')
		cTpAtend := 'MUDANCA DE FUNCAO'
	ElseIf(ZZM_TPATEN == '4')
		cTpAtend := 'PERIODICO'
	ElseIf(ZZM_TPATEN == '5')
		cTpAtend := 'RETORNO AO TRABALHO'
	ElseIf(ZZM_TPATEN == '6')
		cTpAtend := 'AVALIACAO MEDICA'
	ElseIf(ZZM_TPATEN == '7')
		cTpAtend := 'ADMISSIONAL 6 MES'
	ElseIf(ZZM_TPATEN == '8')
		cTpAtend := 'TAP'
	ElseIf(ZZM_TPATEN == '9')
		cTpAtend := 'OUTROS'
	EndIf
		
	//Cabeçalho
	oPrinter:Box( 010,010, 43, 580, "-4")
	//oPrinter:SayBitmap(011,011,"C:\Desenvolvimento\Projetos\SESICLINICA\SESI.BMP",120,30)
	//oPrinter:SayBitmap(011,011,"C:\PDF\SESI.BMP",120,30)
	
	//Jose Leite - Logo da empresa - 23-07-14
	//Inicio
	oPrinter:SayBitmap(011,011,cLogo,120,30)
	//Fim
	
	oPrinter:Say( 020, 270, cCompanyName         , oNew14N)
	oPrinter:Say( 020, 420, 'Dt. do Atendimento:   ' + DtoC(ZZM->ZZM_DATA),  oNew14N)
	oPrinter:Say( 030, 420, 'Dt. do Procedimento: ' + DtoC(ZZM->ZZM_DTPROC),  oNew14N)
	oPrinter:Say( 042, 260, "GUIA DE ATENDIMENTO", oNew14N)
	oPrinter:Say( 042, 505, "Nº " + ZZM->ZZM_ATEND    , oNew14N)
	
	//Trabalhadores
	oPrinter:Box(050,010, 100, 580, "-4")
	oPrinter:Say(062,020, 'Trabalhador  - ', oNew14N)
	oPrinter:Say(062,085, ZZM->ZZM_TRABAL  , oNew14N)
	oPrinter:Say(062,135, ZZM->ZZM_NOMTRA  , oNew14N)
	oPrinter:Say(074,020, 'Empresa      - ', oNew14N)
	oPrinter:Say(074,085, ZZM->ZZM_CODCLI  , oNew14N)
	oPrinter:Say(074,129, ZZM->ZZM_LOJA    , oNew14N)
	oPrinter:Say(074,152, ZZM->ZZM_NOME    , oNew14N)
	oPrinter:Say(086,020, 'Profissional - ' , oNew14N)
	oPrinter:Say(098,020, 'Tipo Atend   - ' , oNew14N)
	oPrinter:Say(098,085, cTpAtend          , oNew14N)
	
	//Procedimentos
	oPrinter:Box(108, 010, 300, 580, "-4")
	oPrinter:Say(121, 260, "PROCEDIMENTO", oNew14N)
	oPrinter:Line(130, 10, 130, 580, , "-4")
	oPrinter:Line(142, 10, 142, 580, , "-4")
	oPrinter:Say(139,023, 'Codigo' , oNew14N)
	oPrinter:Line(130,70, 300, 70, , "-4")
	oPrinter:Say(139,240, 'Especificação', oNew14N)
	oPrinter:Line(130,450, 300, 450, , "-4")
	oPrinter:Say(139,500, 'Valor', oNew14N)
	oPrinter:Box(350, 010,300, 580, "-4")
	oPrinter:Line(300,300, 350, 300, , "-4")
    //oPrinter:Say(300 ,020,"Observação:"                                 , oNew14N) 
	oPrinter:Say(330,050, "__________________________________________" , oNew14N)
	oPrinter:Say(342,080, UsrFullName(ZZM_CODUS)                                  , oNew14N)
	oPrinter:Say(330,350, "TOTAL    "                                  , oNew14N)
	oPrinter:Line(300,450, 350, 450, , "-4")
	
	/*Jose Leite - 31/07/2014
  		Assinatura do Trabalhador
  	*/
  	//Inicio
  	oPrinter:Say(365,050, "__________________________________________" , oNew14N)
	oPrinter:Say(375,080, ZZM->ZZM_NOMTRA                  				, oNew14N)
  	//Fim
  	
  	//Linha de Corte
	oPrinter:Line(390, 10, 390, 580, , "-3")
  	
  	//Parte Inferior
  	//Cabeçalho
	oPrinter:Box( 400,010, 435, 580, "-4")
	//oPrinter:SayBitmap(402,011,"C:\Desenvolvimento\Projetos\SESICLINICA\SESI.BMP",120,30)
	
	//Jose Leite - Logo da empresa - 23-07-14
	//Inicio 
	oPrinter:SayBitmap(402,011,cLogo,120,30)
	//Fim
	
	oPrinter:Say( 410, 270, cCompanyName         , oNew14N)
	oPrinter:Say( 410, 420, 'Dt. do Atendimento:   ' + DtoC(ZZM->ZZM_DATA),  oNew14N)
	oPrinter:Say( 420, 420, 'Dt. do Procedimento: ' + DToC(ZZM->ZZM_DTPROC),  oNew14N)
	oPrinter:Say( 432, 260, "GUIA DE ATENDIMENTO", oNew14N)
	oPrinter:Say( 432, 505, "Nº " + ZZM->ZZM_ATEND   , oNew14N)
	
	//Trabalhadores
	oPrinter:Box(450,010, 500, 580, "-4")
	oPrinter:Say(462,020, 'Trabalhador  - ' , oNew14N)
	oPrinter:Say(462,085, ZZM->ZZM_TRABAL  , oNew14N)
	oPrinter:Say(462,135, ZZM->ZZM_NOMTRA  , oNew14N)
	oPrinter:Say(474,020, 'Empresa      - ' , oNew14N)
	oPrinter:Say(474,085, ZZM->ZZM_CODCLI  , oNew14N)
	oPrinter:Say(474,129, ZZM->ZZM_LOJA    , oNew14N)
	oPrinter:Say(474,152, ZZM->ZZM_NOME    , oNew14N)
	oPrinter:Say(486,020, 'Profissional - ' , oNew14N)
	oPrinter:Say(498,020, 'Tipo Atend   - ' , oNew14N)
	oPrinter:Say(498,085, cTpAtend    , oNew14N)
	
	//Procedimentos
	oPrinter:Box(508, 010, 750, 580, "-4")
	oPrinter:Say(521, 260, "PROCEDIMENTO", oNew14N)
	oPrinter:Line(530, 10, 530, 580, , "-4")
	oPrinter:Line(542, 10, 542, 580, , "-4")
	oPrinter:Say(539,023, 'Codigo' , oNew14N)
	oPrinter:Line(530,70, 750, 70, , "-4")
	oPrinter:Say(539,240, 'Especificação', oNew14N)
	oPrinter:Line(530,450, 750, 450, , "-4")
	oPrinter:Say(539,500, 'Valor', oNew14N)
   	 
   	/*Jose Leite - 31/07/2014
  		Assinatura do Trabalhador
  	*/
  	//Inicio
  	oPrinter:Say(770,050, "__________________________________________" , oNew14N)
	oPrinter:Say(780,080, ZZM->ZZM_NOMTRA                  				, oNew14N)
  	//Fim
  	
  	//Imprime Procedimentos
	DbSelectArea('ZZN')
	DbSetOrder(1)
	DbGoTop()
	DbSeek(xFilial() + ZZM->ZZM_ATEND)
  	 
	While (ZZN->(!EOF()) .AND. ZZM->ZZM_ATEND = ZZN->ZZN_ATEND)
		oPrinter:Say(nLin,020,ZZN->ZZN_PROCED, oNew14N)
		oPrinter:Say(nLin,080,ZZN->ZZN_DESPRO, oNew14N)
		oPrinter:Say(nLin,525,Transform(ZZN->ZZN_VUNIT,"@R 999999.99"), oNew14N)
  	 	
		oPrinter:Say(nLin1,020,ZZN->ZZN_PROCED, oNew14N)
		oPrinter:Say(nLin1,080,ZZN->ZZN_DESPRO, oNew14N)
	//	oPrinter:Say(nLin1,525,Transform(ZZN->ZZN_VUNIT,"@R 999999.99"), oNew14N)
  	 	
		cTotal := cTotal + ZZN->ZZN_VUNIT
		
		cProfis := ZZN->ZZN_CODCRE
  	 			
		nLin := nLin + 12
		nLin1 := nLin1 + 12
		DbSkip()
	EndDo
	
	cDProfis := Posicione("ZZG",1, xFilial("ZZG")+ cProfis,"ZZG_NOME")
	
	oPrinter:Say(086,085, cDProfis , oNew14N)
	oPrinter:Say(486,085, cDProfis , oNew14N)
	
	oPrinter:Say(330,525,Transform(cTotal,"@R 999999.99"), oNew14N)
  	 	
	oPrinter:Setup()
	
	if oPrinter:nModalResult == PD_OK
		oPrinter:Preview()
	EndIf
	
	oPrinter:EndPage()
 
Return