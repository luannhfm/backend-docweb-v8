#INCLUDE "protheus.ch" 

/*/{Protheus.doc} CN120IT7
@description PE para acrescentar campo num sc e Item da sc no array de itens
@type User Function
@author Bruna Paola - AP
@since 14/03/2012
@version 11.0
@param ParamIXB, array, item do pedido de compra
@return aItem, array, itens com os novos campos
@history 17/04/2019, Alan Teles de Oliveira, tratando erro quando a chamada do ponto de entrada não tenha itens.
/*/
User Function CN120IT7() 

	Local aItem := PARAMIXB[1]  
	Local cProc := ""  
	Local cFunc := "U_CNI109AL" // Se for medição e geração de pedido de compra automática permito incluir a SC
	Local nX := 0   
	Local lRet := .F.
	Local cFilSC   := SC1->C1_FILIAL
	Local cNumSolic:= SC1->C1_NUM     
	Local cProdSC  := ''

	If Len(aItem) > 0

		cProdSC  := aItem[Len(aItem)][2][2]

		While !Empty(cProc := ProcName( nX++ )) .And. !lRet
			lRet := (Alltrim(Upper(cProc)) == cFunc)
		End                                            

		dbselectarea("SC1")
		dbsetorder(2)
		If dbseek(cFilSC+cProdSC+cNumSolic)

		ConOut("lRet CN120IT7: "+cValToChar(lRet))
		ConOut("NUM SC CN120IT7: "+cValToChar(SC1->C1_NUM))   
		ConOut("ITEM SC CN120IT7: "+cValToChar(SC1->C1_ITEM))

		If (lRet)
			aAdd(aItem[len(aItem)],{"C7_NUMSC", SC1->C1_NUM, NIL})  
			aAdd(aItem[len(aItem)],{"C7_ITEMSC", SC1->C1_ITEM, NIL})
			aAdd(aItem[len(aItem)],{"C7_OBS", SC1->C1_OBS, NIL})

		EndIf

		EndIf

	EndIf

Return aItem
