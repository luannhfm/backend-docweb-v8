#INCLUDE 'TOTVS.CH'
#INCLUDE 'FWMVCDEF.CH'

/*/{Protheus.doc} SF99A01W
@description MVC Controle de Acesso API.

@author  Walmir Junior
@since   10/02/2021
@version 1.0   
/*/
User Function SF99A01W()

	Local oBrowse
    Local _cPerm    := GetMv("MV_XUSRAPI" ,, "001019")

    If !( RetCodUsr() $ _cPerm)
        MsgStop("iih... seu usuário não tem permissão a esta rotina, verifique!", "MV_XUSRAPI")
        return
    EndIf
	
	Private aRotina := MenuDef()
	
	oBrowse := FWMBrowse():New()
    oBrowse:SetAlias('ZAS')
	oBrowse:SetDescription('Controle de Acesso API')
		
    oBrowse:Activate()
    
Return Nil

/*/{Protheus.doc} MenuDef   
@description Montagem do Menu

@author  Walmir Junior
@since   10/02/2021
@version 1.0 
/*/
Static Function MenuDef()
	
Return FWMVCMenu( 'SF99A01W' )

/*/{Protheus.doc} ModelDef
@description Monta Model de apresentação

@author  Walmir Junior
@since   10/02/2021
@version 1.0 
/*/
Static Function ModelDef()

	Local oModel 	  := MPFormModel():New( 'SFXXA01M' )
	Local oSTRMVCPerm := FWFormStruct( 1, 'ZAS' ) 

	oModel:AddFields( 'ZASMASTER', , oSTRMVCPerm )
    oModel:SetDescription('Cadastro de Controle de Acesso API' )

	oModel:GetModel('ZASMASTER'):SetDescription('Controle de Acesso do Usuário por via API de autenticação AD')
    oModel:SetPrimaryKey( {'ZAS_FILIAL','ZAS_CODUSR'} )
     
Return oModel


/*/{Protheus.doc} ViewDef
@description Apresentação do model e View junto

@author  Walmir Junior
@since   10/02/2021
@version 1.0 
/*/
Static Function ViewDef()

	Local oView
	Local oModel  := FWLoadModel( 'SF99A01W' )
	
	Local oSTRMVCPerm := FWFormStruct( 2, 'ZAS')
	
	oView := FWFormView():New()
	oView:SetModel( oModel )
	oView:AddField( 'VZASMASTER', oSTRMVCPerm, 'ZASMASTER' )
	oView:CreateHorizontalBox( 'CABECALHO', 100 )
	oView:SetOwnerView( 'VZASMASTER', 'CABECALHO' )
	oView:EnableTitleView( 'VZASMASTER' )
	
	oView:SetCloseOnOk( {|| .t.} )
	
Return oView
