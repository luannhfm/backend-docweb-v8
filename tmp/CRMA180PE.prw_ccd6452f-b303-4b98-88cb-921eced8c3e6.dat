#Include "Protheus.Ch"

User Function CRMA180()
Local aParam := PARAMIXB
Local cIdPonto := ''
Local cIdModel := ''
Local oObj := ''
Local xRet := .T.

If aParam <> NIL
    oObj       := aParam[1]
    cIdPonto   := aParam[2]
    cIdModel   := aParam[3]

    If cIdPonto == 'MODELPRE'
        //Antes da alteração de qualquer campo do modelo.
        //Retorno: Requer um retorno lógico
    elseif cIdPonto == 'MODELPOS'
        //Na validação total do modelo.
        //Retorno: Requer um retorno lógico
    ElseIf cIdPonto == 'FORMPRE'
        //Antes da alteração de qualquer campo do formulário.
        //Retorno: Requer um retorno lógico
    ElseIf cIdPonto == 'FORMPOS'
        xRet := fVldForm(oObj)
        //Na validação total do formulário.
        //Retorno: Requer um retorno lógico
    ElseIf cIdPonto == 'FORMLINEPRE'
        //Antes da alteração da linha do formulário FWFORMGRID.
        //Retorno: Requer um retorno lógico
    ElseIf cIdPonto == 'FORMLINEPOS'
        //Na validação total da linha do formulário FWFORMGRID.
        //Retorno: Requer um retorno lógico
    ElseIf cIdPonto == 'MODELCOMMITTTS'
        //Após a gravação total do modelo e dentro da transação.
        //Retorno: Não espera retorno
    ElseIf cIdPonto == 'MODELCOMMITNTTS'
        //Após a gravação total do modelo e fora da transação.
        //Retorno: Não espera retorno
    ElseIf cIdPonto == 'FORMCOMMITTTSPRE'
        //Antes da gravação da tabela do formulário.
        //Retorno: Não espera retorno
    ElseIf cIdPonto == 'FORMCOMMITTTSPOS'
        //Após a gravação da tabela do formulário.
        //Retorno: Não espera retorno
    ElseIf cIdPonto == 'FORMCANCEL'
        //No cancelamento do botão.
        //Retorno: Requer um retorno lógico
    ElseIf cIdPonto == 'MODELVLDACTIVE'
        //Na ativação do modelo
        //Retorno: Requer um retorno lógico.
    ElseIf cIdPonto == 'BUTTONBAR'
        //Para a inclusão de botões na ControlBar.
        //Retorno: Requer um array de retorno com estrutura pré definida
    EndIf
EndIf

Return xRet

/*/{Protheus.doc} fVldForm
Valida o formulário
@type function
@author Franklin de Brito de Oliveira
@since 22/03/2022
@param oModel, object, modelo de dados
@return logical, indica se o formulário é valido
/*/
Static Function fVldForm(oModel)
Local lReturn := .T.
    Do Case
    Case SubStr(xFilial("AOF"), 1, 4)=="01MT"
        lReturn := fVldOrPr(oModel)
    Case SubStr(xFilial("AOF"), 1, 4)=="02MT"

    Case SubStr(xFilial("AOF"), 1, 4)=="03MT"

    Case SubStr(xFilial("AOF"), 1, 4)=="04MT"
        lReturn := fVldOrPr(oModel)
    EndCase
Return lReturn

/*/{Protheus.doc} fVldOrPr
Função para validar o preenchimento do campo "Origem prospecção ativa - AOF_XORPRA"
@type Function
@author Franklin de Brito de Oliveira
@since 22/03/2022
@param oModel, object, modelo de dados
@return logical, indica se o campo "Origem prospecção ativa - AOF_XORPRA" é valido
/*/
Static Function fVldOrPr(oModel)
Local cTipoPro := oModel:GetValue('AOF_XTPPRO')
Local cOrigPro := oModel:GetValue('AOF_XORPRA')
Local lReturn := .T.
    if !Empty(cTipoPro) .and. cTipoPro=="A"
        if !(cOrigPro$"1234")
            Help(;
                NIL,;
                NIL,;
                "Problema em preenchimento de campo",;
                NIL,;
                "Problema no preenchimento do campo 'Origem Prosp.'",;
                1,;
                0,;
                NIL,;
                NIL,;
                NIL,;
                NIL,;
                NIL,;
                {"Preencha o campo com 1=Prospeccao CS, 2=Prospeccao NM, 3=RD Station ou 4=Prospeccao AT"};
            )
            lReturn := .F.
        endif
    EndIf
Return lReturn
