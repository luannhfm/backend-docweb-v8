#INCLUDE "PROTHEUS.CH"


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MA160TOK  ºAutor  ³Microsiga           º Data ³  06/15/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ PE no final da analise cotacao                             º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ CNI                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User Function MA160TOK(aPlanilha)

Local aDadosCot
Local aDadosCompl
Local lTaMarc := .F.
Local lTemp   := .T.
Local nX      := 0   // PM
//Local oDlg   - PM
//Local oRadio - PM
//Local nOpca	  := 0 - PM
//Local lPrjCni  := FindFunction("PRJCNI") .Or. GetRpoRelease("R6") - PM
//Private nRadio - PM

aDadosCot   := PARAMIXB[3]     
aDadosCompl := PARAMIXB[5] 

//-------------------------------------------------------
//Do.It Sistemas 08.09.14 - P.T
//Só prosegue na Análise da Cotação se todos os itens 
//estiverem com um Fornecedor Vencedor marcado
//-------------------------------------------------------
If !Empty(aDadosCot)	
	For nX := 1 To Len(aDadosCot)
		//Contém todos os fornecedores
		aFornecs := aDadosCot[ nX ]
		
		//Verifica linha por linha se o registro está marcado 
		aEval( aFornecs , { |A| lTaMarc := Iif( !lTaMarc .And. Empty(A[1]) , .F. , .T. ) } )		
		
		//Variável global que verifica se todas as abas estão marcadas
		lTemp := (lTemp .AND. lTaMarc) 
		
		//Recebe falso para que ao passar novamente no Loop, 
		//não deixe como .T. os registros que não foram marcados
		lTaMarc:=.F.		
	Next nX	
Endif

//Verifica se continua ou trava o processo de continuidade
If !lTemp
		Aviso('Análise da Cotação','É necessário que se tenha um Fornecedor Vencedor para todos os Itens!'+CRLF+CRLF+'Obs. Navegue entre as teclas F5 e F6',{'Ok'},1)
Endif

   // Alterado por Peder Munksgaard (Do.it Sistemas) em 05/03/2014 
   // Conforme solicitação pela usuária Carla Barzsina devido a não 
   // haver necessidade da opção 'registro de preço' na analise da
   //cotação.	
   /*					
	If lPrjCni
		aDadosCot   := PARAMIXB[3]     
		aDadosCompl := PARAMIXB[5] 
		IF ParamIXB[1] <> 2  // Nao e visualizacao

			DEFINE MSDIALOG oDlg FROM  094,1 TO 220,293 TITLE "Gerar:" PIXEL 	
				@ 05,07 TO 42, 140 OF oDlg  PIXEL	
				@ 10,10 Radio oRadio VAR nRadio;
								ITEMS "Pedido de Compra",;	 
									   "Contrato",;
									   "Registro de Preço";	
									3D SIZE 60,15 OF oDlg PIXEL
			
				DEFINE SBUTTON FROM 45,085 TYPE 1 ENABLE OF oDlg ACTION (nOpca := 1, oDlg:End())
				DEFINE SBUTTON FROM 45,115 TYPE 2 ENABLE OF oDlg ACTION (nOpca := 0, oDlg:End())
			
				ACTIVATE MSDIALOG oDlg CENTERED
	
			
			DBSELECTAREA("SC8")  
			cNum := SC8->C8_NUM  
			
			
			If nOpca == 1  
				Do Case     
					Case nRadio == 1
						Return .T.
					Case nRadio == 2   
						If !(U_CNIA100('2', cNum, aDadosCot, aDadosCompl))
							Return .F.
						Endif	 	
					Case nRadio == 3
						If !(U_CNIA100('3', cNum, aDadosCot, aDadosCompl))
							Return .F.
						Endif	 
				End Case				 
			Else        
				Return .F.
			EndIf

        Endif
        
		Pergunte("MTA160",.F.) //Restaura parametros da cotacao
    	
	EndIf
   */
   // Fim da retirada do trecho.
   
Return(lTemp)